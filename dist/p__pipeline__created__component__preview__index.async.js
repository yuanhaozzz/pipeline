"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[163],{94875:function(yn,J,n){n.r(J),n.d(J,{default:function(){return Be}});var se=n(15009),v=n.n(se),oe=n(97857),f=n.n(oe),le=n(19632),de=n.n(le),ue=n(99289),E=n.n(ue),ce=n(5574),m=n.n(ce),d=n(62435),z=n(14754),ve=n(87547),fe=n(13923),b=n(86548),me=n(14313),pe=n(94060),G=n(81182),Y=n(68872),he=n(72269),P=n(55241),$=n(77683),xe=n(61781),ge=n(90930),je=[{id:1,name:"\u57FA\u7840\u8BBE\u7F6E"},{id:2,name:"\u6D41\u6C34\u7EBF"},{id:3,name:"\u901A\u77E5"}],ye=n(88731),M=n(74877),Ce=n(56292),Fe=n(52610),Se=n(53515),Ne=n(12570),Ee=n(66126),Re=n(4861),Ze=n(30856),Te=n.n(Ze),Cn=n(66155),e=n(86074),De=function(){var R=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Z=R.mode,a=Z===void 0?"code":Z,j=R.value,A=R.onChange,B=A===void 0?function(){}:A,p=(0,d.useState)(),F=m()(p,2),T=F[0],H=F[1],S=(0,d.useRef)();return(0,d.useEffect)(function(){if(j)if(T)T.set(j);else{var D=new(Te())(S.current,{mode:a,onChange:function(){return D.get}});D.set(j),H(D)}},[j,T,B]),(0,e.jsx)("div",{className:"common-json-editor",id:"jsoneditor",ref:S})},Ie=De,Pe=n(88026),C=n(83056),$e=n(866),L=n(2331),Fn=pe.Z.Option;function Ae(x){var R=(0,d.useState)(null),Z=m()(R,2),a=Z[0],j=Z[1],A=(0,d.useState)(1),B=m()(A,2),p=B[0],F=B[1],T=(0,d.useState)(!0),H=m()(T,2),S=H[0],D=H[1],K=(0,d.useState)(!1),Q=m()(K,2),He=Q[0],Sn=Q[1],Oe=(0,d.useState)({data:[]}),W=m()(Oe,2),Nn=W[0],En=W[1],we=(0,d.useState)({}),X=m()(we,2),l=X[0],Me=X[1],Le=(0,d.useState)("pipline"),k=m()(Le,2),O=k[0],Ue=k[1],Ve=(0,d.useState)(!1),q=m()(Ve,2),Je=q[0],ze=q[1],U=(0,d.useRef)(!1),be=(0,d.useRef)(null),Ge=(0,d.useRef)(null),_=(0,d.useRef)(null),Ye=(0,d.useRef)(null),Rn=(0,d.useRef)(null),ee=(0,d.useRef)(null),Ke=G.Z.useForm(),Qe=m()(Ke,1),ne=Qe[0],V=(0,M.DP)(),y=V.pipelineId,Zn=V.version,te=V.from,w=(0,z.v9)(function(i){var r=i.pipeline;return r}),u=(0,M.DP)(),We=(0,z.I0)(),Xe=(0,Pe.useModel)("@@initialState"),ke=Xe.initialState,ae=ke.currentUser,c=ae===void 0?{}:ae;(0,d.useEffect)(function(){F(u.tab*1||0)},[]),(0,d.useEffect)(function(){qe(),re()},[]);var qe=function(){var i=E()(v()().mark(function r(){var s,t,o,g,N;return v()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:try{s=w.list.findIndex(function(I){return I.id*1===y*1}),t=w.list[s],(0,Fe.$)(t.stages),t.template=t.stages,t.iid=t.id,t.id=y,w.list[s]=(0,M.p$)(t),We({type:"pipeline/setList",payload:{list:de()(w.list)}}),U.current&&U.current.setExpandTask(t,(o=t.setting)===null||o===void 0||(o=o.extra_data)===null||o===void 0?void 0:o.isExpandAll),j(f()({},t)),g=t.setting.pipeline_variable,N=g===void 0?[]:g,N&&setTimeout(function(){var I=N.find(function(jn){return jn.type.includes("git_url")})||{};_.current.repoInfo=I.urlValue},300)}catch(I){console.log(I)}finally{}case 1:case"end":return h.stop()}},r)}));return function(){return i.apply(this,arguments)}}(),_e=function(){var r=(0,C.v4)("/FlowLine/created/preview?pipelineId=".concat(y,"&pipelineName=").concat(a.name,"&tab=1"));u!=null&&u.from&&(r+="&from=".concat(u.from)),x.history.push(r)},re=function(){var i=E()(v()().mark(function r(){var s,t,o,g,N;return v()().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,(0,Ce.cD)({uuid:y});case 2:return s=h.sent,t=s||{},o=t.status,g=t.data,N=t.msg,Me(f()(f()({},g),{},{status:o})),!o&&(g==null?void 0:g.user_id)!==(c==null?void 0:c.id)&&(u==null?void 0:u.from)!=="entry"&&Y.ZP.warn(N),h.abrupt("return",o);case 7:case"end":return h.stop()}},r)}));return function(){return i.apply(this,arguments)}}(),ie=function(){var i=E()(v()().mark(function r(){var s;return v()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return u.from="",o.next=3,re();case 3:s=o.sent,s||(l==null?void 0:l.user_id)===(c==null?void 0:c.id)?x.history.push((0,C.v4)("/FlowLine/created/modify?pipelineId=".concat(y,"&tab=").concat(p))):_e();case 5:case"end":return o.stop()}},r)}));return function(){return i.apply(this,arguments)}}(),en=function(){x.history.push((0,C.v4)("/FlowLine/created/recentlyRun?pipelineId=".concat(a.uuid,"&pipelineName=").concat(a.name)))},nn=function(){Ue(O==="json"?"pipline":"json")},tn=function(r){F(r)},an=function(){var i=E()(v()().mark(function r(){var s;return v()().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",(0,C.Sb)(((s=a.setting)===null||s===void 0?void 0:s.pipeline_variable)||[]));case 1:case"end":return o.stop()}},r)}));return function(){return i.apply(this,arguments)}}(),rn=function(r){ee.current.open({id:r.uuid})},sn=function(){},on=function(){var i=E()(v()().mark(function r(){return v()().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:rn(a);case 1:case"end":return t.stop()}},r)}));return function(){return i.apply(this,arguments)}}(),ln=function(){if(!(0,L.rO)("History",u.pipelineId)){Y.ZP.error("\u6682\u65E0\u6743\u9650");return}x.history.push((0,C.v4)("/FlowLine/created/recentlyRun?pipelineId=".concat(y,"&pipelineName=").concat(a==null?void 0:a.name)))},dn=function(){var r;return(0,e.jsxs)("div",{className:"content-tab flex-space-between",children:[(0,e.jsx)("div",{className:"flex-start",children:je.map(function(s,t){return(0,e.jsxs)("div",{className:"content-tab-item ".concat(t===p&&"item-action"),onClick:function(){return tn(t)},children:[(0,e.jsx)("h3",{children:s.name}),t===p&&(0,e.jsx)("div",{className:"item-line"})]},s.id)})}),(0,e.jsx)("div",{style:{paddingRight:"17px"},children:(a==null?void 0:a.name)&&(0,e.jsxs)("div",{className:"content-tab-right-item flex-start",children:[(0,e.jsx)("div",{style:{color:"#c4cdd6"},children:"\u6D41\u6C34\u7EBF\u540D\u79F0\uFF1A"}),(0,e.jsx)("span",{className:"common-Jumpable-color",style:{cursor:"pointer",whiteSpace:"nowrap"},onClick:ln,children:a==null?void 0:a.name})]})}),(0,e.jsxs)("div",{className:"flex-start content-tab-header-handle",children:[!(l!=null&&l.status)&&(l==null?void 0:l.name)&&(l==null?void 0:l.user_id)!==(c==null?void 0:c.id)&&(0,e.jsxs)("span",{className:"canEdit",children:[(0,e.jsx)(ve.Z,{})," ",(r=l==null?void 0:l.name)!==null&&r!==void 0?r:""," \u6B63\u5728\u7F16\u8F91\u4E2D... \xA0\xA0\xA0"]}),te==="editHistory"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(he.Z,{onChange:function(){return nn()},checkedChildren:"UI",unCheckedChildren:"Raw"}),"\xA0\xA0"]}),te!=="editHistory"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(P.Z,{content:"\u8FD0\u884C\u8BB0\u5F55",children:[(0,e.jsx)($.ZP,{disabled:!(0,L.rO)("History",u.pipelineId),onClick:en,icon:(0,e.jsx)(fe.Z,{})}),"\xA0\xA0"]}),(0,L.rO)("Update",u.pipelineId)?(0,e.jsx)(P.Z,{content:"\u7F16\u8F91\u6D41\u6C34\u7EBF",children:(0,e.jsx)($.ZP,{onClick:ie,disabled:!(l!=null&&l.status)&&(l==null?void 0:l.user_id)!==(c==null?void 0:c.id),className:"flex-center",icon:(0,e.jsx)(b.Z,{className:"flow-created-EditOutlined-icon"})})}):(0,e.jsx)(xe.Z,{placement:"top",title:"\u6682\u65E0\u6743\u9650\u7F16\u8F91",children:(0,e.jsx)(P.Z,{content:"\u7F16\u8F91\u6D41\u6C34\u7EBF",children:(0,e.jsx)($.ZP,{onClick:ie,disabled:!0,className:"flex-center",icon:(0,e.jsx)(b.Z,{className:"flow-created-EditOutlined-icon"})})})}),"\xA0\xA0",(0,e.jsx)(P.Z,{content:"\u8FD0\u884C\u6D41\u6C34\u7EBF",children:(0,e.jsx)($.ZP,{type:"primary",onClick:on,loading:He,icon:(0,e.jsx)(me.Z,{})})}),(0,e.jsx)(C.YH,f()(f()({data:a},x),{},{uuid:y}))]})]})]})},Tn=function(){if(!(a!=null&&a.setting))return(0,e.jsx)(e.Fragment,{});var r=a.setting.pipeline_variable,s=r===void 0?[]:r;return!s||s.filter(function(t){return t.prompt_on_trigger}).length<=0?(0,e.jsx)(e.Fragment,{}):(s=s.filter(function(t){return t.name||t.type==="component"||t.type==="repo"}),(0,e.jsxs)("div",{className:"preview-content-env",children:[(0,e.jsx)("header",{className:"env-header",children:(0,e.jsxs)("span",{className:"env-header-content",onClick:function(){return D(!S)},children:["\u6D41\u6C34\u7EBF\u53D8\u91CF\uFF1A",(0,e.jsx)("span",{style:{fontSize:"10px",color:"#1890ff"},children:S?"\u6536\u8D77":"\u5C55\u5F00"})]})}),(0,e.jsx)(G.Z,{layout:"vertical",form:ne,className:"env-form",children:(0,e.jsx)("div",{style:{display:S?"block":"none"},children:(0,e.jsx)(Ee.Z,{env:s,form:ne,ref:Ye,data:a,pipelineId:y,changeHeight:sn})})})]}))},un=function(){return a?(0,e.jsx)("div",{className:"content-container common-content-container ".concat(p===1&&"content-container-show-action"),children:(0,e.jsx)(ye.Z,{data:a,type:2,setData:j,getEnvForm:an})}):(0,e.jsx)(e.Fragment,{})},cn=function(){return(0,e.jsx)("div",{className:"jsoneditor-viewer",style:{display:O==="json"?"block":"none"},children:(0,e.jsx)(Ie,{value:a,mode:"view"})})},vn=function(){return(0,e.jsxs)("div",{style:{height:"100%",display:O==="pipline"?"block":"none"},children:[mn(),un(),pn(),hn()]})},fn=function(){return(0,e.jsxs)("div",{className:"pipeline-preview-content",children:[dn(),vn(),cn()]})},mn=function(){return p!==1?(0,e.jsx)(e.Fragment,{}):(0,e.jsx)(C.r_,{data:a,setData:j,setTaskShow:ze,taskShow:Je,ref:U})},pn=function(){return a?(0,e.jsx)("div",{className:"content-container common-content-container  ".concat(p===0&&"content-container-show-action"),children:(0,e.jsx)(Se.Z,f()(f()({ref:Ge,data:a,setTabIndex:F},x),{},{type:2}))}):(0,e.jsx)(e.Fragment,{})},hn=function(){return a?(0,e.jsx)("div",{className:"content-container common-content-container  ".concat(p===2&&"content-container-show-action"),children:(0,e.jsx)(Ne.Z,f()(f()({ref:be,data:a,setTabIndex:F},x),{},{type:2,defaultSwitchTabIndex:0}))}):(0,e.jsx)(e.Fragment,{})},xn=function(){return!a||p!==1||O!=="pipline"?(0,e.jsx)(e.Fragment,{}):(0,e.jsx)($e.Z,{data:a,type:1})};return(0,e.jsx)(ge._z,{children:(0,e.jsxs)("div",{className:"pipeline-container pipeline-preview-container common-reset replace-font-size-12",ref:_,children:[fn(),xn(),(0,e.jsx)(Re.Z,f()({ref:ee},x))]})})}var Be=Ae}}]);
