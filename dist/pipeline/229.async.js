"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[229],{9646:function(lr,I,r){r.d(I,{Vh:function(){return Cr},Wm:function(){return x},Z7:function(){return p},v0:function(){return o},xO:function(){return Ce}});function Me(ur,m){for(var n=[],De=0;De<ur;De++){var Mr=De<10?"0"+De:De;switch(m){case"minute":De%10===0&&n.push({value:De,label:Mr});break;default:n.push({value:De,label:Mr})}}return n}var o=Me(11),Ce=Me(24),p=Me(60,"minute"),Cr=[{value:30,label:"30\u5206\u949F"},{value:60,label:"1\u5C0F\u65F6"},{value:120,label:"2\u5C0F\u65F6"},{value:300,label:"5\u5C0F\u65F6"},{value:600,label:"10\u5C0F\u65F6"}],x=[{label:"\u5468\u4E00",value:1},{label:"\u5468\u4E8C",value:2},{label:"\u5468\u4E09",value:3},{label:"\u5468\u56DB",value:4},{label:"\u5468\u4E94",value:5},{label:"\u5468\u516D",value:6},{label:"\u5468\u65E5",value:7}]},27978:function(lr,I,r){r.d(I,{M:function(){return Ce}});var Me=r(11238),o=function(Cr){return request("/api/test",{method:"get",params:Cr})},Ce=function(Cr){return(0,Me.ZP)("/api/pipeline/atom/"+Cr,{method:"get"})}},5150:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{s:function(){return validator}});var C_Users_haoyuan3_github_pipeline_node_modules_umijs_babel_preset_umi_node_modules_babel_runtime_helpers_typeof_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(52677),C_Users_haoyuan3_github_pipeline_node_modules_umijs_babel_preset_umi_node_modules_babel_runtime_helpers_typeof_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(C_Users_haoyuan3_github_pipeline_node_modules_umijs_babel_preset_umi_node_modules_babel_runtime_helpers_typeof_js__WEBPACK_IMPORTED_MODULE_0__);function isJsonString(str){try{var json=eval("("+str+")");if(C_Users_haoyuan3_github_pipeline_node_modules_umijs_babel_preset_umi_node_modules_babel_runtime_helpers_typeof_js__WEBPACK_IMPORTED_MODULE_0___default()(json)==="object")return!0}catch(lr){return!1}return!1}var validator={timeout:function lr(I,r,Me){if(Me===!1&&!r)return Promise.resolve();var o=/^[0-9]+$/;return o.test(r)?r<=0?Promise.reject("\u8BF7\u8F93\u5165\u5927\u4E8E0\u7684\u6574\u6570"):r>28800?Promise.reject("\u8D85\u65F6\u65F6\u95F4\u6700\u591A\u53EA\u80FD\u8BBE\u7F6E20\u5929(28800\u5206\u949F)"):Promise.resolve():Promise.reject("\u5B57\u6BB5\u53EA\u80FD\u5305\u542B\u6570\u5B57")},depth:function lr(I,r,Me){return r&&r<1?Promise.reject("\u8BF7\u8F93\u5165\u5927\u4E8E0\u7684\u6574\u6570"):Promise.resolve()},triggerHook:function lr(I,r,Me,o){var Ce=o.getFieldValue("git_url"),p=o.getFieldValue("ref");return Ce&&!p?Promise.reject("\u8BF7\u586B\u5199\u5206\u652F\u540D\u79F0"):!Ce&&p?Promise.reject("\u8BF7\u586B\u5199\u4EE3\u7801\u4ED3\u5E93"):Promise.resolve()},limitNumber:function lr(I,r,Me,o,Ce){var p=I.field;if(!r&&(p==="KUBERNETES_CPU_LIMIT"||p==="KUBERNETES_MEMORY_LIMIT"))return Promise.resolve();var Cr=Ce.min,x=Ce.max;return(r+"").length>1&&r[0]==="0"||r>x||r<Cr||(r+"").includes(".")?Promise.reject("\u8BF7\u8F93\u5165".concat(Cr," ~ ").concat(x,"\u7684\u6574\u6570")):Promise.resolve()},stringNotEmpty:function lr(I,r){return!r||!r.trim()?Promise.reject("\u4E0D\u80FD\u4E3A\u7A7A"):Promise.resolve()},stringEnglish:function lr(I,r){if(!r||!r.trim())return Promise.reject("\u4E0D\u80FD\u4E3A\u7A7A");var Me=/[\u4e00-\u9fa5]/;return Me.test(text)?Promise.reject("\u4E0D\u80FD\u8F93\u5165\u4E2D\u6587"):Promise.resolve()},stringEnglishNotRequired:function lr(I,r){var Me=/[\u4e00-\u9fa5]/;return Me.test(r)?Promise.reject("\u4E0D\u80FD\u8F93\u5165\u4E2D\u6587"):Promise.resolve()},vaildJSON:function lr(I,r){return isJsonString(r)?Promise.resolve():Promise.reject("\u8BE5\u5B57\u7B26\u4E32\u4E0D\u662F JSON \u683C\u5F0F")},outVariablesVaild:function lr(I,r,Me){for(var o=0;o<I.length;o++){var Ce=I[o];if(typeof Ce!="string"&&(Ce=Ce.key),!Ce)return Promise.reject("Key \u4E0D\u80FD\u4E3A\u7A7A")}return Promise.resolve()}}},53678:function(lr,I,r){r.d(I,{Z:function(){return Qe}});var Me=r(9783),o=r.n(Me),Ce=r(97857),p=r.n(Ce),Cr=r(15009),x=r.n(Cr),ur=r(52677),m=r.n(ur),n=r(99289),De=r.n(n),Mr=r(5574),Be=r.n(Mr),L=r(62435),Xe=r(96456),or=r(81182),Ke=r(94060),mr=r(78045),Ur=r(84567),ln=r(77683),Pr=r(80882),Kr=r(33160),Xr=r(26144),In=r(24389),En=r(62493),dn=r(81492),Pn=function(xr){return request("/api/pipeline/credential/list",{method:"get",params:xr})},fn=function(xr){var qe=xr.method,cr=xr.path,Lr=xr.params,ue=xr.data;return(0,dn.Z)(cr,{method:qe,data:ue,params:Lr})},vn=r(5150),tn=r(74330),je=r(32983),vr=r(11238),e=function(xr){return(0,vr.ZP)("/api/pipeline/variables/repo",{method:"get",params:xr})},xn=r(23279),i=r.n(xn),Un=r(74877),c=r(86074),Yn=Ke.Z.Option;function kn(k,xr){var qe=k.label,cr=k.name,Lr=k.initialValue,ue=k.repoType,Ye=k.repoChange,Br=k.required,on=k.message,Dn=k.className,zr=k.style,Ir=k.help,ge=Ir===void 0?"":Ir,kr=k.isCopy,jr=kr===void 0?!1:kr,He=k.form,Jr=k.url,hr=Jr===void 0?"":Jr,en=(0,L.useState)(!1),Tr=Be()(en,2),mn=Tr[0],An=Tr[1],_n=(0,L.useState)([]),Cn=Be()(_n,2),yr=Cn[0],dr=Cn[1];(0,L.useImperativeHandle)(xr,function(){return{setOptionsData:Q,getRepoApi:Je}}),(0,L.useEffect)(function(){Je()},[]);var Q=function(_){dr([])},Je=function(){var t=De()(x()().mark(function _(){var A,X,ce,Ar,er=arguments;return x()().wrap(function($e){for(;;)switch($e.prev=$e.next){case 0:return A=er.length>0&&er[0]!==void 0?er[0]:"",An(!0),dr([]),X={type:ue,repo_name:A},A||(X.default=Lr),$e.prev=5,$e.next=8,e(X);case 8:ce=$e.sent,Ar=ce.data,dr(Ar),$e.next=15;break;case 13:$e.prev=13,$e.t0=$e.catch(5);case 15:return $e.prev=15,An(!1),$e.finish(15);case 18:case"end":return $e.stop()}},_,null,[[5,13,15,18]])}));return function(){return t.apply(this,arguments)}}(),Vr=i()(Je,500),he=function(){if(jr){var _=He.getFieldValue("git_url"),A=_||hr;return A?(0,c.jsxs)("div",{children:[qe,"\xA0<URL\uFF1A",A,">\xA0",(0,c.jsx)("span",{style:{color:"#1890ff",cursor:"pointer"},onClick:function(){return(0,Un.zp)(A)},children:"\u590D\u5236"})]}):qe}return qe};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(or.Z.Item,{name:"git_url"}),(0,c.jsx)(or.Z.Item,{name:"repoId"}),(0,c.jsx)(or.Z.Item,{label:he(),name:cr,initialValue:Lr,rules:[{required:Br,message:on}],extra:ge,className:Dn,style:zr,children:(0,c.jsx)(Ke.Z,{allowClear:!0,placeholder:"\u8BF7\u8F93\u5165",showSearch:!0,filterOption:!1,onSearch:function(_){return Vr(_)},notFoundContent:mn?(0,c.jsx)(tn.Z,{size:"small"}):(0,c.jsx)(je.Z,{}),onChange:function(_){var A=yr.find(function(X){return X.name===_});Ye(A)},children:yr.map(function(t){return(0,c.jsx)(Yn,{value:t.name,label:t.name,children:t.name})})})})]})}var Hr=(0,L.forwardRef)(kn),Le=function(xr){return(0,dn.Z)("/api/pipeline/variables/branch",{method:"get",params:xr})},le=function(xr){return(0,dn.Z)("/api/pipeline/variables/gerrit_ref",{method:"get",params:xr})},W=Ke.Z.Option,Re=null;function pr(k,xr){var qe=k.label,cr=k.name,Lr=k.initialValue,ue=k.repoType,Ye=k.change,Br=k.repoId,on=k.className,Dn=k.style,zr=k.isBranchValue,Ir=k.repoName,ge=k.isVaildBranch,kr=ge===void 0?!1:ge,jr=k.searchChange,He=k.required,Jr=He===void 0?!0:He,hr=k.help,en=k.currentDefaultValue,Tr=k.componentConfig,mn=k.form,An=k.config,_n=k.customizeButton,Cn=k.type,yr=(0,L.useState)(!1),dr=Be()(yr,2),Q=dr[0],Je=dr[1],Vr=(0,L.useState)([]),he=Be()(Vr,2),t=he[0],_=he[1],A=(0,L.useRef)(null),X=!1,ce=!1;(0,L.useEffect)(function(){Ir&&(clearTimeout(Re),Re=setTimeout(function(){er("","branch")},500))},[Br,Ir,zr,ue]),(0,L.useImperativeHandle)(xr,function(){return{setOptionsData:Ar}});var Ar=function(Qn){_([])},er=function(){var Zn=De()(x()().mark(function Qn(){var Kn,Gn,aa,br,u,te,_e,fe,Ve,gr,Wr,nn=arguments;return x()().wrap(function(Er){for(;;)switch(Er.prev=Er.next){case 0:if(Kn=nn.length>0&&nn[0]!==void 0?nn[0]:"",Gn=nn.length>1&&nn[1]!==void 0?nn[1]:"branch",aa=nn.length>2&&nn[2]!==void 0?nn[2]:!1,br={branch:_},u=br[Gn],Br){Er.next=8;break}return u([]),Er.abrupt("return");case 8:if(te={branch:X,refId:ce},_e=te[Gn],!_e){Er.next=12;break}return Er.abrupt("return");case 12:return te[Gn]=!0,Je(!0),u([]),fe={type:ue,repo_id:Br},Gn==="refId"?(fe.repo_name=Ir,fe.ref_id=Kn):(fe.branch=Kn,!Kn&&!aa&&(fe.default=en)),Er.prev=17,Ve=Gn==="refId"?le:Le,Er.next=21,Ve(fe);case 21:gr=Er.sent,Wr=gr.data,jr&&jr(Kn,Wr,Gn),u(Wr),Er.next=29;break;case 27:Er.prev=27,Er.t0=Er.catch(17);case 29:return Er.prev=29,setTimeout(function(){te[Gn]=!1,Je(!1)},1500),Er.finish(29);case 32:case"end":return Er.stop()}},Qn,null,[[17,27,29,32]])}));return function(){return Zn.apply(this,arguments)}}(),Gr=function(){return ue==="gerrit"?zr===void 0||zr===!0:!0},$e=i()(function(Zn){return er(Zn,"branch")},500),rn=i()(function(Zn){console.log("222222222222")},1e3),Hn=(0,L.useMemo)(function(){return(0,c.jsx)(Ke.Z,{allowClear:!0,placeholder:"\u8BF7\u9009\u62E9\u4EE3\u7801\u5206\u652F",showSearch:!0,optionFilterProp:"children",filterOption:!1,onSearch:$e,notFoundContent:Q?(0,c.jsx)(tn.Z,{size:"small"}):(0,c.jsx)(je.Z,{}),onChange:Ye,children:t.map(function(Zn){return(0,c.jsx)(W,{value:Zn,label:Zn,children:Zn})})})},[Br,Ir,zr,t,Q,ue]),Tn=function(Qn){var Kn=/^\$\{[\w]+\}$/;return Kn.test(Qn)},Xn=function(Qn,Kn){return Cn!==1||Tn(Kn)?Promise.resolve():Promise.reject("\u683C\u5F0F\u9519\u8BEF")},pn=function(){var Qn=_n?mn.getFieldValue(_n):"";return(0,c.jsxs)("div",{className:"flex-start",children:[Qn?(0,c.jsx)(or.Z.Item,{name:cr,label:"\u4EE3\u7801\u5206\u652F",style:{flex:1},rules:[{required:Jr,message:""},{validator:Xn}],children:(0,c.jsx)(Xe.Z,{placeholder:"${x}\u7684\u73AF\u5883\u53D8\u91CF",style:{height:"32px"}})}):(0,c.jsx)(or.Z.Item,{style:{flex:1},name:cr,label:"".concat(qe||"\u4EE3\u7801\u5206\u652F"),initialValue:Lr,rules:[{required:Jr,message:"\u8BF7\u9009\u62E9\u5206\u652F"}],extra:hr,children:Hn}),"\xA0\xA0\xA0\xA0",(0,c.jsx)(or.Z.Item,{noStyle:!0,name:_n,label:"",valuePropName:"checked",initialValue:!1,children:(0,c.jsx)(Ur.Z,{onChange:function(Gn){An.variables[cr]=void 0,mn.setFieldValue(cr,void 0);var aa=Gn.target.checked;aa||er("","branch",!0)},children:"\u73AF\u5883\u53D8\u91CF"})})]})},sa=function(){return(0,c.jsx)(c.Fragment,{children:pn()})};return(0,c.jsx)("div",{ref:A,className:on,style:Dn,children:ue==="gerrit"?sa():pn()})}var Te=(0,L.forwardRef)(pr),Fe=r(19632),ae=r.n(Fe),de=r(52745),We=r(24969),Or=Xe.Z.TextArea;function Qr(k,xr){var qe=k.form,cr=k.isAuth,Lr=cr===void 0?!0:cr,ue=k.variables,Ye=ue===void 0?[]:ue,Br=k.label,on=Br===void 0?"":Br,Dn=k.from,zr=k.type,Ir=zr===void 0?1:zr,ge=k.layout,kr=ge===void 0?1:ge,jr=k.handleArrow,He=k.isArrowExpand,Jr=k.plugin,hr=(0,L.useState)([]),en=Be()(hr,2),Tr=en[0],mn=en[1];(0,L.useEffect)(function(){if(Ye){if(typeof Ye=="string")return;var he=Cn(Ye).map(function(t){return t.previous_key||(t.previous_key=t.key),t});mn(he)}},[Ye]),(0,L.useImperativeHandle)(xr,function(){return{getValue:An,setValue:_n}});var An=function(){return Tr},_n=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];mn(Cn(t))},Cn=function(t){return t[0]&&typeof t[0]=="string"&&(t=t.map(function(_){return{scope:"pipeline",key:_,description:"",is_summarized:!1}})),t},yr=function(){Tr.push({scope:"pipeline",key:"",description:"",previous_key:"",is_summarized:!1}),mn(ae()(Tr))},dr=function(t){Tr.splice(t,1),mn(ae()(Tr)),qe.validateFields(["out_variables"])},Q=function(t,_,A){var X,ce=t.target.value;A==="is_summarized"&&(ce=t.target.checked,Tr[_].remark=""),Tr[_][A]=ce,delete Tr[_].remark,Tr[_].is_summarized&&(Tr[_].remark=(X=Tr[_])===null||X===void 0?void 0:X.description),mn(ae()(Tr))},Je=function(t){var _="";return kr===2&&t.previous_key!==""&&(t.previous_key!==t.key?_="\uFF08\u539F ".concat(t.previous_key,"\uFF09"):_="\uFF08\u53EF\u91CD\u547D\u540D\uFF09"),_},Vr=function(){return(0,c.jsxs)(or.Z.Item,{label:on,style:{margin:0},className:"pluginMarket-detail-variable-container",children:[(0,c.jsx)(or.Z.Item,{name:"out_variables",label:"",rules:[{validator:function(){for(var _=arguments.length,A=new Array(_),X=0;X<_;X++)A[X]=arguments[X];return vn.s.outVariablesVaild.apply(vn.s,[Tr].concat(A))}}],style:{margin:0},noStyle:!0,children:(0,c.jsx)("div",{className:" flex-space-between",style:{flexWrap:"wrap",position:"relative"},children:Tr.map(function(t,_){var A;return(0,c.jsxs)("div",{className:"variable-list-item",children:[(0,c.jsxs)("div",{className:"flex-space-between",children:[(0,c.jsx)(or.Z.Item,{label:"Key".concat(Je(t)),style:{flex:1,marginRight:"20px"},required:!0,children:(0,c.jsx)(Xe.Z,{placeholder:"\u8F93\u51FA\u53D8\u91CF\u7684 Key",value:t.key,onChange:function(ce){return Q(ce,_,"key")},onBlur:function(){return qe.validateFields(["out_variables"])},maxLength:60})}),(0,c.jsx)(or.Z.Item,{label:"\u53EF\u89C1\u8303\u56F4",required:!0,children:(0,c.jsxs)(mr.ZP.Group,{onChange:function(ce){return Q(ce,_,"scope")},value:t.scope,className:"radio",children:[(0,c.jsx)(mr.ZP,{value:"pipeline",children:"\u5168\u5C40"}),(0,c.jsx)(mr.ZP,{value:"job",children:"Job"})]})})]}),(0,c.jsx)(or.Z.Item,{label:"\u63CF\u8FF0",children:(0,c.jsx)(Or,{placeholder:"\u8BF7\u586B\u5199\u63CF\u8FF0",autoSize:{minRows:1},value:t.description,maxLength:100,onChange:function(ce){return Q(ce,_,"description")}})}),((A=location)===null||A===void 0?void 0:A.pathname)!=="/FlowLine/pluginMarket/detail"&&(0,c.jsx)("div",{className:"flex-space-between",children:(0,c.jsx)(or.Z.Item,{label:"\u6784\u5EFA\u7ED3\u679C",className:"is_summarized",children:(0,c.jsx)(Ur.Z,{checked:t==null?void 0:t.is_summarized,onChange:function(ce){return Q(ce,_,"is_summarized")}})})}),Lr&&Ir===1&&(0,c.jsx)("div",{className:"reduce flex-center",onClick:function(){return dr(_)},children:(0,c.jsx)(de.Z,{})})]})})})}),(0,c.jsx)("div",{className:"".concat(Dn==="task"&&"flex-center"," outVariables-add"),children:Lr&&Ir===1&&(0,c.jsx)("div",{className:"add flex-center",onClick:function(){return yr()},children:(0,c.jsx)(We.Z,{})})})]})};return Ir!==1&&Tr.length<=0?(0,c.jsx)(c.Fragment,{}):kr===2?(0,c.jsxs)("div",{className:"common-form-config-outVariables",children:[(0,c.jsxs)("div",{className:"outVariables-title flex-space-between",onClick:function(){return jr(Jr)},children:[(0,c.jsx)("div",{children:"\u8F93\u51FA\u73AF\u5883\u53D8\u91CF"}),(0,c.jsx)("div",{className:"".concat(!He&&"common-FormConfig-arrow-down-rotate"," common-FormConfig-arrow"),children:(0,c.jsx)(Pr.Z,{})})]}),(0,c.jsx)("div",{style:{display:He?"none":"block"},children:Vr()})]}):(0,c.jsx)(c.Fragment,{children:Vr()})}var qr=(0,L.forwardRef)(Qr),jn=r(50888),$r=function(xr,qe){return(0,dn.Z)("".concat(xr),{method:"get",params:qe})};function Mn(k){var xr=k.selectProps,qe=xr===void 0?{}:xr,cr=k.name,Lr=k.component,ue=Lr===void 0?{}:Lr,Ye=k.formItemConfig,Br=Ye===void 0?{}:Ye,on=k.config,Dn=k.forceUpdate,zr=k.form,Ir=(0,L.useState)([]),ge=Be()(Ir,2),kr=ge[0],jr=ge[1],He=(0,L.useState)(!1),Jr=Be()(He,2),hr=Jr[0],en=Jr[1],Tr=(0,L.useState)(""),mn=Be()(Tr,2),An=mn[0],_n=mn[1],Cn=(0,L.useRef)([]);(0,L.useEffect)(function(){var t=zr.getFieldValue(cr);yr(t,"load")},[]);var yr=function(){var t=De()(x()().mark(function _(){var A,X,ce,Ar,er,Gr,$e,rn,Hn,Tn=arguments;return x()().wrap(function(pn){for(;;)switch(pn.prev=pn.next){case 0:if(A=Tn.length>0&&Tn[0]!==void 0?Tn[0]:"",X=Tn.length>1?Tn[1]:void 0,_n(A),!(!A&&X!=="load")){pn.next=6;break}return jr([]),pn.abrupt("return");case 6:return en(!0),pn.prev=7,er=X==="load"&&ue.optionValue||ue.searchField,Gr=A,Array.isArray(Gr)&&(Gr=null),$e=p()(o()({},er,Gr),ue==null||(ce=ue.api)===null||ce===void 0?void 0:ce.params),$e[er]||delete $e[er],pn.next=15,$r(ue==null||(Ar=ue.api)===null||Ar===void 0?void 0:Ar.path,$e);case 15:rn=pn.sent,Hn=Array.isArray(rn)?rn:Array.isArray(rn.data)?rn.data:rn.data.data,Cn.current=[].concat(ae()(Cn.current),ae()(Hn)),jr(Hn),pn.next=24;break;case 21:pn.prev=21,pn.t0=pn.catch(7),console.log(pn.t0);case 24:return pn.prev=24,en(!1),pn.finish(24);case 27:case"end":return pn.stop()}},_,null,[[7,21,24,27]])}));return function(){return t.apply(this,arguments)}}(),dr=i()(yr,500),Q=function(){return hr?(0,c.jsx)(tn.Z,{indicator:(0,c.jsx)(jn.Z,{})}):An&&kr.length===0?(0,c.jsx)(je.Z,{image:je.Z.PRESENTED_IMAGE_SIMPLE}):"\u53EF\u8F93\u5165\u5173\u952E\u5B57\u641C\u7D22"},Je=function(_,A){var X,ce=_,Ar=[];A==="input"?Ar=_:(typeof _=="string"&&(ce=[_]),ue.mode&&ce.forEach(function(er){Ar.push(Cn.current.find(function(Gr){return Gr[ue.optionValue]===er}))})),ue==null||(X=ue.selectedValueField)===null||X===void 0||X.split(".").reduce(function(er,Gr,$e,rn){return $e===rn.length-1&&(er[Gr]=Ar),er[Gr]},on),Dn()},Vr=function(_){var A=/^\$\{[\s\S]*?\}$/;return A.test(_)},he=function(_){var A=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return!A||A.length<=0||!Vr(A)?Promise.reject("\u683C\u5F0F\u9519\u8BEF"):Promise.resolve()};return(0,c.jsx)("div",{className:"flex-space-between",style:{width:"100%"},children:(0,c.jsx)(or.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(){var _=Br.dependencyField?zr.getFieldValue(Br.dependencyField):"";return(0,c.jsxs)(c.Fragment,{children:[_?(0,c.jsx)(or.Z.Item,p()(p()({},Br),{},{rules:[{required:!0,message:""},{validator:he}],style:{flex:1},children:(0,c.jsx)(Xe.Z,{placeholder:"\u81EA\u5B9A\u4E49\u683C\u5F0F\u4E3A ${x}",style:{height:"32px"},onChange:function(X){return Je(X.target.value,"input")}})})):(0,c.jsx)(or.Z.Item,p()(p()({},Br),{},{rules:[{required:!0,message:Br.message}],style:{flex:1},children:(0,c.jsx)(Ke.Z,p()(p()({allowClear:!0,showSearch:!0,optionFilterProp:"children",filterOption:!1,onChange:Je,onSearch:function(X){return dr(X)},notFoundContent:Q()},ue),{},{children:kr==null?void 0:kr.map(function(A){return(0,c.jsx)(Option,{value:A[ue.optionValue],children:(0,c.jsxs)("div",{className:"demo-option-label-item",title:"".concat(A[ue.optionLabel]," ").concat(A[ue.optionValue]),children:[(0,c.jsx)("span",{role:"img","aria-label":"China",children:A[ue.optionLabel]}),(0,c.jsxs)("span",{children:["\xA0\xA0\xA0",A[ue.optionValue]]})]})},A[ue.optionValue])})}))})),Br.dependencyField&&(0,c.jsxs)(c.Fragment,{children:["\xA0\xA0\xA0",(0,c.jsx)(or.Z.Item,{label:"",name:Br.dependencyField,noStyle:!0,valuePropName:"checked",initialValue:!1,children:(0,c.jsx)(Ur.Z,{onChange:function(X){on.variables[Br.name]=void 0;var ce=ue.selectedValueField;ce.includes(".")&&(ce=ce.split(".").reverse()[0]),on.variables[ce]=Br.dependencyField?"":[],zr.setFieldValue(Br.name,void 0),zr.setFieldValue(ce,Br.dependencyField?"":[])},children:"\u81EA\u5B9A\u4E49"})})]})]})}})})}var On=Mn,yn=Xe.Z.TextArea,un={};function V(k,xr){var qe=k.form,cr=k.config,Lr=k.formItemlist,ue=Lr===void 0?[]:Lr,Ye=k.type,Br=k.flowData,on=Br===void 0?{}:Br,Dn=(0,L.useState)({before:!1,after:!1}),zr=Be()(Dn,2),Ir=zr[0],ge=zr[1],kr=(0,L.useRef)(null),jr=(0,L.useRef)({}),He=(0,L.useRef)(null);un=cr;var Jr=(0,L.useReducer)(function(br){return br+1},0),hr=Be()(Jr,2),en=hr[1],Tr=(0,L.useRef)(!1);(0,L.useImperativeHandle)(xr,function(){return{getValue:mn,refresh:_n}});var mn=function(u){switch(u){case"out_variables":var te=[];return He.current&&(te=He.current.getValue()),te}},An=function(){ue.forEach(function(u){u.forEach(function(te){var _e=te.fieldLevel,fe=te.formItemConfig,Ve=fe.name,gr=fe.initialValue,Wr=cr[Ve];_e&&(Wr=_e.split(".").reduce(function(nn,cn,Er,Yr){return Er!==Yr.length-1&&!nn[cn]&&(nn[cn]={}),nn[cn]},cr)),Wr==null&&gr!==null&&gr!==void 0&&(_e=_e||Ve,Wr=gr,_e.split(".").reduce(function(nn,cn,Er,Yr){return Er===Yr.length-1&&(nn[cn]=gr),nn[cn]},cr)),Ve==="script"&&!Wr&&(Wr=gr),Ve==="repoName"&&(Wr||(qe.setFieldValue("git_url",void 0),qe.setFieldValue("repoId",void 0))),Ve==="script"&&console.log(Wr),qe.setFieldValue(Ve,Wr)})})},_n=function(u,te,_e,fe){Tr.current=fe||!1,kr.current&&(kr.current.style.transform="rotate(360deg)",kr.current.style.transition="all 0.6s"),Cn(u,te,_e),setTimeout(function(){kr.current&&(kr.current.style.transition="none",kr.current.style.transform="rotate(0deg)")},300)},Cn=function(){var br=De()(x()().mark(function u(te,_e,fe){var Ve,gr,Wr,nn,cn;return x()().wrap(function(Yr){for(;;)switch(Yr.prev=Yr.next){case 0:return Yr.prev=0,Yr.next=3,fn(te);case 3:Ve=Yr.sent,gr=Ve.data,jr.current[_e]=gr.map(function(Bn){return m()(Bn)!=="object"?{label:Bn,value:Bn}:{label:Bn.name,value:Bn.uuid}}),Wr=jr.current[_e],nn=fe.name,cn=Wr.find(function(Bn){return Bn.value===cr[nn]}),cn||(cr[nn]=void 0),en(),Yr.next=16;break;case 13:Yr.prev=13,Yr.t0=Yr.catch(0),jr.current[_e]=[];case 16:case"end":return Yr.stop()}},u,null,[[0,13]])}));return function(te,_e,fe){return br.apply(this,arguments)}}(),yr=function(u){switch(u.length){case 1:return Je(u[0]);case 2:default:return A(u)}},dr=function(u){var te=u.buttonType,_e=u.use,fe=u.href,Ve=u.mode;switch(_e){case"link":Ve==="new"&&window.open(fe);break}},Q=function(u){u.isArrowExpand=!u.isArrowExpand,en()},Je=function(u){var te=u.shouldUpdate,_e=u.dependencyKey,fe=u.dependencyValue;return te?(0,c.jsx)(or.Z.Item,p()(p()({},u.parentFormItemConfig),{},{shouldUpdate:!0,children:function(){var gr=qe.getFieldValue(_e);return gr===fe?_(u):(0,c.jsx)(c.Fragment,{})}})):_(u)},Vr=function(u){var te=u.formItemConfig,_e=te.label,fe=te.required,Ve=u.isArrowExpand;return(0,c.jsxs)("div",{className:"common-formConfig-arrow-box flex-space-between",style:{width:"100%"},onClick:function(){return Q(u)},children:[(0,c.jsxs)("div",{className:"flex-start",children:[fe&&(0,c.jsx)("div",{style:{color:"#ff4d4f"},children:"*\xA0\xA0"}),_e]}),(0,c.jsx)("div",{className:"".concat(!Ve&&"common-FormConfig-arrow-down-rotate"," common-FormConfig-arrow"),children:(0,c.jsx)(Pr.Z,{})})]})},he=function(u){var te=u.formItemConfig,_e=te.label,fe=te.name,Ve=te.initialValue;return(0,c.jsx)(or.Z.Item,{name:fe,initialValue:Ve,noStyle:!0})},t=function(u){var te=u.formItemConfig,_e=te.label,fe=te.required,Ve=u.isArrowExpand;return(0,c.jsx)(qr,{variables:cr.out_variables,isAuth:!0,form:qe,ref:He,label:"",from:"task",type:Ye,handleArrow:Q,layout:2,plugin:u,isArrowExpand:Ve})},_=function(u){var te=u.formItemConfig,_e=te.required,fe=te.message,Ve=te.validator,gr=u.isDropDown,Wr=u.isArrowExpand,nn=u.hide,cn=u.componentConfig,Er=[];if((Ve||_e)&&(Er=[{required:_e,message:fe},{validator:Ve?function(){for(var ta=arguments.length,la=new Array(ta),ua=0;ua<ta;ua++)la[ua]=arguments[ua];return vn.s[Ve].apply(vn.s,la.concat([qe,u.componentConfig]))}:null}]),u.componentConfig){var Yr=function(){if(typeof u.componentConfig[Bn]=="function"){var la=u.componentConfig[Bn];u.componentConfig[Bn]=function(){la(un,qe)}}};for(var Bn in u.componentConfig)Yr()}return nn?he(u):gr?(0,c.jsx)(or.Z.Item,p()(p()({},u.formItemConfig),{},{label:Vr(u),required:!1,rules:Er,className:"".concat(Wr?"common-FormConfig-arrow-down":"common-FormConfig-arrow-expand"),children:ce(u.componentConfig,u.formItemConfig.name,u.formItemConfig,u==null?void 0:u.flexibleParams)})):cn.type==="repo"?Gn(u):cn.type==="branch"?aa(u):cn.type==="outVariables"?t(u):cn.type==="remoteSearchSelect"?sa(u.componentConfig,u.formItemConfig.name,u.formItemConfig):(0,c.jsx)(or.Z.Item,p()(p()({},u.formItemConfig),{},{rules:Er,children:ce(u.componentConfig,u.formItemConfig.name,u.formItemConfig,u==null?void 0:u.flexibleParams)}))},A=function(u){return(0,c.jsx)("div",{className:"flex-space-between",children:u.map(function(te){return Je(te)})})},X=function(u){var te,_e=((te=on.setting)===null||te===void 0||(te=te.pipeline_variable)===null||te===void 0?void 0:te.filter(function(fe){return fe.type==="repo"}))||[];return(0,c.jsx)(Ke.Z,{allowClear:!0,showSearch:!0,optionFilterProp:"children",placeholder:"\u624B\u52A8\u89E6\u53D1\u7684\u6D41\u6C34\u7EBF\u53EF\u6307\u5B9A\u4ED3\u5E93\u5E8F\u53F7\uFF0C\u9ED8\u8BA4\u4E3A\u7B2C\u4E00\u4E2A\u4ED3\u5E93",filterOption:function(Ve,gr){var Wr;return((Wr=gr==null?void 0:gr.label)!==null&&Wr!==void 0?Wr:"").toLocaleLowerCase().includes(Ve.toLocaleLowerCase())},children:_e.map(function(fe,Ve){var gr;return(0,c.jsx)(Ke.Z.Option,{value:_e.length-Ve+"",children:(fe==null||(gr=fe.repo)===null||gr===void 0?void 0:gr[0]["repo-display_name"])||"\u4ED3\u5E93".concat(Ve+1)})})})},ce=function(u,te,_e,fe){var Ve=u.type;switch(Ve){case"props":return(0,c.jsx)(c.Fragment,{children:k.children});case"radio":return Ar(u);case"input":return er(u);case"textarea":return Gr(u);case"button":return Hn(u);case"select":return $e(u);case"codeMirror":return Xn(u,te);case"checkbox":return rn(u);case"repoIndex":return X(u);case"remoteSelect":return pn(u,te,_e,fe)}},Ar=function(u){var te=u.radioList;return(0,c.jsx)(mr.ZP.Group,{children:te.map(function(_e){return(0,c.jsx)(mr.ZP,p()(p()({},_e),{},{children:_e.label}))})})},er=function(u){var te=u.placeholder,_e=u.inputType,fe=u.min,Ve=u.max;return(0,c.jsx)(Xe.Z,p()(p()({},u),{},{type:_e}))},Gr=function(u){return(0,c.jsx)(yn,p()({},u))},$e=function(u){return(0,c.jsx)(Ke.Z,p()({allowClear:!0,showSearch:!0,optionFilterProp:"children",filterOption:function(_e,fe){var Ve;return((Ve=fe==null?void 0:fe.label)!==null&&Ve!==void 0?Ve:"").toLocaleLowerCase().includes(_e.toLocaleLowerCase())}},u))},rn=function(u){return(0,c.jsx)(Ur.Z,p()(p()({},u),{},{children:u.checkboxText}))},Hn=function(u){var te=u.label,_e=u.buttonType,fe=u.event;return(0,c.jsx)(ln.ZP,{type:_e,onClick:function(){return dr(fe)},children:te})},Tn=function(u,te,_e,fe){return(0,c.jsx)(or.Z.Item,{noStyle:!0,name:te,children:(0,c.jsx)(Xr.ZP,{height:_e||u.height||"500px",extensions:[En.RI.shell()],theme:In.ub,readOnly:Ye!==1||(fe===void 0?u.readOnly:fe)})})},Xn=function(u,te){var _e=Ir.after,fe=Ir.before;return(0,c.jsxs)("div",{className:"".concat(Ye!==1&&"formConfig-codeMirror-exec"," formconfig-codeMirror-container"),children:[(0,c.jsx)("div",{className:"formConfig-codeMirror-exec-layer"}),(0,c.jsxs)("div",{style:{padding:"5px 0",cursor:"pointer"},className:"flex-start",onClick:function(){ge({before:!fe,after:_e})},children:[(0,c.jsx)("div",{children:"Before Script"}),"\xA0",(0,c.jsx)(Pr.Z,{style:{marginTop:"3px"},className:"common-animation-arrow ".concat(fe&&"common-animation-arrow-active")})]}),(0,c.jsx)("div",{style:{display:fe?"block":"none",position:"relative"},children:Tn(u,"before_script","150px",!1)}),(0,c.jsx)("div",{style:{padding:"5px 0"},children:"Script"}),(0,c.jsx)("div",{className:u.readOnly&&"formConfig-codeMirror-exec",children:Tn(u,te,u.height)}),(0,c.jsxs)("div",{style:{padding:"5px 0",cursor:"pointer"},className:"flex-start",onClick:function(){ge({before:fe,after:!_e})},children:[(0,c.jsx)("div",{children:"After Script"}),"\xA0",(0,c.jsx)(Pr.Z,{style:{marginTop:"3px"},className:"common-animation-arrow ".concat(_e&&"common-animation-arrow-active")})]}),(0,c.jsx)("div",{style:{display:_e?"block":"none"},children:Tn(u,"after_script","150px",!1)})]})},pn=function(u,te,_e,fe){var Ve=u.placeholder,gr=u.api,Wr=qe.getFieldValue(fe),nn=fe?o()({},fe,Wr):{};if(fe&&!Wr){jr.current[te]=[],Tr.current=!1;return}return jr.current&&(Tr.current||jr.current[te]===void 0)&&(Cn(p()(p()({},gr),{},{params:p()(p()({},gr==null?void 0:gr.params),nn)}),te,_e),jr.current[te]=[],Tr.current=!1),(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(or.Z.Item,{noStyle:!0,name:te,children:(0,c.jsx)(Ke.Z,p()({allowClear:!0,showSearch:!0,optionFilterProp:"children",filterOption:function(Er,Yr){var Bn;return((Bn=Yr==null?void 0:Yr.label)!==null&&Bn!==void 0?Bn:"").toLocaleLowerCase().includes(Er.toLocaleLowerCase())},options:jr.current[te]||[]},u))}),(0,c.jsx)("div",{onClick:function(){return _n(gr,te,_e)},className:"credential-refresh",ref:kr,children:(0,c.jsx)(Kr.Z,{style:{color:"#9f9999",cursor:"pointer"}})})]})},sa=function(u,te,_e){return(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(On,{component:u,name:te,formItemConfig:_e,form:qe,config:cr,forceUpdate:en})})},Zn=function(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},te=arguments.length>1?arguments[1]:void 0,_e=arguments.length>2?arguments[2]:void 0;Kn(te,""),Kn("variables.git_url",u.url),Kn("variables.repoId",u.id),setTimeout(function(){qe.setFieldValue("git_url",u.url),qe.setFieldValue("repoId",u.id)},100)},Qn=function(u,te){if(u){var _e=u.split(".").reduce(function(fe,Ve,gr,Wr){return gr!==Wr.length-1&&!fe[Ve]&&(fe[Ve]={}),fe[Ve]},cr);return _e}else cr[te]},Kn=function(u,te){u.includes(".")?u.split(".").reduce(function(_e,fe,Ve,gr){return Ve===gr.length-1&&(_e[fe]=te),_e[fe]},cr):cr[u]=te},Gn=function(u){var te=u.formItemConfig,_e=u.repoType,fe=u.fieldLevel,Ve=u.clearBranchField,gr="";fe&&(gr=Qn(fe));var Wr=Qn("variables.git_url");return(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(Hr,p()(p()({},te),{},{repoType:_e,repoChange:function(){for(var cn=arguments.length,Er=new Array(cn),Yr=0;Yr<cn;Yr++)Er[Yr]=arguments[Yr];return Zn.apply(void 0,Er.concat([Ve,fe]))},initialValue:gr,isCopy:!0,form:qe,url:Wr}))})},aa=function(u){var te=u.formItemConfig,_e=u.repoType,fe=u.fieldLevel,Ve=u.repoIdField,gr=u.componentConfig,Wr=u.customizeButton;return(0,c.jsx)(or.Z.Item,{shouldUpdate:function(cn,Er){return cn.repoId!==Er.repoId},style:{width:"100%"},children:function(){var cn,Er,Yr=qe.getFieldValue("repoName"),Bn=qe.getFieldValue("repoId")||((cn=cr.variables)===null||cn===void 0?void 0:cn.repoId),ta=(Er=cr.variables)===null||Er===void 0?void 0:Er.ref;return(0,c.jsx)(Te,{name:"ref",repoType:_e,repoId:Bn,repoName:Yr,initialValue:null,currentDefaultValue:ta,componentConfig:gr,form:qe,config:cr,customizeButton:Wr,type:Ye})}})};return An(),(0,c.jsx)("div",{className:"task-config-gitlab-container",children:ue.map(function(br){return yr(br)})})}var Qe=(0,L.forwardRef)(V)},12627:function(lr,I,r){r.d(I,{Z:function(){return Ke}});var Me=r(97857),o=r.n(Me),Ce=r(9783),p=r.n(Ce),Cr=r(19632),x=r.n(Cr),ur=r(5574),m=r.n(ur),n=r(62435),De=r(81182),Mr=r(96456),Be=r(52745),L=r(24969),Xe=r(86074);function or(mr,Ur){var ln=mr.keys,Pr=ln===void 0?"name":ln,Kr=mr.value,Xr=mr.form,In=mr.type,En=mr.prefixLeft,dn=En===void 0?"key\uFF1A":En,Pn=mr.prefixRight,fn=Pn===void 0?"value\uFF1A":Pn,vn=mr.formCOnfig,tn=vn===void 0?{}:vn,je=mr.keyValueChange,vr=je===void 0?function(){}:je,e=(0,n.useState)([]),xn=m()(e,2),i=xn[0],Un=xn[1],c=(0,n.useRef)(null);(0,n.useImperativeHandle)(Ur,function(){return{getValue:Yn,setValue:kn}}),(0,n.useEffect)(function(){c.current.initLoad&&vr(i),c.current.initLoad=!0},[i]);var Yn=function(){return i},kn=function(ae){Un(x()(ae).map(function(de){return de.id=Math.random(),de}))},Hr=function(ae,de,We){i[ae][de]=We,Un(x()(i)),Xr.validateFields()},Le=function(){i.push(p()(p()(p()({},Pr,""),Kr,""),"id",Math.random())),Un(x()(i)),Xr.validateFields(["custom_env"])},le=function(ae){i.splice(ae,1),Un(x()(i)),Xr.validateFields()},W=function(ae){var de=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(!de.trim())return Promise.reject("\u8BF7\u8F93\u5165");var We=i.map(function($r){return $r.label=Xr.getFieldValue($r.id),$r}),Or=Re(We);if(Or)for(var Qr=We.filter(function($r){return $r.label===Or}),qr=0;qr<Qr.length;qr++){var jn=Qr[qr].id+"";if(ae.field===jn)return Promise.reject("\u540D\u79F0\u91CD\u590D")}return Promise.resolve()};function Re(Fe){for(var ae=new Map,de=0;de<Fe.length;de++){var We=Fe[de].label;if(ae.has(We))return We;ae.set(We,!0)}return null}var pr=function(ae,de){return Promise.resolve()},Te=function(){return i.length<=0?Promise.reject("\u8BF7\u81F3\u5C11\u586B\u5199\u4E00\u4E2A\u6807\u7B7E"):Promise.resolve()};return(0,Xe.jsx)(De.Z.Item,o()(o()({},tn),{},{rules:[{validator:Te}],required:!0,style:{margin:"0"},className:"common-form-keyVdalue-container",children:(0,Xe.jsx)("div",{className:"control-box",ref:c,children:(0,Xe.jsx)("div",{className:"form-control",children:(0,Xe.jsxs)("ul",{className:"common-form-flow-key-value-container",children:[i.map(function(Fe,ae){return(0,Xe.jsxs)("li",{className:"item flex-space-around",style:{alignItems:"flex-start"},children:[(0,Xe.jsx)(De.Z.Item,{name:"".concat(Fe.id),style:{width:Kr?"45%":"95%",margin:"0"},rules:[{validator:W}],initialValue:Fe[Pr],children:(0,Xe.jsx)(Mr.Z,{prefix:"".concat(dn),value:Fe[Pr],onChange:function(We){return Hr(ae,Pr,We.target.value)},placeholder:"",maxLength:50})}),Kr&&(0,Xe.jsx)(De.Z.Item,{name:"".concat(Fe.id,"-concurrent"),style:{width:"45%",margin:"0"},rules:[{validator:pr}],initialValue:Fe[Kr],children:(0,Xe.jsx)(Mr.Z,{prefix:"".concat(fn),value:Fe[Kr],onChange:function(We){return Hr(ae,Kr,We.target.value)},placeholder:""})}),In===1&&(0,Xe.jsx)("div",{className:"minus flex-center",onClick:function(){return le(ae)},children:(0,Xe.jsx)(Be.Z,{})})]},ae)}),In===1&&(0,Xe.jsxs)("div",{className:"flex-center",style:{margin:"10px 0"},children:[(0,Xe.jsx)("div",{className:"plus flex-center",onClick:function(){return Le()},children:(0,Xe.jsx)(L.Z,{})}),"\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0"]})]})})})}))}var Ke=(0,n.forwardRef)(or)},48807:function(lr,I,r){r.d(I,{Z:function(){return or}});var Me=r(9783),o=r.n(Me),Ce=r(19632),p=r.n(Ce),Cr=r(5574),x=r.n(Cr),ur=r(62435),m=r(81182),n=r(96456),De=r(48115),Mr=r(52745),Be=r(24969),L=r(86074);function Xe(Ke,mr){var Ur=Ke.from,ln=Ke.keys,Pr=ln===void 0?"key":ln,Kr=Ke.value,Xr=Kr===void 0?"value":Kr,In=Ke.form,En=Ke.type,dn=(0,ur.useState)([]),Pn=x()(dn,2),fn=Pn[0],vn=Pn[1],tn=(0,ur.useState)(!0),je=x()(tn,2),vr=je[0],e=je[1];(0,ur.useImperativeHandle)(mr,function(){return{getValue:xn,setValue:i}});var xn=function(){return fn},i=function(Le){vn(p()(Le))},Un=function(Le,le,W){fn[Le][le]=W,vn(p()(fn))},c=function(){fn.push(o()(o()({},Pr,""),Xr,"")),vn(p()(fn)),In.validateFields(["custom_env"])},Yn=function(Le){fn.splice(Le,1),vn(p()(fn)),In.validateFields(["custom_env"])},kn=function(){for(var Le=xn(),le=0;le<Le.length;le++){var W=Le[le];if(!W.key)return Promise.reject(new Error("\u8BF7\u586B\u5199 key"));if(!W.value)return Promise.reject(new Error("\u8BF7\u586B\u5199 value"))}return Promise.resolve()};return En!==1&&fn.length<=0?(0,L.jsx)(L.Fragment,{}):(0,L.jsx)(m.Z.Item,{label:"",name:"custom_env",rules:[{required:!0,message:""},{validator:kn}],initialValue:"1",className:"task-config-AddKeyValue-container",children:(0,L.jsxs)("div",{className:"control-box",children:[(0,L.jsxs)("div",{className:"control flex-space-between",onClick:function(){return e(!vr)},children:["\u8F93\u5165\u73AF\u5883\u53D8\u91CF",(0,L.jsx)(De.Z,{className:"control-arrow ".concat(!vr&&"control-arrow-action")})]}),(0,L.jsx)("div",{className:"form-control",style:{display:vr?"block":"none"},children:(0,L.jsxs)("ul",{className:"flow-add-key-value-container",children:[fn.map(function(Hr,Le){return(0,L.jsxs)("li",{className:"item flex-space-around",children:[(0,L.jsx)(n.Z,{prefix:"".concat(Pr,"\uFF1A"),style:{width:"45%"},value:Hr[Pr],onChange:function(W){return Un(Le,Pr,W.target.value)}}),(0,L.jsx)(n.Z,{prefix:"".concat(Xr,"\uFF1A"),style:{width:"45%"},value:Hr[Xr],onChange:function(W){return Un(Le,Xr,W.target.value)}}),Ur===1&&(0,L.jsx)(L.Fragment,{children:(0,L.jsx)("div",{className:"minus flex-center",onClick:function(){return Yn(Le)},children:(0,L.jsx)(Mr.Z,{})})})]},Le)}),Ur===1&&(0,L.jsx)("div",{className:"plus flex-center",onClick:function(){return c()},children:(0,L.jsx)(Be.Z,{})})]})})]})})}var or=(0,ur.forwardRef)(Xe)},88219:function(lr,I,r){r.d(I,{Z:function(){return pr}});var Me=r(97857),o=r.n(Me),Ce=r(13769),p=r.n(Ce),Cr=r(5574),x=r.n(Cr),ur=r(62435),m=r(96456),n=r(81182),De=r(84567),Mr=r(68351),Be=r(78045),L=r(78957),Xe=r(94060),or=r(75440),Ke=r(77683),mr=r(50888),Ur=r(94668),ln=r(48115),Pr=r(52745),Kr=r(24969),Xr=r(9783),In=r.n(Xr),En=r(15009),dn=r.n(En),Pn=r(99289),fn=r.n(Pn),vn=r(23279),tn=r.n(vn),je=r(74330),vr=r(32983),e=r(81492),xn=function(Fe){return(0,e.Z)("/api/devices/info/find_user",{method:"get",params:Fe})},i=r(86074);function Un(Te){var Fe=Te.selectProps,ae=Fe===void 0?{}:Fe,de=Te.formItem,We=de===void 0?{}:de,Or=Te.form,Qr=Te.isInitLoad,qr=Te.nameField,jn=qr===void 0?"name":qr,$r=Te.idField,Mn=$r===void 0?"id":$r,On=(0,ur.useState)([]),yn=x()(On,2),un=yn[0],V=yn[1],Qe=(0,ur.useState)(!1),k=x()(Qe,2),xr=k[0],qe=k[1],cr=(0,ur.useState)(""),Lr=x()(cr,2),ue=Lr[0],Ye=Lr[1];(0,ur.useEffect)(function(){},[]);var Br=function(){var Ir=fn()(dn()().mark(function ge(){var kr,jr,He=arguments;return dn()().wrap(function(hr){for(;;)switch(hr.prev=hr.next){case 0:if(kr=He.length>0&&He[0]!==void 0?He[0]:"",Ye(kr),kr){hr.next=5;break}return V([]),hr.abrupt("return");case 5:return qe(!0),hr.prev=6,hr.next=9,xn({username:kr});case 9:jr=hr.sent,V(jr.map(function(en){return en.value=en.user_id,en.label=en.username,en})),hr.next=16;break;case 13:hr.prev=13,hr.t0=hr.catch(6),console.log(hr.t0);case 16:return hr.prev=16,qe(!1),hr.finish(16);case 19:case"end":return hr.stop()}},ge,null,[[6,13,16,19]])}));return function(){return Ir.apply(this,arguments)}}(),on=tn()(Br,500),Dn=function(){return xr?(0,i.jsx)(je.Z,{indicator:(0,i.jsx)(mr.Z,{})}):ue&&un.length===0?(0,i.jsx)(vr.Z,{image:vr.Z.PRESENTED_IMAGE_SIMPLE}):"\u53EF\u8F93\u5165\u5173\u952E\u5B57\u641C\u7D22"},zr=function(ge,kr){if(ae.mode==="multiple"){var jr=[];Array.isArray(ge)&&ge.forEach(function(He){var Jr=He.split(" ");jr.push(In()(In()({},jn,Jr[0]),Mn,Jr[1]))}),Or.setFieldValue("userValue",jr)}};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.Z.Item,{name:"userValue",noStyle:!0}),(0,i.jsx)(n.Z.Item,o()(o()({},We),{},{children:(0,i.jsx)(Xe.Z,o()(o()({allowClear:!0,placeholder:"\u9009\u62E9\u6267\u884C\u4EBA",showSearch:!0,optionFilterProp:"children",filterOption:!1,onSearch:function(ge){return on(ge)},notFoundContent:Dn(),onChange:zr},ae),{},{children:un==null?void 0:un.map(function(Ir){return(0,i.jsx)(Option,{value:"".concat(Ir.label," ").concat(Ir.value),children:(0,i.jsxs)("div",{className:"demo-option-label-item",title:"".concat(Ir.label," ").concat(Ir.user_id),children:[(0,i.jsx)("span",{role:"img","aria-label":"China",children:Ir.label}),(0,i.jsxs)("span",{children:["\xA0\xA0\xA0",Ir.user_id]})]},"".concat(Ir.label,"-").concat(Ir.user_id))})})}))}))]})}var c=Un,Yn=r(88026),kn=r(9646),Hr=r(30381),Le=r.n(Hr),le=["key","name"],W=m.Z.TextArea;function Re(Te){var Fe,ae=Te.form,de=Te.from,We=Te.config,Or=Te.onValuesChange,Qr=Te.close,qr=(0,Yn.useModel)("@@initialState"),jn=qr.initialState,$r=jn.currentUser,Mn=$r===void 0?{}:$r,On=(0,ur.useState)({}),yn=x()(On,2),un=yn[0],V=yn[1],Qe=(0,ur.useState)(!0),k=x()(Qe,2),xr=k[0],qe=k[1],cr=(0,ur.useState)(!1),Lr=x()(cr,2),ue=Lr[0],Ye=Lr[1],Br=n.Z.useForm(),on=x()(Br,1),Dn=on[0],zr=(0,ur.useRef)(null),Ir=(0,ur.useRef)(null);(0,ur.useEffect)(function(){We.variables.periodic&&Ye(!0)},[]);var ge=function(dr){var Q=(0,i.jsxs)("span",{children:["\u5F85\u5BA1\u6838 \xA0",(0,i.jsx)(mr.Z,{})]}),Je="#459fff";switch(dr){case"PASS":Q=(0,i.jsx)("span",{children:"\u901A\u8FC7"}),Je="#4dcb4f";break;case"REJECT":Q=(0,i.jsx)("span",{children:"\u9A73\u56DE"}),Je="#ff5656";break;case"TIMEOUT":Q=(0,i.jsx)("span",{children:"\u8D85\u65F6"}),Je="#ff5656";break}return un.result!=="PENDING"&&dr==="PENDING"&&(Q=(0,i.jsx)("span",{children:"-"})),(0,i.jsx)("span",{style:{color:Je},children:Q})},kr=function(dr){var Q=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],Je=ae.getFieldValue("direct_leader");return Je?Promise.resolve():Q.length<=0?Promise.reject("\u8BF7\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A\u64CD\u4F5C\u4EBA"):Promise.resolve()},jr=function(dr){var Q=/^\$\{[\s\S]*?\}$/;return Q.test(dr)},He=function(dr){var Q=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];if(de===3)return Promise.resolve();var Je=ae.getFieldValue("direct_leader");return Je?Promise.resolve():!Q||Q.length<=0||!jr(Q)?Promise.reject("\u8BF7\u8F93\u5165 ${xxx} \u683C\u5F0F"):Promise.resolve()},Jr=function(dr,Q){var Je=ae.getFieldValue("periodic");if(Je)return Promise.resolve();if(!Q)return Promise.reject("\u8BF7\u9009\u62E9\u4EFB\u52A1\u65F6\u957F\u65F6\u95F4");var Vr=Le()(),he=Le()(Q);return Vr.isAfter(he)?Promise.reject("\u9700\u5927\u4E8E\u5F53\u524D\u65F6\u95F4"):Promise.resolve()};function hr(yr){return yr&&yr<Le()().startOf("day")}var en=function(dr,Q){var Je=ae.getFieldValue("periodic");if(Je)return Promise.resolve();var Vr=ae.getFieldValue("review_day"),he=ae.getFieldValue("review_hour"),t=ae.getFieldValue("review_minute"),_=Vr+he+t;return _<=0?Promise.reject("\u81F3\u5C11\u5927\u4E8E0"):Promise.resolve()},Tr=function(){return(0,i.jsxs)("div",{className:"flex-space-between",style:{padding:"0 4px"},children:[(0,i.jsx)("div",{children:"\u5929"}),(0,i.jsx)("div",{children:"\u5C0F\u65F6"}),(0,i.jsx)("div",{children:"\u5206\u949F"})]})},mn=function(dr,Q,Je,Vr){dr.stopPropagation(),Q(Vr),ae.validateFields()},An=function(dr){dr(),setTimeout(function(){ae.validateFields()},200)},_n=function(dr,Q){var Je=/^[1-9]\d*$/;return!Je.test(Q)||Q>10?Promise.reject("1~10\u6574\u6570"):Promise.resolve()},Cn=function(){var dr=ae.getFieldValue("periodic"),Q=ae.getFieldValue("week_interval");return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.Z.Item,{name:"periodic",valuePropName:"checked",style:{marginBottom:"0"},children:(0,i.jsx)(De.Z,{onChange:function(Vr){ae.validateFields(["confirm_expire_date","expired_at_date"]),Ye(Vr.target.checked)},children:"\u5468\u671F\u4EFB\u52A1"})}),dr&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"common-form-required",style:{width:"80px"},children:"\u4EFB\u52A1\u65F6\u95F4"}),(0,i.jsx)(n.Z.Item,{label:"",name:"hour_minute",rules:[{required:!0,message:"\u8BF7\u9009\u62E9"}],children:(0,i.jsx)(Mr.Z,{format:"HH:mm"})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"common-form-required",style:{width:"80px"},children:"\u5B9A\u671F\u6A21\u5F0F"}),(0,i.jsxs)("div",{className:"flex-start",style:{alignItems:"flex-start"},children:[(0,i.jsx)(n.Z.Item,{label:"",name:"by",rules:[{required:!0,message:"\u8BF7\u9009\u62E9"}],initialValue:"week",style:{margin:0},children:(0,i.jsx)(Be.ZP.Group,{children:(0,i.jsx)(L.Z,{direction:"vertical",children:(0,i.jsx)(Be.ZP,{value:"week",children:"\u5468"})})})}),(0,i.jsx)("div",{children:(0,i.jsxs)("div",{className:"flex-start",style:{alignItems:"flex-start"},children:[(0,i.jsx)("div",{style:{marginTop:"7px"},children:"\u91CD\u590D\u95F4\u9694\u4E3A(C)\xA0"}),(0,i.jsx)(n.Z.Item,{initialValue:2,name:"week_interval",style:{margin:0},rules:[{required:!0,message:""},{validator:_n}],children:(0,i.jsx)(m.Z,{placeholder:"1~10",style:{width:"55px"},onChange:function(Vr){var he=Vr.target.value;(!he||he>10)&&(ae.setFieldValue("week_index_week_day",void 0),We.variables.week_index_week_day=void 0)}})}),(0,i.jsx)("div",{style:{marginTop:"7px"},children:"\xA0\u5468\u540E\u7684"})]})})]}),(0,i.jsx)("div",{children:(0,i.jsx)(n.Z.Item,{name:"week_index_week_day",rules:[{required:!0,message:"\u8BF7\u9009\u62E9"}],children:(0,i.jsx)(Be.ZP.Group,{children:Q&&Q<=10&&Array.from({length:Q}).map(function(Je,Vr){return(0,i.jsxs)("div",{children:[(0,i.jsx)(Be.ZP,{className:"first-title",children:(0,i.jsxs)("b",{children:["\u7B2C",Vr+1,"\u5468"]})}),kn.Wm.map(function(he){return(0,i.jsx)(Be.ZP,{value:"".concat(Vr+1,"-").concat(he.value),children:he.label})})]})})})})})]})]})]})};return(0,i.jsxs)("div",{ref:zr,className:"stepConfig-review-container",children:[(0,i.jsx)(n.Z.Item,{noStyle:!0,shouldUpdate:!0,children:function(){var dr=ae.getFieldValue("from_trigger_env"),Q=de===3||ae.getFieldValue("direct_leader");return(0,i.jsxs)("div",{className:"flex-space-between",children:[dr?(0,i.jsx)(n.Z.Item,{name:"users",label:"\u64CD\u4F5C\u4EBA",style:{flex:1,marginBottom:"13px"},rules:[{required:!Q,message:"\u683C\u5F0F\u9519\u8BEF",validator:He}],children:(0,i.jsx)(m.Z,{disabled:Q,placeholder:"\u81EA\u5B9A\u4E49\u683C\u5F0F\u4E3A ${x}",style:{height:"32px"}})}):(0,i.jsx)(c,{formItem:{label:"\u64CD\u4F5C\u4EBA",name:"users",rules:[{required:!Q,message:""},{validator:kr}],style:{marginBottom:"13px",flex:1}},selectProps:{mode:"multiple",placeholder:"\u8BF7\u9009\u62E9\u64CD\u4F5C\u4EBA",disabled:Q},form:ae,isInitLoad:!0,idField:"user_id"}),"\xA0\xA0",(0,i.jsx)(n.Z.Item,{label:"",name:"from_trigger_env",style:{marginTop:"16px"},valuePropName:"checked",initialValue:!1,children:(0,i.jsx)(De.Z,{disabled:Q,onChange:function(Vr){We.variables.users=void 0,We.variables.userValue=void 0,ae.setFieldValue("users",void 0),ae.setFieldValue("userValue",void 0)},children:"\u81EA\u5B9A\u4E49"})})]})}}),(We==null||(Fe=We.atom_name)===null||Fe===void 0?void 0:Fe.startsWith("\u4EBA\u5DE5\u4EFB\u52A1"))&&(0,i.jsx)(n.Z.Item,{name:"event",label:"\u7C7B\u578B",initialValue:"task",style:{marginBottom:"10px"},children:(0,i.jsxs)(Be.ZP.Group,{children:[(0,i.jsx)(Be.ZP,{value:"task",children:"\u64CD\u4F5C"}),(0,i.jsx)(Be.ZP,{value:"approve",children:"\u5BA1\u6279"})]})}),(0,i.jsx)(n.Z.Item,{noStyle:!0,shouldUpdate:!0,children:function(){var dr=ae.getFieldValue("confirm_expire"),Q=ae.getFieldValue("expire_type"),Je="\u4EFB\u52A1\u65F6\u957F",Vr=Le()(dr).format("HH:mm"),he=Le().duration(Vr).asMinutes(),t=ae.getFieldValue("confirm_expire_button");return he>0&&Q===1&&(Je="\u4EFB\u52A1\u65F6\u957F\uFF08".concat(Le()(dr).format("HH"),"\u5C0F\u65F6").concat(Le()(dr).format("mm"),"\u5206\u949F\uFF09")),(0,i.jsxs)("div",{style:{border:"1px solid #eee",padding:"5px 10px",marginBottom:"10px"},children:[(0,i.jsx)(n.Z.Item,{label:Je,style:{width:"100%",marginBottom:"0"},children:(0,i.jsxs)("div",{className:"flex-start",children:[(0,i.jsx)(n.Z.Item,{name:"expire_type",noStyle:!0,initialValue:"never",style:{width:"28%"},children:(0,i.jsxs)(Be.ZP.Group,{disabled:ue,children:[(0,i.jsx)(Be.ZP,{value:"never",children:"\u65E0\u8D85\u65F6"}),(0,i.jsx)(Be.ZP,{value:"duration",children:"\u65F6\u95F4\u6BB5"}),(0,i.jsx)(Be.ZP,{value:"timestamp",children:"\u65F6\u95F4\u70B9"})]})}),Q==="duration"&&(0,i.jsx)(i.Fragment,{children:t===1?(0,i.jsx)(n.Z.Item,{name:"confirm_expire_var",noStyle:!0,rules:[{required:!0,message:"\u8BF7\u8F93\u5165"}],children:(0,i.jsx)(m.Z,{placeholder:"\u8BF7\u8F93\u5165",style:{width:"44%",height:"32px"},disabled:ue})}):(0,i.jsxs)(n.Z.Item,{name:"confirm_expire_date",noStyle:!0,required:!0,rules:[{validator:en}],style:{width:"100%"},children:[(0,i.jsxs)("div",{className:"flex-start",children:[(0,i.jsx)(n.Z.Item,{name:"review_day",initialValue:0,style:{width:"50px",margin:0},children:(0,i.jsx)(Xe.Z,{disabled:ue,options:kn.v0,size:"small",onChange:function(){return ae.validateFields(["confirm_expire_date"])}})}),"\xA0\u5929\xA0"]}),(0,i.jsxs)("div",{className:"flex-start",children:[(0,i.jsx)(n.Z.Item,{name:"review_hour",initialValue:0,style:{width:"50px",margin:0},children:(0,i.jsx)(Xe.Z,{disabled:ue,options:kn.xO,size:"small",onChange:function(){return ae.validateFields(["confirm_expire_date"])}})}),"\xA0\u5C0F\u65F6\xA0"]}),(0,i.jsxs)("div",{className:"flex-start",children:[(0,i.jsx)(n.Z.Item,{name:"review_minute",initialValue:0,style:{width:"50px",margin:0},children:(0,i.jsx)(Xe.Z,{disabled:ue,options:kn.Z7,size:"small",onChange:function(){return ae.validateFields(["confirm_expire_date"])}})}),"\xA0\u5206\u949F\xA0"]})]})}),Q==="timestamp"&&(0,i.jsx)(i.Fragment,{children:t===1?(0,i.jsx)(n.Z.Item,{name:"expired_at_var",noStyle:!0,rules:[{required:!0,message:"\u8BF7\u8F93\u5165"}],children:(0,i.jsx)(m.Z,{disabled:ue,placeholder:"\u8BF7\u8F93\u5165",style:{width:"44%",height:"32px"}})}):(0,i.jsx)(n.Z.Item,{name:"expired_at_date",noStyle:!0,rules:[{required:!1,message:""},{validator:Jr}],children:(0,i.jsx)(or.default,{disabled:ue,style:{width:"44%"},showTime:{format:"HH:mm"},format:"YYYY-MM-DD HH:mm",disabledDate:hr,allowClear:!1})})}),Q!=="never"&&(0,i.jsxs)(i.Fragment,{children:["\xA0\xA0\xA0",(0,i.jsx)(n.Z.Item,{name:"confirm_expire_button",noStyle:!0,initialValue:2,children:(0,i.jsx)(Ke.ZP,{disabled:ue,style:{padding:"5px"},icon:(0,i.jsx)(Ur.Z,{}),onClick:function(){var A=t===1?2:1;We.variables.confirm_expire_button=A,ae.setFieldValue("confirm_expire_button",A)},children:t===1?"\u65F6\u95F4":"\u53D8\u91CF"})})]})]})}),Cn()]})}}),(0,i.jsx)(n.Z.Item,{noStyle:!0,shouldUpdate:!0,children:function(){var dr=ae.getFieldValue("expire_type"),Q=ae.getFieldValue(dr==="never"?"remind_every":"remind_again_at")||60,Je=kn.Vh.find(function(Vr){return Vr.value===Q});return dr==="never"?(0,i.jsx)(i.Fragment,{}):(0,i.jsx)(n.Z.Item,{name:"remind_again_at",label:"\u8DDD\u79BB\u622A\u6B62\u65E5\u671F".concat(Je==null?void 0:Je.label,"\u524D\u518D\u6B21\u63D0\u9192"),initialValue:60,children:(0,i.jsx)(Xe.Z,{options:kn.Vh})})}}),(0,i.jsx)(n.Z.Item,{name:"confirm_description",label:"\u64CD\u4F5C\u8BF4\u660E",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u64CD\u4F5C\u8BF4\u660E"}],children:(0,i.jsx)(W,{placeholder:"\u8BF7\u586B\u5199\u64CD\u4F5C\u8BF4\u660E",autoSize:{minRows:2,maxRows:14}})}),(0,i.jsx)(n.Z.Item,{name:"confirm_rule",label:"\u9A8C\u8BC1\u8005\u65B9\u5F0F",initialValue:"OR",children:(0,i.jsxs)(Be.ZP.Group,{children:[(0,i.jsx)(Be.ZP,{value:"OR",children:"\u6216\u7B7E\uFF08\u4E00\u540D\u5BA1\u6279\u4EBA\u540C\u610F\u6216\u62D2\u7EDD\u5373\u53EF\uFF09"}),(0,i.jsx)(Be.ZP,{value:"AND",children:"\u4F1A\u7B7E\uFF08\u987B\u6240\u6709\u5BA1\u6279\u4EBA\u540C\u610F\uFF09"})]})}),(0,i.jsx)(n.Z.Item,{name:"archive_comments",label:"",initialValue:!1,valuePropName:"checked",children:(0,i.jsx)(De.Z,{children:"\u5C06\u8BC4\u8BBA\u5F52\u6863\u5230\u6784\u5EFA\u7ED3\u679C"})}),(0,i.jsxs)("div",{className:"control-box flow-add-key-value-container ",children:[(0,i.jsxs)("div",{className:"control flex-space-between",onClick:function(){return qe(!xr)},children:["\u8FD0\u884C\u65F6\u73AF\u5883\u53D8\u91CF",(0,i.jsx)(ln.Z,{className:"control-arrow ".concat(!xr&&"control-arrow-action")})]}),(0,i.jsx)("div",{className:"form-control",style:{display:xr?"block":"none"},children:(0,i.jsx)(n.Z.List,{name:"runtime_var",children:function(dr,Q){var Je=Q.add,Vr=Q.remove;return(0,i.jsxs)(i.Fragment,{children:[dr.map(function(he,t){var _=he.key,A=he.name,X=p()(he,le);return(0,i.jsxs)("div",{className:"item-runtime_var",children:[(0,i.jsxs)("div",{className:"flex-space-between",style:{alignItems:"flex-start",marginBottom:"5px"},children:[(0,i.jsx)(n.Z.Item,o()(o()({},X),{},{name:[A,"key"],initialValue:"",rules:[{required:!0,message:"\u8BF7\u8F93\u5165"}],style:{marginBottom:"0px",width:"26%"},children:(0,i.jsx)(m.Z,{prefix:"key:",maxLength:100})})),(0,i.jsx)(n.Z.Item,o()(o()({},X),{},{name:[A,"display_name"],initialValue:"",style:{marginBottom:"0px",width:"34%"},children:(0,i.jsx)(m.Z,{prefix:"\u663E\u793A\u540D\u79F0:",maxLength:100})})),(0,i.jsx)(n.Z.Item,o()(o()({},X),{},{name:[A,"required"],initialValue:"",label:"",valuePropName:"checked",style:{marginBottom:"0px"},children:(0,i.jsx)(De.Z,{children:"\u5FC5\u586B"})})),(0,i.jsx)(n.Z.Item,o()(o()({},X),{},{name:[A,"is_summarized"],initialValue:!1,label:"",style:{margin:"0px"},valuePropName:"checked",children:(0,i.jsx)(De.Z,{children:"\u52A0\u5165\u6784\u5EFA\u7ED3\u679C"})})),de===1&&(0,i.jsx)("div",{className:"minus flex-center",onClick:function(Ar){return mn(Ar,Vr,t,A)},children:(0,i.jsx)(Pr.Z,{})})]}),(0,i.jsx)(n.Z.Item,o()(o()({},X),{},{name:[A,"description"],initialValue:"",label:"\u63CF\u8FF0",style:{marginBottom:"0px"},children:(0,i.jsx)(W,{maxLength:100,autoSize:{minRows:1,maxRows:4}})}))]})}),(0,i.jsx)(n.Z.Item,{children:de===1&&(0,i.jsx)("div",{className:"plus flex-center",onClick:function(){return An(Je)},children:(0,i.jsx)(Kr.Z,{})})})]})}})})]}),de===3&&(0,i.jsx)(i.Fragment,{})]})}var pr=Re},38592:function(lr,I,r){r.d(I,{Z:function(){return le}});var Me=r(52677),o=r.n(Me),Ce=r(15009),p=r.n(Ce),Cr=r(99289),x=r.n(Cr),ur=r(5574),m=r.n(ur),n=r(62435),De=r(96456),Mr=r(81182),Be=r(74330),L={required:!0,message:"\u8BF7\u9009\u62E9\u89E6\u53D1\u6D41\u6C34\u7EBF",style:{width:"100%",marginBottom:"5px"},name:"selected_pipeline",label:"\u89E6\u53D1\u6D41\u6C34\u7EBF\uFF08\u652F\u6301\u6D41\u6C34\u7EBF\u540D\u5B57\u641C\u7D22\uFF09",initialValue:[]},Xe={type:"remoteSearchSelect",placeholder:"\u89E6\u53D1\u6D41\u6C34\u7EBF uuid",api:{method:"get",path:"/api/pipeline/config/list",params:{size:10,page_num:1}},optionValue:"uuid",optionLabel:"name",searchField:"name"},or=r(88026),Ke=r(19632),mr=r.n(Ke),Ur=r(9783),ln=r.n(Ur),Pr=r(97857),Kr=r.n(Pr),Xr=r(23279),In=r.n(Xr),En=r(32983),dn=r(94060),Pn=r(84567),fn=r(50888),vn=r(81492),tn=function(Re,pr){return(0,vn.Z)("".concat(Re),{method:"get",params:pr})},je=r(86074);function vr(W,Re){var pr=W.selectProps,Te=pr===void 0?{}:pr,Fe=W.name,ae=W.component,de=ae===void 0?{}:ae,We=W.formItemConfig,Or=We===void 0?{}:We,Qr=W.config,qr=W.forceUpdate,jn=W.form,$r=W.onChange,Mn=(0,n.useState)([]),On=m()(Mn,2),yn=On[0],un=On[1],V=(0,n.useState)(!1),Qe=m()(V,2),k=Qe[0],xr=Qe[1],qe=(0,n.useState)(""),cr=m()(qe,2),Lr=cr[0],ue=cr[1],Ye=(0,n.useRef)([]);(0,n.useImperativeHandle)(Re,function(){return{init:Br}});var Br=function(){var jr=jn.getFieldValue(Fe);on(jr,"load")},on=function(){var kr=x()(p()().mark(function jr(){var He,Jr,hr,en,Tr,mn,An,_n,Cn,yr=arguments;return p()().wrap(function(Q){for(;;)switch(Q.prev=Q.next){case 0:if(He=yr.length>0&&yr[0]!==void 0?yr[0]:"",Jr=yr.length>1?yr[1]:void 0,ue(He),!(!He&&Jr!=="load")){Q.next=6;break}return un([]),Q.abrupt("return");case 6:return xr(!0),Q.prev=7,Tr=Jr==="load"&&de.optionValue||de.searchField,mn=He,Array.isArray(mn)&&(mn=null),An=Kr()(ln()({},Tr,mn),de==null||(hr=de.api)===null||hr===void 0?void 0:hr.params),An[Tr]||delete An[Tr],Q.next=15,tn(de==null||(en=de.api)===null||en===void 0?void 0:en.path,An);case 15:_n=Q.sent,Cn=Array.isArray(_n)?_n:Array.isArray(_n.data)?_n.data:_n.data.data,Ye.current=[].concat(mr()(Ye.current),mr()(Cn)),un(Cn),Q.next=24;break;case 21:Q.prev=21,Q.t0=Q.catch(7),console.log(Q.t0);case 24:return Q.prev=24,xr(!1),Q.finish(24);case 27:case"end":return Q.stop()}},jr,null,[[7,21,24,27]])}));return function(){return kr.apply(this,arguments)}}(),Dn=In()(on,500),zr=function(){return k?(0,je.jsx)(Be.Z,{indicator:(0,je.jsx)(fn.Z,{})}):Lr&&yn.length===0?(0,je.jsx)(En.Z,{image:En.Z.PRESENTED_IMAGE_SIMPLE}):"\u53EF\u8F93\u5165\u5173\u952E\u5B57\u641C\u7D22"},Ir=function(jr){var He=/^\$\{[\s\S]*?\}$/;return He.test(jr)},ge=function(jr){var He=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return!He||He.length<=0||!Ir(He)?Promise.reject("\u683C\u5F0F\u9519\u8BEF"):Promise.resolve()};return(0,je.jsx)("div",{className:"flex-space-between",style:{width:"100%"},children:(0,je.jsx)(Mr.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(){var jr=Or.dependencyField?jn.getFieldValue(Or.dependencyField):"";return(0,je.jsxs)(je.Fragment,{children:[jr?(0,je.jsx)(Mr.Z.Item,Kr()(Kr()({},Or),{},{rules:[{required:!0,message:""},{validator:ge}],style:{flex:1},children:(0,je.jsx)(De.Z,{placeholder:"\u81EA\u5B9A\u4E49\u683C\u5F0F\u4E3A ${x}",style:{height:"32px"},onChange:function(Jr){return $r(Jr.target.value,"input")}})})):(0,je.jsx)(Mr.Z.Item,Kr()(Kr()({rules:[{required:!0,message:Or.message}],style:{flex:1}},Or),{},{children:(0,je.jsx)(dn.Z,Kr()(Kr()({allowClear:!0,showSearch:!0,optionFilterProp:"children",filterOption:!1,onChange:$r,onSearch:function(Jr){return Dn(Jr)},notFoundContent:zr()},de),{},{children:yn==null?void 0:yn.map(function(He){return(0,je.jsx)(Option,{value:He[de.optionValue],children:(0,je.jsxs)("div",{className:"demo-option-label-item",title:"".concat(He[de.optionLabel]," ").concat(He[de.optionValue]),children:[(0,je.jsx)("span",{role:"img","aria-label":"China",children:He[de.optionLabel]}),(0,je.jsxs)("span",{children:["\xA0\xA0\xA0",He[de.optionValue]]})]})},He[de.optionValue])})}))})),Or.dependencyField&&(0,je.jsxs)(je.Fragment,{children:["\xA0\xA0\xA0",(0,je.jsx)(Mr.Z.Item,{label:"",name:Or.dependencyField,noStyle:!0,valuePropName:"checked",initialValue:!1,children:(0,je.jsx)(Pn.Z,{onChange:function(Jr){Qr.variables[Or.name]=void 0;var hr=de.selectedValueField;hr.includes(".")&&(hr=hr.split(".").reverse()[0]),Qr.variables[hr]=Or.dependencyField?"":[],jn.setFieldValue(Or.name,void 0),jn.setFieldValue(hr,Or.dependencyField?"":[])},children:"\u81EA\u5B9A\u4E49"})})]})]})}})})}var e=(0,n.forwardRef)(vr),xn=r(11238),i=function(Re,pr){return request("/api/pipeline/internal_atom/".concat(pr,"/manual_confirm"),{method:"post",data:Re})},Un=function(Re,pr){return request("/api/pipeline/internal_atom/".concat(pr,"/get_approve_info_by_userid"),{method:"get",params:Re})},c=function(Re){return(0,xn.ZP)("/api/pipeline/config/".concat(Re),{method:"get"})},Yn=r(74877),kn=r(83056),Hr=De.Z.TextArea;function Le(W,Re){var pr=W.from,Te=W.config,Fe=W.onValuesChange,ae=W.close,de=(0,or.useModel)("@@initialState"),We=de.initialState,Or=We.currentUser,Qr=Or===void 0?{}:Or,qr=(0,Yn.DP)(),jn=qr.pipelineId,$r=(0,n.useState)(null),Mn=m()($r,2),On=Mn[0],yn=Mn[1],un=(0,n.useState)([]),V=m()(un,2),Qe=V[0],k=V[1],xr=(0,n.useReducer)(function(he){return he+1},0),qe=m()(xr,2),cr=qe[1],Lr=(0,n.useRef)(null),ue=(0,n.useState)(!1),Ye=m()(ue,2),Br=Ye[0],on=Ye[1],Dn=(0,n.useRef)(null),zr=Mr.Z.useForm(),Ir=m()(zr,1),ge=Ir[0];(0,n.useImperativeHandle)(Re,function(){return{vaild:en,saveError:jr}}),(0,n.useEffect)(function(){kr()},[]);var kr=function(){var he=x()(p()().mark(function t(){var _,A,X,ce;return p()().wrap(function(er){for(;;)switch(er.prev=er.next){case 0:_=Te==null?void 0:Te.variables,A=_.selected_pipeline,X=_.trigger_variables_2,ce=X===void 0?[]:X,A&&(ge.setFieldValue("selected_pipeline",A),An(A,"load"),ce==null||ce.map(function(Gr){Gr.repo_info?Gr.repo_info.forEach(function($e){var rn=$e.index;delete $e.index;var Hn=dr($e);ge.setFieldValue("".concat(rn,"-repo"),Hn)}):ge.setFieldValue(Gr.key,Gr.value)}),setTimeout(x()(p()().mark(function Gr(){return p()().wrap(function(rn){for(;;)switch(rn.prev=rn.next){case 0:return rn.prev=0,rn.next=3,ge.validateFields();case 3:rn.next=7;break;case 5:rn.prev=5,rn.t0=rn.catch(0);case 7:case"end":return rn.stop()}},Gr,null,[[0,5]])})),1e3)),Dn.current.init();case 3:case"end":return er.stop()}},t)}));return function(){return he.apply(this,arguments)}}(),jr=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},_=ge.getFieldValue("selected_pipeline");return delete t.selected_pipeline,{selected_pipeline:_,trigger_variables_2:hr(t)}},He=function(t,_){var A=Object.keys(_).filter(function(X){return!X.includes("-repo")});A.forEach(function(X){var ce=Qe.find(function(er){return er.name===X}),Ar={key:X,type:ce.type};_[X]&&(Ar.value=_[X]),t.push(Ar)})},Jr=function(t,_){var A=Object.keys(_),X=A.filter(function(Ar){return Ar.includes("-")});if(X.length<=0)return t;var ce=[];t.push({repo_info:ce}),X.forEach(function(Ar){var er=Ar.split("-")[0];try{var Gr=JSON.parse(_[Ar]);Gr.index=er,ce[er-1]=Gr}catch($e){ce[er-1]={index:er,content:_[Ar]}}})},hr=function(t){var _=[];return He(_,t),Jr(_,t),_},en=function(){var he=x()(p()().mark(function t(){var _,A;return p()().wrap(function(ce){for(;;)switch(ce.prev=ce.next){case 0:return ce.next=2,ge.validateFields();case 2:return _=ce.sent,A=_.selected_pipeline,delete _.selected_pipeline,ce.abrupt("return",{selected_pipeline:A,trigger_variables_2:hr(_)});case 6:case"end":return ce.stop()}},t)}));return function(){return he.apply(this,arguments)}}();function Tr(he){for(var t in he)he.hasOwnProperty(t)&&(he[t]===void 0||he[t]===null)&&(he[t]="");return he}var mn=function(t){var _=Qe.filter(function(A){return A.type==="repo"}).reverse();_.map(function(A,X){ge.setFieldValue("".concat(X+1,"-repo"),void 0)}),t?An(t):(yn(null),k([]))},An=function(){var he=x()(p()().mark(function t(_,A){var X,ce,Ar,er;return p()().wrap(function($e){for(;;)switch($e.prev=$e.next){case 0:return $e.prev=0,on(!0),$e.next=4,c(_);case 4:X=$e.sent,ce=X.data,Ar=ce.setting.pipeline_variable,er=Ar===void 0?[]:Ar,yn(ce),Cn(er,ce,A),ge.setFieldValue("trigger_variables_2",er),setTimeout(function(){Lr.current&&Lr.current.setEnv(er)},300),$e.next=15;break;case 13:$e.prev=13,$e.t0=$e.catch(0);case 15:return $e.prev=15,setTimeout(function(){on(!1)},300),$e.finish(15);case 18:case"end":return $e.stop()}},t,null,[[0,13,15,18]])}));return function(_,A){return he.apply(this,arguments)}}(),_n=function(t,_){if(!_)return Promise.resolve();try{JSON.parse(_)}catch(A){return Promise.reject("JSON \u683C\u5F0F\u9519\u8BEF")}return Promise.resolve()},Cn=function(t,_,A){if(A==="load")var X=Te==null?void 0:Te.variables,ce=X.trigger_variables_2;k(t||[])},yr=function(t,_){switch(t){case"branch":return _.ref||"";case"tag":return _["ref-tag"]||"";default:return _["ref-patchset"]||""}},dr=function(t){if(o()(t)!=="object")return t;if(t.content!==void 0)return t.content;t.base_info||(t.base_info={}),t.branch_patchset||(t.branch_patchset={}),t.commit||(t.commit={});try{var _,A,X,ce,Ar,er,Gr,$e,rn,Hn,Tn=`{
        "platform": "`.concat((t==null?void 0:t.platform)||"",`",
        "base_info": {
          "key": "`).concat((t==null||(_=t.base_info)===null||_===void 0?void 0:_.key)||"",`",
          "name": "`).concat((t==null||(A=t.base_info)===null||A===void 0?void 0:A.name)||"",`",
          "repo_id": "`).concat((t==null||(X=t.base_info)===null||X===void 0?void 0:X.repo_id)||"",`",
          "repo_url": "`).concat((t==null||(ce=t.base_info)===null||ce===void 0?void 0:ce.repo_url)||"",`"
        },
        "branch_patchset": {
          "key": "`).concat((t==null||(Ar=t.branch_patchset)===null||Ar===void 0?void 0:Ar.key)||"",`",
          "type": "`).concat((t==null||(er=t.branch_patchset)===null||er===void 0?void 0:er.type)||"",`",
          "`).concat((t==null||(Gr=t.branch_patchset)===null||Gr===void 0?void 0:Gr.type)||"",'": "').concat((t==null?void 0:t.branch_patchset[t==null||($e=t.branch_patchset)===null||$e===void 0?void 0:$e.type])||"",`"
        }`).concat((t==null||(rn=t.branch_patchset)===null||rn===void 0?void 0:rn.type)==="branch"?",":"",`
    `);if((t==null||(Hn=t.branch_patchset)===null||Hn===void 0?void 0:Hn.type)==="branch"){var Xn,pn;Tn+=`
        "commit": {
          "key": "`.concat((t==null||(Xn=t.commit)===null||Xn===void 0?void 0:Xn.key)||"",`",
          "sha": "`).concat((t==null||(pn=t.commit)===null||pn===void 0?void 0:pn.sha)||"",`"
        }
      }`)}else Tn+="}";return Tn}catch(sa){return""}},Q=function(t){var _=t[0],A=t[1],X=t[2],ce=`{
        "platform": "`.concat(_["repo-type"]||"",`",
        "base_info": {
          "key": "`).concat(_["git_url-name"]||"",`",
          "name": "`).concat(_["repo-name"]||"",`",
          "repo_id": "`).concat(_["repo-id"]||"",`",
          "repo_url": "`).concat(_["repo-url"]||"",`"
        },
        "branch_patchset": {
          "key": "`).concat(A["ref-name"]||"",`",
          "type": "`).concat(A["ref-isBranch"]||"",`",
          "`).concat(A["ref-isBranch"],'": "').concat(yr(A["ref-isBranch"],A),`"
        }`).concat(A["ref-isBranch"]==="branch"?",":"",`
      `);return A["ref-isBranch"]==="branch"?ce+=`"commit": {
          "key": "`.concat(X["sha-name"]||"",`",
          "sha": "`).concat(X.sha||"",`"
        }
      }`):ce+="}",ce},Je=function(t,_){var A=Qe.filter(function(er){return er.type==="repo"}).reverse(),X=A.findIndex(function(er){return er.id===_.id})+1,ce=t[0],Ar=Q(t);return(0,je.jsxs)("div",{style:{border:"1px solid #eee",padding:"5px 10px",marginBottom:"10px"},children:[(0,je.jsxs)("div",{className:"flex-start",children:["\u4ED3\u5E93",X,"\xA0 ",(0,je.jsxs)("span",{style:{marginTop:"-4px"},children:[(0,kn.Fo)(ce["repo-type"]),"\xA0"]}),ce["repo-name"]]}),(0,je.jsx)("div",{style:{paddingLeft:"20px"},children:(0,je.jsx)(Mr.Z.Item,{name:"".concat(X,"-repo"),style:{marginBottom:"5px"},initialValue:Ar,rules:[{validator:_n}],children:(0,je.jsx)(Hr,{placeholder:"\u9ED8\u8BA4\u81EA\u5B9A\u4E49\u503C",autoSize:{minRows:6}})})})]})},Vr=function(){return Qe.length<=0||!On.setting?(0,je.jsx)(je.Fragment,{}):!Qe||Qe.filter(function(t){return t.prompt_on_trigger}).length<=0?(0,je.jsx)(je.Fragment,{}):(0,je.jsx)(je.Fragment,{children:Qe.map(function(t){var _=t.description?(0,je.jsx)("span",{dangerouslySetInnerHTML:{__html:t.description}}):"";return t.type==="component"?(0,je.jsx)(je.Fragment,{}):t.type==="repo"?Je(t.repo,t):(0,je.jsx)(Mr.Z.Item,{name:t.name,label:t.display_name||t.name,extra:_,style:{marginBottom:"10px"},children:(0,je.jsx)(De.Z,{placeholder:"${x}\u683C\u5F0F\u7684\u73AF\u5883\u53D8\u91CF\u6216\u81EA\u5B9A\u4E49\u503C"})})})})};return(0,je.jsx)(Mr.Z,{layout:"vertical",form:ge,disabled:pr!==1,children:(0,je.jsxs)("div",{className:"flow-create-step-config-trigger-pipeline-container",children:[(0,je.jsx)(e,{component:Xe,name:L.name,formItemConfig:L,form:ge,config:Te,forceUpdate:cr,onChange:mn,ref:Dn}),Br?(0,je.jsx)("div",{className:"flex-center",style:{margin:"10px 0 0"},children:(0,je.jsx)(Be.Z,{})}):Vr()]})})}var le=(0,n.forwardRef)(Le)},29312:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){var C_Users_haoyuan3_github_pipeline_node_modules_umijs_babel_preset_umi_node_modules_babel_runtime_helpers_regeneratorRuntime_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(15009),C_Users_haoyuan3_github_pipeline_node_modules_umijs_babel_preset_umi_node_modules_babel_runtime_helpers_regeneratorRuntime_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(C_Users_haoyuan3_github_pipeline_node_modules_umijs_babel_preset_umi_node_modules_babel_runtime_helpers_regeneratorRuntime_js__WEBPACK_IMPORTED_MODULE_0__),C_Users_haoyuan3_github_pipeline_node_modules_umijs_babel_preset_umi_node_modules_babel_runtime_helpers_objectSpread2_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(97857),C_Users_haoyuan3_github_pipeline_node_modules_umijs_babel_preset_umi_node_modules_babel_runtime_helpers_objectSpread2_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(C_Users_haoyuan3_github_pipeline_node_modules_umijs_babel_preset_umi_node_modules_babel_runtime_helpers_objectSpread2_js__WEBPACK_IMPORTED_MODULE_1__),C_Users_haoyuan3_github_pipeline_node_modules_umijs_babel_preset_umi_node_modules_babel_runtime_helpers_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(99289),C_Users_haoyuan3_github_pipeline_node_modules_umijs_babel_preset_umi_node_modules_babel_runtime_helpers_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(C_Users_haoyuan3_github_pipeline_node_modules_umijs_babel_preset_umi_node_modules_babel_runtime_helpers_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2__),C_Users_haoyuan3_github_pipeline_node_modules_umijs_babel_preset_umi_node_modules_babel_runtime_helpers_slicedToArray_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(5574),C_Users_haoyuan3_github_pipeline_node_modules_umijs_babel_preset_umi_node_modules_babel_runtime_helpers_slicedToArray_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(C_Users_haoyuan3_github_pipeline_node_modules_umijs_babel_preset_umi_node_modules_babel_runtime_helpers_slicedToArray_js__WEBPACK_IMPORTED_MODULE_3__),react__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(62435),antd__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(81182),antd__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(77683),antd__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(61781),antd__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(96456),antd__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(84567),antd__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(94060),_ant_design_icons__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(33160),_ant_design_icons__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(48115),_style_less__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(57342),_components_FormConfig__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(53678),_component_review__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(88219),_component_triggerPipeline__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(38592),moment__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(30381),moment__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(moment__WEBPACK_IMPORTED_MODULE_9__),_addKeyValue__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(48807),_components_formComponent_addKeyValue__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(12627),_service__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(27978),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(86074);function Project(props,ref){var config=props.config,type=props.type,showPlugin=props.showPlugin,handlePluginsModal=props.handlePluginsModal,close=props.close,setConfig=props.setConfig,handleLoading=props.handleLoading,data=props.data,_useState=(0,react__WEBPACK_IMPORTED_MODULE_4__.useState)(!0),_useState2=C_Users_haoyuan3_github_pipeline_node_modules_umijs_babel_preset_umi_node_modules_babel_runtime_helpers_slicedToArray_js__WEBPACK_IMPORTED_MODULE_3___default()(_useState,2),control=_useState2[0],setControl=_useState2[1],pluginRef=(0,react__WEBPACK_IMPORTED_MODULE_4__.useRef)(null),variableRef=(0,react__WEBPACK_IMPORTED_MODULE_4__.useRef)(null),addKeyValueRef=(0,react__WEBPACK_IMPORTED_MODULE_4__.useRef)(null),keyValueRef=(0,react__WEBPACK_IMPORTED_MODULE_4__.useRef)(null),pluginsRef=(0,react__WEBPACK_IMPORTED_MODULE_4__.useRef)(null),triggerPipelineRef=(0,react__WEBPACK_IMPORTED_MODULE_4__.useRef)(null),_useReducer=(0,react__WEBPACK_IMPORTED_MODULE_4__.useReducer)(function(lr){return lr+1},0),_useReducer2=C_Users_haoyuan3_github_pipeline_node_modules_umijs_babel_preset_umi_node_modules_babel_runtime_helpers_slicedToArray_js__WEBPACK_IMPORTED_MODULE_3___default()(_useReducer,2),forceUpdate=_useReducer2[1],_Form$useForm=antd__WEBPACK_IMPORTED_MODULE_14__.Z.useForm(),_Form$useForm2=C_Users_haoyuan3_github_pipeline_node_modules_umijs_babel_preset_umi_node_modules_babel_runtime_helpers_slicedToArray_js__WEBPACK_IMPORTED_MODULE_3___default()(_Form$useForm,1),form=_Form$useForm2[0];(0,react__WEBPACK_IMPORTED_MODULE_4__.useImperativeHandle)(ref,function(){return{validateFields,modifyField}}),(0,react__WEBPACK_IMPORTED_MODULE_4__.useEffect)(function(){config.variables||(config.variables={}),setPluginTemplate(),initValue()},[]),(0,react__WEBPACK_IMPORTED_MODULE_4__.useEffect)(function(){},[]);var modifyField=function(I,r){form.setFieldValue(I,r),I==="name"&&(config.name=r),config.variables&&(config.variables.ref="",config.variables.git_url="",config.variables.repoName="",config.variables.repoId=""),setPluginTemplate("modify")},handlePluginChange=function(I,r){var Me;(Me=config.atomForm)===null||Me===void 0||Me.forEach(function(o){o.forEach(function(Ce){var p=Ce.fieldLevel;Ce.fieldLevel?p.split(".").reduce(function(Cr,x,ur,m){return ur===m.length-1&&(Cr[x]=void 0),Cr[x]},config):config[Ce.formItemConfig.name]=void 0})}),config.out_variables=I.out_variables,config.variables.git_url=void 0,config.variables.ref=void 0,config.variables.repoId=void 0,config.variables.repoName=void 0},handleAtomForm=function(I,r){r.out_variables&&r.out_variables.length>0&&I.push([{formItemConfig:{name:"out_variables",label:"\u8F93\u51FA\u73AF\u5883\u53D8\u91CF",style:{width:"100%"}},componentConfig:{type:"outVariables"}}]);var Me=!1;I.forEach(function(o){var Ce=o.find(function(p){return p.formItemConfig.name==="script"});Ce&&(Me=!0)}),Me&&I.push([{formItemConfig:{name:"before_script",label:"",style:{width:"100%",display:"none"},initialValue:void 0},componentConfig:{type:"input"}},{formItemConfig:{name:"after_script",label:"",style:{width:"100%",display:"none"},initialValue:void 0},componentConfig:{type:"input"}}])},setPluginTemplate=function(){var _ref=C_Users_haoyuan3_github_pipeline_node_modules_umijs_babel_preset_umi_node_modules_babel_runtime_helpers_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2___default()(C_Users_haoyuan3_github_pipeline_node_modules_umijs_babel_preset_umi_node_modules_babel_runtime_helpers_regeneratorRuntime_js__WEBPACK_IMPORTED_MODULE_0___default()().mark(function _callee(from){var _yield$getCompilePlug,_data,atomForm;return C_Users_haoyuan3_github_pipeline_node_modules_umijs_babel_preset_umi_node_modules_babel_runtime_helpers_regeneratorRuntime_js__WEBPACK_IMPORTED_MODULE_0___default()().wrap(function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(!config.atom_id){_context.next=23;break}return _context.prev=1,handleLoading(!0),_context.next=5,(0,_service__WEBPACK_IMPORTED_MODULE_12__.M)(config.atom_id);case 5:_yield$getCompilePlug=_context.sent,_data=_yield$getCompilePlug.data,atomForm=[],_data.json_form&&(atomForm=eval("("+_data.json_form+")")),from==="modify"&&handlePluginChange(_data,atomForm),handleAtomForm(atomForm,_data),config.atomForm=atomForm,config.variables.atomType=_data.type,Array.isArray(atomForm)&&atomForm.forEach(function(lr){lr.forEach(function(I){if(from==="modify")config.script=_data.script;else{var r;(I==null||(r=I.componentConfig)===null||r===void 0?void 0:r.type)==="codeMirror"&&I!==null&&I!==void 0&&I.componentConfig.readOnly?config.script=_data.script:config.script||(config.script=_data.script)}})}),setConfig&&setConfig(C_Users_haoyuan3_github_pipeline_node_modules_umijs_babel_preset_umi_node_modules_babel_runtime_helpers_objectSpread2_js__WEBPACK_IMPORTED_MODULE_1___default()({},config)),forceUpdate(),_context.next=20;break;case 18:_context.prev=18,_context.t0=_context.catch(1);case 20:return _context.prev=20,setTimeout(function(){handleLoading(!1)},200),_context.finish(20);case 23:case"end":return _context.stop()}},_callee,null,[[1,18,20,23]])}));return function lr(I){return _ref.apply(this,arguments)}}(),initValue=function lr(){var I;config.variables.users=config.variables.users||"";var r=config.variables.userValue||[];form.setFieldValue("userValue",r);var Me=config==null||(I=config.variables)===null||I===void 0?void 0:I.from_trigger_env;Me?form.setFieldValue("users",r||""):r.length>0&&Array.isArray(r)&&form.setFieldValue("users",r.map(function(n){return n.name+" "+n.user_id})),form.setFieldValue("from_trigger_env",config.variables.from_trigger_env),form.setFieldValue("direct_leader",config.variables.direct_leader),form.setFieldValue("confirm_rule",config.variables.confirm_rule||"OR"),form.setFieldValue("runtime_var",config.variables.runtime_var||[]),form.setFieldValue("archive_comments",config.variables.archive_comments),form.setFieldValue("confirm_description",config.variables.confirm_description||""),form.setFieldValue("remind_again_at",config.variables.remind_again_at||60),form.setFieldValue("event",config.variables.event||"task"),form.setFieldValue("remind_every",config.variables.remind_every||60),form.setFieldValue("expire_type",config.variables.expire_type||"never"),form.setFieldValue("periodic",config.variables.periodic),config.variables.hour_minute&&form.setFieldValue("hour_minute",moment__WEBPACK_IMPORTED_MODULE_9___default()(config.variables.hour_minute||"","HH:mm")),form.setFieldValue("by",config.variables.by),form.setFieldValue("week_index_week_day",config.variables.week_index_week_day),form.setFieldValue("week_interval",config.variables.week_interval),form.setFieldValue("expired_at",config.variables.expired_at||""),form.setFieldValue("opinions",config.variables.opinions||1),form.setFieldValue("reason",config.variables.reason||""),form.setFieldValue("confirm_expire_button",config.variables.confirm_expire_button||2),form.setFieldValue("expired_at_var",config.variables.expired_at_var||""),form.setFieldValue("confirm_expire_var",config.variables.confirm_expire_var||""),form.setFieldValue("expired_at_date",config.variables.expired_at_date?moment__WEBPACK_IMPORTED_MODULE_9___default()(config.variables.expired_at_date):""),form.setFieldValue("name",config.name),form.setFieldValue("active",config.active),form.setFieldValue("allow_failure",config.allow_failure),form.setFieldValue("run_condition",config.run_condition);var o=config.variables,Ce=o.review_day,p=o.review_hour,Cr=o.review_minute,x=o.confirm_expire_date;if(Ce!==void 0||p!==void 0||Cr!==void 0)form.setFieldValue("review_day",Ce),form.setFieldValue("review_hour",p),form.setFieldValue("review_minute",Cr);else if(x){var ur=moment__WEBPACK_IMPORTED_MODULE_9___default().utc(x*60*1e3).format("HH:mm").split(":");form.setFieldValue("review_hour",ur[0]),form.setFieldValue("review_minute",ur[1])}var m=config.timeout;m<=0&&(m=""),form.setFieldValue("timeout",m),setTimeout(function(){config.custom_env&&addKeyValueRef.current.setValue(config.custom_env),config.run_cond_custom_var&&keyValueRef.current.setValue(config.run_cond_custom_var)},0),config.atom_name||setTimeout(function(){handlePluginsModal("show")},200),setTimeout(function(){form.validateFields()},100)},validateFields=function(){var lr=C_Users_haoyuan3_github_pipeline_node_modules_umijs_babel_preset_umi_node_modules_babel_runtime_helpers_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_2___default()(C_Users_haoyuan3_github_pipeline_node_modules_umijs_babel_preset_umi_node_modules_babel_runtime_helpers_regeneratorRuntime_js__WEBPACK_IMPORTED_MODULE_0___default()().mark(function I(){var r,Me,o,Ce,p,Cr,x,ur,m,n,De,Mr,Be,L,Xe;return C_Users_haoyuan3_github_pipeline_node_modules_umijs_babel_preset_umi_node_modules_babel_runtime_helpers_regeneratorRuntime_js__WEBPACK_IMPORTED_MODULE_0___default()().wrap(function(Ke){for(;;)switch(Ke.prev=Ke.next){case 0:return Ke.prev=0,Ke.next=3,form.validateFields();case 3:if(r=Ke.sent,!triggerPipelineRef.current){Ke.next=12;break}return Ke.next=7,triggerPipelineRef.current.vaild();case 7:Me=Ke.sent,o=Me.selected_pipeline,Ce=Me.trigger_variables_2,config.variables.selected_pipeline=o,config.variables.trigger_variables_2=Ce;case 12:p=r.git_url,Cr=r.ref_type,x=r.ref,ur=r.depth,m=r.repo_path,config.custom_env=addKeyValueRef.current.getValue(),pluginsRef.current&&(r.out_variables=pluginsRef.current.getValue("out_variables")),Object.keys(r).forEach(function(mr){if(mr.includes("0.")){delete r[mr];return}setCustomValue(mr,r[mr],r)}),setCustomEnv(),config.vaildFormError=!1,config.atom_name||(config.vaildFormError=!0),n=config.variables.confirm_expire_button,n===1?(config.variables.confirm_expire=config.variables.confirm_expire_var,config.variables.expired_at=config.variables.expired_at_var):(De=config.variables.review_day*24*60+config.variables.review_hour*60+config.variables.review_minute,config.variables.confirm_expire=De,config.variables.expired_at=config.variables.expired_at_date),config.variables.userValue=config.variables.users,config.variables.runtime_var=r.runtime_var,Ke.next=31;break;case 25:Ke.prev=25,Ke.t0=Ke.catch(0),triggerPipelineRef.current&&(Be=triggerPipelineRef.current.saveError(Ke.t0.values),L=Be.selected_pipeline,Xe=Be.trigger_variables_2,config.variables.selected_pipeline=L,config.variables.trigger_variables_2=Xe),config.variables.runtime_var=(Ke.t0===null||Ke.t0===void 0||(Mr=Ke.t0.values)===null||Mr===void 0?void 0:Mr.runtime_var)||[],Ke.t0.errorFields.forEach(function(mr){var Ur=mr.name[0];Ur==="custom_env"?setCustomEnv():Ur==="out_variables"&&pluginsRef.current&&(config.out_variables=pluginsRef.current.getValue("out_variables"))}),config.vaildFormError=!0;case 31:case"end":return Ke.stop()}},I,null,[[0,25]])}));return function(){return lr.apply(this,arguments)}}(),setCustomEnv=function lr(){addKeyValueRef.current&&(config.custom_env=addKeyValueRef.current.getValue())},onChange=function lr(I){var r=I.target.value;config.name=r},reselect=function lr(I){I.stopPropagation(),handlePluginsModal("show",config.name)},onValuesChange=function lr(I){Object.keys(I).forEach(function(r){var Me=I[r];switch(r){case"runtime_var":break;default:setCustomValue(r,Me,I)}}),config.variables.userValue=config.variables.users},handleUersValue=function lr(I){var r=[];return I==null||I.forEach(function(Me){var o=Me.split(" ");r.push({name:o[0],user_id:o[1]})}),r},setCustomValue=function lr(I,r,Me){var o,Ce=void 0;if((o=config.atomForm)===null||o===void 0||o.forEach(function(ur){ur.forEach(function(m){var n=m.fieldLevel,De=m.formItemConfig.name;De===I&&n&&(Ce=!0,n.split(".").reduce(function(Mr,Be,L,Xe){return L===Xe.length-1&&(Mr[Be]=r),Mr[Be]},config))})}),!Ce)switch(I){case"userValue":config.variables[I]=r;break;case"users":var p=config.variables.from_trigger_env;config.variables[I]=r,p||(config.variables[I]=handleUersValue(r));break;case"expired_at_date":config.variables[I]=Me?moment__WEBPACK_IMPORTED_MODULE_9___default()(r).format("YYYY-MM-DD HH:mm:ss"):"";break;case"confirm_expire_date":case"confirm_expire":var Cr=moment__WEBPACK_IMPORTED_MODULE_9___default()(r).format("HH:mm"),x=moment__WEBPACK_IMPORTED_MODULE_9___default().duration(Cr).asMinutes();config.variables[I]=x;break;case"hour_minute":config.variables[I]=moment__WEBPACK_IMPORTED_MODULE_9___default()(r).format("HH:mm");break;case"confirm_rule":case"runtime_var":case"archive_comments":case"opinions":case"event":case"confirm_description":case"expired_at":case"remind_again_at":case"remind_every":case"confirm_expire_var":case"expired_at_var":case"confirm_expire_button":case"expire_type":case"week_index_week_day":case"week_interval":case"by":case"periodic":case"reason":case"review_day":case"review_hour":case"review_minute":case"from_trigger_env":case"direct_leader":config.variables[I]=r;break;case"run_cond_custom_var":config.run_cond_custom_var=keyValueRef.current.getValue().map(function(ur){return{key:ur.key,value:ur.value}});break;case"timeout":config.timeout=r||0;break;default:config[I]=r}},versionChange=function lr(I){var r={git_url:10,ref:30,credential:"c-af6a3a4db5b54d49ae066ef5840c8d7c"};Array.isArray(config.atomForm)&&config.atomForm.forEach(function(Me){Me.forEach(function(o){var Ce=o.fieldLevel,p=o.formItemConfig.name;Ce?Ce.split(".").reduce(function(Cr,x,ur,m){return ur===m.length-1&&r[x]&&(Cr[x]=r[x]),Cr[x]},config):r[p]&&(config[p]=r[p])})}),forceUpdate()},renderPluginEmpty=function lr(){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(antd__WEBPACK_IMPORTED_MODULE_14__.Z.Item,{name:"",label:"\u63D2\u4EF6",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(antd__WEBPACK_IMPORTED_MODULE_15__.ZP,{type:"primary",onClick:function(r){return reselect(r)},children:"\u8BF7\u5728\u5DE6\u4FA7\u9009\u62E9\u4E00\u4E2A\u63D2\u4EF6"})})},renderPluginSelect=function lr(){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("div",{className:"flex-space-between layout-container",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("div",{className:"layout-text",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("h3",{className:"layout-text-title",children:"\u63D2\u4EF6:"}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("div",{className:"flex-space-between",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("div",{className:"layout-text-box flex-space-between",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("span",{className:"layout-text-box-plugin",children:config.atom_name}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(antd__WEBPACK_IMPORTED_MODULE_15__.ZP,{type:"primary",onClick:function(r){return reselect(r)},children:"\u91CD\u9009"})]}),"\xA0\xA0\xA0",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(antd__WEBPACK_IMPORTED_MODULE_16__.Z,{title:"\u5237\u65B0\u63D2\u4EF6\u914D\u7F6E",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(antd__WEBPACK_IMPORTED_MODULE_15__.ZP,{icon:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_ant_design_icons__WEBPACK_IMPORTED_MODULE_17__.Z,{}),type:"link",onClick:function(){return setPluginTemplate("modify")}})})]})]})})},renderPluginForm=function lr(){var I;switch(config==null||(I=config.variables)===null||I===void 0?void 0:I.atomType){case"manual":return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_component_review__WEBPACK_IMPORTED_MODULE_7__.Z,C_Users_haoyuan3_github_pipeline_node_modules_umijs_babel_preset_umi_node_modules_babel_runtime_helpers_objectSpread2_js__WEBPACK_IMPORTED_MODULE_1___default()(C_Users_haoyuan3_github_pipeline_node_modules_umijs_babel_preset_umi_node_modules_babel_runtime_helpers_objectSpread2_js__WEBPACK_IMPORTED_MODULE_1___default()({form,config},props),{},{from:type,onValuesChange,close}));default:switch(config==null?void 0:config.atom_name){case"\u89E6\u53D1\u6D41\u6C34\u7EBF":return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.Fragment,{children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_components_FormConfig__WEBPACK_IMPORTED_MODULE_6__.Z,C_Users_haoyuan3_github_pipeline_node_modules_umijs_babel_preset_umi_node_modules_babel_runtime_helpers_objectSpread2_js__WEBPACK_IMPORTED_MODULE_1___default()(C_Users_haoyuan3_github_pipeline_node_modules_umijs_babel_preset_umi_node_modules_babel_runtime_helpers_objectSpread2_js__WEBPACK_IMPORTED_MODULE_1___default()({form,config},props),{},{from:type,formItemlist:config.atomForm,ref:pluginsRef,flowData:data,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_component_triggerPipeline__WEBPACK_IMPORTED_MODULE_8__.Z,C_Users_haoyuan3_github_pipeline_node_modules_umijs_babel_preset_umi_node_modules_babel_runtime_helpers_objectSpread2_js__WEBPACK_IMPORTED_MODULE_1___default()(C_Users_haoyuan3_github_pipeline_node_modules_umijs_babel_preset_umi_node_modules_babel_runtime_helpers_objectSpread2_js__WEBPACK_IMPORTED_MODULE_1___default()({form,config},props),{},{from:type,formItemlist:config.atomForm,ref:triggerPipelineRef,flowData:data}))}))});default:return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_components_FormConfig__WEBPACK_IMPORTED_MODULE_6__.Z,C_Users_haoyuan3_github_pipeline_node_modules_umijs_babel_preset_umi_node_modules_babel_runtime_helpers_objectSpread2_js__WEBPACK_IMPORTED_MODULE_1___default()(C_Users_haoyuan3_github_pipeline_node_modules_umijs_babel_preset_umi_node_modules_babel_runtime_helpers_objectSpread2_js__WEBPACK_IMPORTED_MODULE_1___default()({form,config},props),{},{from:type,formItemlist:config.atomForm,ref:pluginsRef,flowData:data}))}}return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.Fragment,{})},renderEnv=function lr(){return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_addKeyValue__WEBPACK_IMPORTED_MODULE_10__.Z,{ref:addKeyValueRef,from:type,form,type})},keyValueChange=function lr(I){config.run_cond_custom_var=I};return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)("div",{className:"flex-task-config-container",ref:variableRef,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)(antd__WEBPACK_IMPORTED_MODULE_14__.Z,{layout:"vertical",form,name:"control-hooks",disabled:type!==1,onValuesChange,children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(antd__WEBPACK_IMPORTED_MODULE_14__.Z.Item,{name:"name",label:"\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u540D\u79F0"}],initialValue:config.name,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(antd__WEBPACK_IMPORTED_MODULE_18__.Z,{value:config.name,onChange,maxLength:50,placeholder:"\u957F\u5EA6\u4E3A50\u4E2A\u5B57\u7B26"})}),config.atom_name?renderPluginSelect():renderPluginEmpty(),renderPluginForm(),renderEnv(),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("div",{className:"control-box",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("div",{className:"control flex-space-between",onClick:function lr(){return setControl(!control)},children:["\u6D41\u7A0B\u63A7\u5236\u9009\u9879",(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_ant_design_icons__WEBPACK_IMPORTED_MODULE_19__.Z,{className:"control-arrow ".concat(!control&&"control-arrow-action")})]}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsxs)("div",{className:"form-control",style:{display:control?"block":"none"},children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(antd__WEBPACK_IMPORTED_MODULE_14__.Z.Item,{name:"active",valuePropName:"checked",colon:!1,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(antd__WEBPACK_IMPORTED_MODULE_20__.Z,{children:"\u542F\u7528\u672C Task"})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(antd__WEBPACK_IMPORTED_MODULE_14__.Z.Item,{name:"allow_failure",valuePropName:"checked",colon:!1,children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(antd__WEBPACK_IMPORTED_MODULE_20__.Z,{children:"\u5931\u8D25\u540E\u7EE7\u7EED"})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(antd__WEBPACK_IMPORTED_MODULE_14__.Z.Item,{name:"run_condition",label:"\u4F55\u65F6\u8FD0\u884C\u672C\u63D2\u4EF6",initialValue:"pre_task_success",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(antd__WEBPACK_IMPORTED_MODULE_21__.Z,{options:[{value:"pre_task_success",label:"\u6240\u6709\u524D\u7F6E\u63D2\u4EF6\u8FD0\u884C\u6210\u529F\u65F6(\u5305\u62EC\u5931\u8D25\u540E\u7EE7\u7EED)"},{value:"pre_task_failed",label:"\u53EA\u6709\u524D\u9762\u63D2\u4EF6\u6709\u5931\u8D25\u65F6\u624D\u8FD0\u884C"},{value:"always",label:"\u5373\u4F7F\u6709\u524D\u7F6E\u63D2\u4EF6\u8FD0\u884C\u5931\u8D25\u4E5F\u8FD0\u884C\uFF0C\u9664\u975E\u88AB\u53D6\u6D88\u624D\u4E0D\u8FD0\u884C"},{value:"custom_variable_match",label:"\u81EA\u5B9A\u4E49\u53D8\u91CF\u5168\u90E8\u6EE1\u8DB3\u65F6\u8FD0\u884C"},{value:"custom_variable_match_not_run",label:"\u81EA\u5B9A\u4E49\u53D8\u91CF\u5168\u90E8\u6EE1\u8DB3\u65F6\u4E0D\u8FD0\u884C"}]})}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(antd__WEBPACK_IMPORTED_MODULE_14__.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function lr(){var I=form.getFieldValue("run_condition");return I==="custom_variable_match"||I==="custom_variable_match_not_run"?(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(_components_formComponent_addKeyValue__WEBPACK_IMPORTED_MODULE_11__.Z,{formCOnfig:{label:"\u53D8\u91CF",name:"run_cond_custom_var"},ref:keyValueRef,from:type,form,type,value:"value",keys:"key",keyValueChange}):(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.jsx)(react_jsx_runtime__WEBPACK_IMPORTED_MODULE_13__.Fragment,{})}})]})]})]})})}__webpack_exports__.Z=(0,react__WEBPACK_IMPORTED_MODULE_4__.forwardRef)(Project)},88731:function(lr,I,r){r.d(I,{Z:function(){return Ft}});var Me=r(15009),o=r.n(Me),Ce=r(99289),p=r.n(Ce),Cr=r(97857),x=r.n(Cr),ur=r(5574),m=r.n(ur),n=r(62435),De=r(68872),Mr=r(30381),Be=r.n(Mr),L=r(74877),Xe=[{id:1,name:"\u6D41\u6C34\u7EBF"},{id:2,name:"\u901A\u77E5"},{id:3,name:"\u57FA\u7840\u8BBE\u7F6E"}],or=function(){return{id:1,name:"stage-1",type:1,jobs:[],showAddButton:!1,active:!0}},Ke=function(){return{id:1,name:"job",type:2,tasks:[],active:!0}},mr=function(){return{id:1,name:"task",type:3,vaildFormError:!0,active:!0,allow_failure:!1,run_condition:"pre_task_success"}},Ur=function(l,a,S){var h=function me(){l.timer=setTimeout(function(){S!==3&&E(),l.localDuration+=1,me(l),a&&a()},1e3)},E=function(){clearTimeout(l.timer),l.timerRunning=!1},ee=function(){var $=l.started_at,be=Be()(new Date).format("YYYY-MM-DD HH:mm:ss"),Ze=Be()(be).valueOf(),pe=Be()(Be()($||be).format("YYYY-MM-DD HH:mm:ss")).valueOf(),Ee=(Ze-pe)/1e3;return Ee};if(S===3){var Z=l.status;switch(Z){case"running":if(l.timerRunning)return;var ye=ee();l.localDuration=ye,l.duration=0,h(l),l.timerRunning=!0;break;case"success":case"failed":case"timerout":case"canceled":case"skipped":E(l)}}},ln=r(19632),Pr=r.n(ln),Kr=r(14313),Xr=r(50888),In=r(8751),En=r(87784),dn=r(98165),Pn=r(97937),fn=r(50228),vn=r(37446),tn=r(61781),je=r(85418),vr=r(77683),e=r(86074),xn=null,i=0;function Un(s){var l=s.stage,a=s.index,S=s.stageList,h=s.showConfigDetail,E=s.addStage,ee=s.deleteStage,Z=s.handleShowAdd,ye=s.handleStageAdd,me=s.stageAddStatus,$=s.addJob,be=s.renderJobs,Ze=s.type,pe=s.renderExecStatusClassName,Ee=s.retry,ze=s.update,ke=s.openConsumptionModal,Ie=function(){return(0,e.jsxs)(e.Fragment,{children:[a>0&&(0,e.jsx)("div",{className:"stage-arrow-left",children:(0,e.jsx)(Kr.Z,{className:"icon"})}),Ze===1&&(0,e.jsx)("div",{className:"left-add-stage common-add-button flex-center",onClick:function(ne){return Z(ne,a)},children:l.showAddButton?(0,e.jsx)("i",{className:"iconfont icon-jianhao"}):(0,e.jsx)("i",{className:"iconfont icon-add_bold"})}),(0,e.jsxs)("div",{className:"stage-arrow-right",children:[a!==S.length-1&&(0,e.jsx)("div",{className:"right-line"}),Ze===1&&(0,e.jsxs)("div",{className:"right-add-stage common-add-button flex-center",onClick:function(ne){return ye(ne)},children:[(0,e.jsx)("i",{className:"iconfont icon-add_bold"}),a===S.length-1&&me&&(0,e.jsx)("ul",{className:"stage-add-layer-right",children:(0,e.jsx)("li",{className:"layer-item",onClick:function(ne){return E(ne,1)},children:"\u6DFB\u52A0\u65B0Stage"})})]})]}),a!==0&&l.showAddButton&&(0,e.jsx)(e.Fragment,{children:(0,e.jsx)("ul",{className:"stage-add-layer",children:(0,e.jsx)("li",{className:"layer-item",onClick:function(ne){return E(ne,1,a)},children:"\u6DFB\u52A0\u65B0Stage"})})})]})},rr=function(N){var ne=N.status;return(0,e.jsxs)("div",{className:"stage-item  flex-center stage-item-status-".concat(pe(ne)),children:[(0,e.jsx)("div",{className:"flow-mark-stage",children:"Stage"}),(0,e.jsxs)("div",{className:"stage-item-icon-box",children:[ne==="running"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Xr.Z,{}),"\xA0\xA0"]}),ne==="success"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(In.Z,{style:{color:"#34d97b",marginTop:"3px"}}),"\xA0\xA0"]}),ne==="skipped"&&(0,e.jsxs)("div",{className:"stage-item-skipped flex-center",children:[(0,e.jsx)("i",{className:"iconfont icon-tiaoguofenxiang "}),"\xA0\xA0"]}),ne==="canceled"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(En.Z,{style:{marginTop:"3px",color:"#f8b300"}}),"\xA0\xA0"]}),(ne==="failed"||ne==="timeout")&&(0,e.jsxs)("div",{className:"stage-item-failed flex-center",children:[(0,e.jsx)("i",{className:"iconfont icon-addfailed "}),"\xA0\xA0"]})]}),(0,e.jsx)("span",{className:"stage-item-name",children:(0,e.jsx)(tn.Z,{placement:"topLeft",title:N.name,children:N.name})}),(ne==="failed"||ne==="timeout"||ne==="canceled"||ne==="success")&&(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(tn.Z,{title:"\u91CD\u8BD5",children:(0,e.jsx)("div",{className:"stage-item-retry flex-center",onClick:function(R){return Ee(R,N)},children:(0,e.jsx)(dn.Z,{})})})}),Ze===1&&N.vaildFormError&&(0,e.jsx)("div",{className:"stage-operate-danger flex-center",children:(0,e.jsx)("i",{className:"iconfont icon-weixian"})}),(0,e.jsx)("i",{className:"iconfont icon-doc_on_clipboard_fill stage-operate-add",onClick:function(R){return E(R,2,a,N)}}),(0,e.jsx)("div",{className:"stage-operate-close flex-center",onClick:function(R){return ee(R,a)},children:(0,e.jsx)(Pn.Z,{})})]})},re=function(N){var ne=N.target;ne.style.opacity=".3",xn=ne,i=N.clientX},B=function(N){var ne=N.target;ne.style.opacity="1",xn=null;var z=Array.from(document.querySelectorAll(".stage-box")),R=ne.dataset.currentIndex,M=z.findIndex(function(g){return g.dataset.currentIndex===R}),v=S.splice(R,1);S.splice(M,0,v[0]),ze()},T=function(N){N.preventDefault();var ne=N.clientX,z=N.target.closest(".stage-box");if(xn&&z&&z.dataset.id!==xn.dataset.id){var R=z.parentNode;i>ne?R.insertBefore(xn,z):R.insertBefore(z,xn),i=ne}},xe=function(N){var ne=[];switch(N.status){case"running":ne=[];break;case"canceled":case"failed":case"timeout":case"success":ne=[{key:"3",label:(0,e.jsx)(tn.Z,{title:"\u91CD\u8BD5",children:(0,e.jsx)("div",{className:"stage-item-retry flex-center",onClick:function(R){return Ee(R,N)},children:(0,e.jsx)(dn.Z,{})})})}];break;case"skipped":ne=[];break}return N!=null&&N.consumption&&(ne=[{key:"1",label:(0,e.jsxs)("div",{onClick:function(R){R.stopPropagation(),ke(N)},children:[(0,e.jsx)(fn.Z,{})," \u6D88\u8D39\u4FE1\u606F"]})}].concat(Pr()(ne))),(0,e.jsx)("div",{className:"stage-item-consumptionIcon flex-center",onClick:function(){return function(){}},children:ne.length>0&&(0,e.jsx)(je.Z,{menu:{items:ne},overlayClassName:"job-more-dropdown",children:(0,e.jsx)("div",{className:"stage-item-consumptionIcon-items flex-center",children:(0,e.jsx)(vr.ZP,{type:"text",className:"detail-retry-op-more",icon:(0,e.jsx)(vn.Z,{}),onClick:function(R){return R.stopPropagation()}})})})})};return(0,e.jsxs)("div",{className:"stage-box ".concat(!l.active&&"stage-disabled"),onDragEnter:T,onDragEnd:B,draggable:Ze==1,onDragStart:re,"data-id":l.id,"data-current-index":a,onClick:function(N){return h(N,l)},children:[rr(l),be(l.jobs,a,S),Ie(),Ze===1&&(0,e.jsx)("div",{className:"stage-add-job-first stage-add-job flex-center ".concat("stage-add-job-other-element"),children:(0,e.jsxs)("button",{className:"flex-center",onClick:function(N){return $(N,1,a)},children:[(0,e.jsx)("i",{className:"iconfont icon-add_bold"}),"\xA0",(0,e.jsx)("span",{children:"\u6DFB\u52A0 Job"})]})})]})}var c=Un,Yn=r(45605),kn=r(48115),Hr=r(55241),Le={openstack:"Openstack \u865A\u62DF\u673A",metal:"\u7269\u7406\u673A"},le=r(19110),W=null,Re=0,pr=null,Te=!1;function Fe(s){var l=s.jobs,a=s.showConfigDetail,S=s.addJob,h=s.renderStep,E=s.stageIndex,ee=s.deleteJob,Z=s.type,ye=s.renderExecStatusClassName,me=s.stageList,$=s.handleJobCanceled,be=s.retryServer,Ze=s.handleJobSkipped,pe=s.handleJobManual,Ee=s.update,ze=s.handleShowJob,ke=(0,n.useRef)({}),Ie=(0,n.useReducer)(function(Ae){return Ae+=1},0),rr=m()(Ie,2),re=rr[1];(0,n.useEffect)(function(){return function(){B()}},[]);var B=function(){Z===3&&me.forEach(function(d){d.jobs.forEach(function(y){clearTimeout(y.timer),y.tasks.forEach(function(U){clearTimeout(U.timer)})})})},T=function(){return E===me.length-1&&Z!==1?(0,e.jsx)(e.Fragment,{}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"job-right-point other-right-point-common"}),(0,e.jsx)("div",{className:"job-right-line job-line"})]})},xe=function(d,y){if(y===0)return(0,e.jsxs)(e.Fragment,{children:[d!==0&&y===0&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"job-left-arrow first-left-arrow",children:(0,e.jsx)(Kr.Z,{className:"icon"})}),(0,e.jsx)("div",{className:"job-left-line job-line"})]}),T()]})},Pe=function(){return E===me.length-1&&Z!==1?(0,e.jsx)(e.Fragment,{}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"other-right-point other-right-point-common"}),(0,e.jsx)("div",{className:"other-right-line job-line"})]})},N=function(d,y,U){if(U!==d.length-1)return(0,e.jsxs)(e.Fragment,{children:[y!==0&&(0,e.jsx)(e.Fragment,{children:(0,e.jsx)("div",{className:"job-line other-left-line"})}),Pe()]})},ne=function(d){var y=[];switch(d.status){case"running":y=[{key:"1",label:(0,e.jsxs)("div",{onClick:function(O){return Ze(O,d)},children:[(0,e.jsx)("i",{className:"iconfont icon-tiaoguofenxiang",style:{fontSize:"17px"}})," \u8DF3\u8FC7"]})},{key:"2",label:(0,e.jsxs)("div",{onClick:function(O){return $(O,d)},children:[(0,e.jsx)(En.Z,{})," \xA0\u53D6\u6D88"]})}];break;case"canceled":case"failed":case"timeout":case"timeout":case"success":y=[{key:"3",label:(0,e.jsxs)("div",{onClick:function(O){return be(O,d)},children:[(0,e.jsx)(dn.Z,{})," \xA0\u91CD\u8BD5"]})}];break;case"skipped":y=[{key:"4",label:(0,e.jsxs)("div",{onClick:function(O){return be(O,d,"skipped")},children:[(0,e.jsx)(dn.Z,{})," \xA0\u91CD\u8BD5"]})}];break;default:return(0,e.jsx)(e.Fragment,{})}return(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(je.Z,{menu:{items:y},overlayClassName:"job-more-dropdown",children:(0,e.jsx)(vr.ZP,{type:"text",className:"detail-retry-op-more",icon:(0,e.jsx)(vn.Z,{}),onClick:function(O){return O.stopPropagation()}})})})},z=function(d){return d.split("-")},R=function(d){d.stopPropagation(),Te=!0;var y=d.target;pr=y.parentNode,y.style.opacity=".3",W=y,Re=d.clientX},M=function(d){d.stopPropagation(),Te=!1;var y=d.clientY,U=d.target;U.style.opacity="1";var O=U.dataset.currentIndex,Y=z(O),nr=m()(Y,2),Se=nr[0],H=nr[1],P=[],ve=U.previousElementSibling;if(ve){ve=U.previousElementSibling,P=z(ve.dataset.currentIndex),Se===P[0]?Re>y&&(P[1]=P[1]*1+1):P[1]=P[1]*1+1;var oe=me[P[0]].jobs.length-1;P[1]*1===oe&&(P[1]=oe+1)}else ve=U.nextElementSibling,P=z(ve.dataset.currentIndex),P[1]=0;var C=me[Se].jobs.splice(H,1);me[P[0]].jobs.splice(P[1],0,C[0]),Se!==P[0]&&(U.parentNode.removeChild(U),pr.insertBefore(W,pr.firstChild)),me[Se].jobs.length<=0&&me.splice(Se,1),Re=y,re(),Ee()},v=function(d){if(d.stopPropagation(),d.preventDefault(),!!Te){var y=d.clientY,U=d.target.closest(".job-item");if(W&&U&&U.dataset.id!==W.dataset.id){var O=U.closest(".jobs-box");O&&(Re>y?O.insertBefore(W,U):O.insertBefore(W,U.nextElementSibling),Re=y)}}},g=function(){},f=function(d){var y="\u7533\u8BF7\u4E2D";switch(d){case"pending":y="\u5F85\u521B\u5EFA";break;case"progress":y="\u521B\u5EFA\u4E2D";break;case"created_failed":y="\u521B\u5EFA\u5931\u8D25";break;case"destroyed_failed":y="\u9500\u6BC1\u5931\u8D25";break;case"running":y="\u4F7F\u7528\u4E2D";break;case"destroyed":y="\u5DF2\u9500\u6BC1";break;default:y=""}return y},w=function(d,y,U){var O=d.vm_info;return(0,e.jsx)("div",{style:{width:"200px"},className:"flow-job-server-popover-container",children:U==null?void 0:U.items.map(function(Y){return(0,e.jsxs)("div",{style:{marginBottom:"10px"},children:[(0,e.jsx)("div",{className:"flex-space-between",children:(0,e.jsxs)("div",{style:{fontWeight:"bold"},children:[" ",Le[Y.type]]})}),Z===3&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"flex-start",children:[(0,e.jsx)("span",{style:{color:"#7f7f7f",fontWeight:"bold"},children:"\u72B6\u6001\uFF1A"}),(0,e.jsx)("div",{className:"server-status-".concat(Y.status),children:(0,e.jsx)("span",{className:"text",children:f(Y.status)})})]}),Y.failure_reason&&(0,e.jsxs)("div",{style:{wordBreak:"break-all"},children:[(0,e.jsx)("span",{style:{color:"#7f7f7f",fontWeight:"bold"},children:"\u5931\u8D25\u539F\u56E0\uFF1A"}),Y.failure_reason||" ","\xA0",(0,e.jsx)(le.TI,{text:Y.failure_reason})]}),Y.zone&&(0,e.jsxs)("div",{style:{wordBreak:"break-all"},children:[(0,e.jsx)("span",{style:{color:"#7f7f7f",fontWeight:"bold"},children:"\u53EF\u7528\u533A\uFF1A"}),Y.zone||" ","\xA0",(0,e.jsx)(le.TI,{text:Y.zone})]}),Y.config_name&&(0,e.jsxs)("div",{style:{wordBreak:"break-all"},children:[(0,e.jsx)("span",{style:{color:"#7f7f7f",fontWeight:"bold"},children:"\u89C4\u683C\uFF1A"}),Y.config_name||" ","\xA0",(0,e.jsx)(le.TI,{text:Y.config_name})]}),Y.name&&(0,e.jsxs)("div",{style:{wordBreak:"break-all"},children:[(0,e.jsx)("span",{style:{color:"#7f7f7f",fontWeight:"bold"},children:"\u8282\u70B9 Tag\uFF1A"}),Y.name||" ","\xA0",(0,e.jsx)(le.TI,{text:Y.name})]})]})]})})})},G=function(d){var y=d==null?void 0:d.mixed_info;if(!y||(d==null?void 0:d.agent_type)!=="mixed")return(0,e.jsx)(e.Fragment,{});var U=y.status||d.agent_type==="mixed"&&Z!==1&&"pending"||"",O=f(U);if(!O)return(0,e.jsx)(e.Fragment,{});var Y=(0,e.jsx)("div",{className:"job-server-status-container server-status-".concat(U),onClick:function(Se){return Se.stopPropagation()},children:(0,e.jsxs)(Hr.Z,{placement:"top",content:w(d,O,y),trigger:"hover",children:[(0,e.jsxs)("div",{className:"img-box flex-center",children:[(0,e.jsx)("i",{className:"iconfont icon-xuniji img"}),U==="progress"&&(0,e.jsx)("div",{className:"animation-line"}),(U==="created_failed"||U==="destroyed_failed")&&(0,e.jsx)("div",{className:"failed-text",children:"\uFF01"})]}),(0,e.jsx)("div",{className:"text",children:O}),E===0&&(0,e.jsxs)("div",{className:"first-line-box first-line-".concat(Z),children:[(0,e.jsx)("div",{className:"first-line"}),(0,e.jsx)("div",{className:"first-arrow",children:(0,e.jsx)(Kr.Z,{className:"icon"})})]})]})});return Y},ie=function(d,y){return Ur(d,re,Z),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"item-container",children:[(0,e.jsxs)("div",{style:{position:"relative"},children:[E!==0&&(0,e.jsx)("div",{className:"job-left-arrow other-left-arrow",children:(0,e.jsx)(Kr.Z,{className:"icon"})}),G(d),(0,e.jsxs)("h3",{className:"job-item-detail flex-start ".concat(d.cloned&&"job-item-detail-cloned"),children:[(0,e.jsx)("div",{className:"flow-mark-job",children:"Job"}),(d.status==="pending"||!d.status)&&(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("span",{className:"detail-num flex-center",children:[E+1,"-",y+1]})}),(d.status==="pending"||!d.status)&&d.trigger_type==="MANUAL"&&(0,e.jsx)(tn.Z,{title:"\u624B\u52A8\u89E6\u53D1",children:(0,e.jsx)("div",{className:"flex-center job-item-manual-type",children:(0,e.jsx)(Kr.Z,{onClick:function(O){return pe(O,d)}})})}),Z===3&&d.status!=="pending"&&(0,e.jsxs)("div",{className:"detail-left-box",children:[d.status==="running"&&(0,e.jsxs)("div",{className:"detail-runing flex-center",children:[(0,e.jsx)(Xr.Z,{}),"\xA0\xA0"]}),d.status==="success"&&(0,e.jsxs)("div",{className:"detail-success flex-center animation-success",children:[(0,e.jsx)("i",{className:"iconfont icon-success-fill success-icon"}),"\xA0\xA0"]}),(d.status==="failed"||d.status==="timeout")&&(0,e.jsxs)("div",{className:"detail-failed flex-center",children:[(0,e.jsx)("i",{className:"iconfont icon-error-fill success-icon"}),"\xA0\xA0"]}),d.status==="canceled"&&(0,e.jsxs)("div",{className:"detail-canceled flex-center",children:[d!=null&&d.fast_fail_cancel?(0,e.jsx)(tn.Z,{title:"FastFail",children:(0,e.jsx)(Yn.Z,{style:{marginTop:"3px",fontSize:"16px"}})}):(0,e.jsx)(En.Z,{style:{marginTop:"3px",fontSize:"16px"}}),"\xA0\xA0"]}),d.status==="skipped"&&(0,e.jsxs)("div",{className:"detail-canceled flex-center",children:[(0,e.jsx)("i",{className:"iconfont icon-tiaoguofenxiang success-icon"}),"\xA0\xA0"]})]}),(0,e.jsx)("div",{className:"detail-name",children:(0,e.jsx)(le.Bc,{text:d.name,children:(0,e.jsx)("div",{children:d.name})})}),ne(d),Z===1&&d.vaildFormError&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"operate-danger flex-center",children:(0,e.jsx)("i",{className:"iconfont icon-weixian"})}),"\xA0"]}),d.status&&d.status!=="pending"&&(0,e.jsx)("div",{className:"detail-time",children:(0,L.yL)(d.localDuration||10)}),(0,e.jsx)("i",{className:"iconfont icon-doc_on_clipboard_fill detail-operate-add",onClick:function(O){return S(O,2,E,y,d)}}),(0,e.jsx)("div",{className:"detail-operate-close flex-center",onClick:function(O){return ee(O,E,y)},children:(0,e.jsx)(Pn.Z,{})})]})]}),h(d.tasks,y,E,d,me)]}),xe(E,y),N(l,E,y)]})},D=function(d){return(0,e.jsx)("div",{className:"job-item-arrow-expand flex-center common-animation-arrow ".concat(d.taskShow&&"common-animation-arrow-active"),onClick:function(U){U.stopPropagation(),ze(d)},children:(0,e.jsx)(kn.Z,{})})},Fr=function(d,y,U){y.stageIndex=E,y.jobIndex=U,a(d,y)};return(0,e.jsx)("ul",{className:"jobs-box",ref:ke,children:l.map(function(Ae,d){return(0,e.jsxs)("li",{className:"job-item ".concat(!Ae.active&&"job-item-disabled"," job-item-status-").concat(ye(Ae.status)),onClick:function(U){return Fr(U,Ae,d)},onDragEnter:v,onDragLeave:g,onDragEnd:M,draggable:Z==1,onDragStart:R,"data-id":Ae.id,"data-current-index":"".concat(E,"-").concat(d),children:[D(Ae),ie(Ae,d)]},Ae.id)})})}var ae=Fe,de=r(24019),We=r(29158),Or=r(83056),Qr=null,qr=0,jn=null,$r=!1;function Mn(s){var l=s.tasks,a=s.job,S=s.showConfigDetail,h=s.jobIndex,E=s.stageIndex,ee=s.addStep,Z=s.deleteStep,ye=s.type,me=s.renderExecStatusClassName,$=s.stageList,be=s.update,Ze=s.openReviewModal,pe=(0,n.useReducer)(function(M){return M+=1},0),Ee=m()(pe,2),ze=Ee[1],ke=function(v){return v.atom_logo?(0,e.jsx)("img",{src:v.atom_logo,className:"item-logo",draggable:!1}):(0,e.jsx)("i",{className:"iconfont icon-placeholder_1 step-item-icon",draggable:!1})},Ie=function(v,g){if(a.status!=="pending")switch(v.status){case"pending":return(0,e.jsx)(de.Z,{className:"step-item-icon-pending"});case"running":case"manual_confirm":return(0,e.jsx)(Xr.Z,{className:"step-item-icon-running"});default:return(0,e.jsx)(e.Fragment,{})}return(0,e.jsx)(e.Fragment,{})},rr=function(v,g){return(0,e.jsx)(e.Fragment,{children:v.vaildFormError?(0,e.jsx)("div",{className:"step-operate-danger flex-center",children:(0,e.jsx)("i",{className:"iconfont icon-weixian"})}):(0,e.jsx)("i",{className:"iconfont icon-doc_on_clipboard_fill step-operate-add",onClick:function(w){return ee(w,2,E,h,g,v,!0)}})})},re=function(v,g,f){g.stageIndex=E,g.jobIndex=h,g.stepIndex=f,S(v,g)},B=function(v,g,f){g.stageIndex=E,g.jobIndex=h,g.stepIndex=f,Ze(v,g)},T=function(v){return v.split("-")},xe=function(v){v.stopPropagation(),$r=!0;var g=v.target;jn=g.parentNode,g.style.opacity=".3",Qr=g,qr=v.clientX},Pe=function(v){$r=!1,v.stopPropagation();var g=v.clientY,f=v.target;f.style.opacity="1";var w=f.dataset.currentIndex,G=T(w),ie=m()(G,3),D=ie[0],Fr=ie[1],Ae=ie[2],d=[],y=f.previousElementSibling;if(y){y=f.previousElementSibling,d=T(y.dataset.currentIndex),D===d[0]&&Fr===d[1]?qr>g&&(d[2]=d[2]*1+1):d[2]=d[2]*1+1;var U=$[d[0]].jobs[d[1]].tasks.length-1;d[2]*1===U&&(d[2]=U+1)}else y=f.nextElementSibling,d=T(y.dataset.currentIndex),d[2]=0;var O=$[D].jobs[Fr].tasks.splice(Ae,1);$[d[0]].jobs[d[1]].tasks.splice(d[2],0,O[0]),(D!==d[0]||Fr!==d[1])&&(f.parentNode.removeChild(f),jn.insertBefore(Qr,jn.firstChild)),$[D].jobs[Fr].tasks.length<=0&&$[D].jobs.splice(Fr,1),$[D].jobs.length<=0&&$.splice(D,1),qr=g,ze(),be()},N=function(v){if(v.stopPropagation(),v.preventDefault(),!!$r){var g=v.clientY,f=v.target.closest(".step-item");if(Qr&&f&&f.dataset.id!==Qr.dataset.id){var w=f.closest(".step-box");w&&(qr>g?w.insertBefore(Qr,f):w.insertBefore(Qr,f.nextElementSibling),qr=g)}}},ne=function(v){var g=[];return v.subpipeline_url&&(g=[{key:"1",label:(0,e.jsxs)("div",{onClick:function(w){window.open(v.subpipeline_url)},children:[(0,e.jsx)(We.Z,{})," \u8DF3\u8F6C"]})}]),(0,e.jsx)("div",{className:"step-item-more",children:g.length>0&&(0,e.jsx)(je.Z,{menu:{items:g},overlayClassName:"job-more-dropdown",children:(0,e.jsx)(vr.ZP,{type:"text",className:"detail-retry-op-more",icon:(0,e.jsx)(vn.Z,{}),onClick:function(w){return w.stopPropagation()}})})})},z=function(v){if(v.atom_name!=="Redis MQ"||!v.message_count||v.message_count<=0)return(0,e.jsx)(e.Fragment,{});var g=(v==null?void 0:v.progress_in_percent)||0;return(0,e.jsx)("div",{className:"step-item-redis-progress",children:(0,e.jsx)(tn.Z,{title:g+"%",children:(0,e.jsxs)("div",{className:"progress-line-box",children:[(0,e.jsx)("div",{className:"box-line ".concat(g===100&&"finish"," "),style:{height:"".concat(g,"%")}}),(0,e.jsxs)("div",{className:"box-round flex-center ".concat(g===100&&"finish","  scale"),style:{top:20-30*(g/100)+"px"},children:[g,"%"]})]})})})},R=function(v,g){var f,w;return Ur(v,ze,ye),(0,e.jsxs)("li",{className:"step-item flex-start ".concat((!v.active||ye===3&&!v.runActive)&&"step-item-disabled"," ").concat(ye===1&&v.vaildFormError&&"step-empty"," step-item-status-").concat(me(v.status)," ").concat((v==null||(f=v.variables)===null||f===void 0?void 0:f.atomType)==="manual"&&ye===3&&(v.status==="running"||v.status==="manual_confirm")&&"task-manual-status"),onClick:function(ie){return re(ie,v,g)},onDragEnter:N,onDragEnd:Pe,onDragStart:xe,draggable:ye==1,"data-id":v.id,"data-current-index":"".concat(E,"-").concat(h,"-").concat(g),children:[(0,e.jsx)("div",{className:"flow-mark-task",children:"Task"}),z(v),ne(v),(v==null||(w=v.variables)===null||w===void 0?void 0:w.atomType)==="manual"&&(0,e.jsxs)("div",{className:"review-container ".concat(v.status==="pending"?"review-action":"review-hover"),onClick:function(ie){return B(ie,v,g)},children:[(0,e.jsx)("img",{src:"http://10.12.110.200:8080/dolphin/weekly_report/1702892530.803212_cd22e1f92c9e73b96150790a7ca5702.png",style:{width:"20px"},draggable:"false"}),"\xA0",(0,e.jsx)("span",{children:"\u4EBA\u5DE5\u4EFB\u52A1"})]}),ye===1&&(0,e.jsxs)(e.Fragment,{children:[g===0&&(0,e.jsx)("div",{className:"flex-center  common-add-button add-step-item-first",onClick:function(ie){return ee(ie,3,E,h,g,{})},children:(0,e.jsx)("i",{className:"iconfont icon-add_bold"})}),(0,e.jsx)("div",{className:"flex-center add-step common-add-button add-step-item",onClick:function(ie){return ee(ie,3,E,h,g,{},!0)},children:(0,e.jsx)("i",{className:"iconfont icon-add_bold"})})]}),ye===1&&rr(v,g),a.status!=="pending"&&v.status&&(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:"step-item-left flex-center",children:[Ie(v,g),(0,Or.ft)(v.status)]})}),ke(v),(0,e.jsx)("span",{className:"step-item-name",style:{maxWidth:ye===3?"110px":"150px"},children:(0,e.jsx)(le.Bc,{text:v.name,children:(0,e.jsx)("div",{children:v.name})})}),v.status&&v.status!=="pending"&&v.status!=="skipped"&&(0,e.jsx)("div",{className:"step-item-time step-item-time-".concat(v.status),children:(0,L.yL)(v.localDuration||v.duration||2)}),(0,e.jsx)("div",{className:"step-operate-close flex-center",onClick:function(ie){return Z(ie,E,h,g)},children:(0,e.jsx)(Pn.Z,{})})]},v.id)};return(0,e.jsxs)("ul",{className:"step-box",children:[l.map(function(M,v){return R(M,v)}),ye===1&&(0,e.jsx)("div",{className:"flex-center add-step common-add-button",onClick:function(v){return ee(v,1,E,h)},children:(0,e.jsx)("i",{className:"iconfont icon-add_bold"})})]})}var On=Mn,yn=r(61254),un=r(90814),V=r(81182),Qe=r(96456),k=r(84567);function xr(s,l){var a=s.config,S=s.type,h=(0,n.useState)(!0),E=m()(h,2),ee=E[0],Z=E[1],ye=(0,n.useRef)(null),me=V.Z.useForm(),$=m()(me,1),be=$[0];(0,n.useImperativeHandle)(l,function(){return{validateFields:pe}}),(0,n.useEffect)(function(){Ze()},[]);var Ze=function(){be.setFieldValue("active",a.active),be.setFieldValue("name",a.name),be.setFieldValue("plugin",a.plugin||null),be.setFieldValue("run_condition",a.run_condition),be.setFieldValue("consumption",a.consumption)},pe=function(){var ke=p()(o()().mark(function Ie(){var rr;return o()().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return B.prev=0,B.next=3,be.validateFields();case 3:rr=B.sent,Object.keys(rr).forEach(function(T){if(T.includes("0.")){delete rr[T];return}a[T]=rr[T]}),a.vaildFormError=!1,B.next=11;break;case 8:B.prev=8,B.t0=B.catch(0),a.vaildFormError=!0;case 11:case"end":return B.stop()}},Ie,null,[[0,8]])}));return function(){return ke.apply(this,arguments)}}(),Ee=function(Ie){},ze=function(Ie){a.run_cond_custom_var=Ie};return(0,e.jsxs)(V.Z,{layout:"vertical",form:be,name:"control-hooks",disabled:S!==1,onValuesChange:Ee,className:"flow-stage-config-container",children:[(0,e.jsx)(V.Z.Item,{name:"name",label:"Stage \u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u540D\u79F0"}],initialValue:a.name,children:(0,e.jsx)(Qe.Z,{value:a.name,maxLength:50,placeholder:"\u957F\u5EA6\u4E3A50\u4E2A\u5B57\u7B26"})}),(0,e.jsxs)("div",{className:"control-box",children:[(0,e.jsxs)("div",{className:"control flex-space-between",onClick:function(){return Z(!ee)},children:["\u6D41\u7A0B\u63A7\u5236\u9009\u9879",(0,e.jsx)(kn.Z,{className:"control-arrow ".concat(!ee&&"control-arrow-action")})]}),(0,e.jsx)("div",{className:"form-control",style:{display:ee?"block":"none"},children:(0,e.jsx)(V.Z.Item,{name:"active",valuePropName:"checked",colon:!1,children:(0,e.jsx)(k.Z,{children:"\u542F\u7528\u672C Stage"})})})]})]})}var qe=(0,n.forwardRef)(xr),cr=r(13769),Lr=r.n(cr),ue=r(94060),Ye=r(78045),Br=r(25035),on=r(52745),Dn=r(24969),zr=[[{fieldLevel:"variables.KUBERNETES_CPU_REQUEST",formItemConfig:{name:"KUBERNETES_CPU_REQUEST",label:"CPU \u9700\u6C42\uFF08\u6838\uFF09",required:!0,message:"",initialValue:32,style:{width:"48%"},validator:"limitNumber"},componentConfig:{type:"input",placeholder:"\u8BF7\u8F93\u5165",inputType:"number",min:1,max:2048}},{fieldLevel:"variables.KUBERNETES_CPU_LIMIT",formItemConfig:{name:"KUBERNETES_CPU_LIMIT",label:"CPU \u9650\u5236\uFF08\u6838\uFF09",required:!1,message:"",initialValue:2048,style:{width:"48%"},validator:"limitNumber"},componentConfig:{type:"input",placeholder:"\u8BF7\u8F93\u5165",inputType:"number",min:1,max:2048}}],[{fieldLevel:"variables.KUBERNETES_MEMORY_REQUEST",formItemConfig:{name:"KUBERNETES_MEMORY_REQUEST",label:"\u5185\u5B58\u9700\u6C42\uFF08Gi\uFF09",required:!0,message:"",initialValue:32,style:{width:"48%"},validator:"limitNumber"},componentConfig:{type:"input",placeholder:"\u8BF7\u8F93\u5165",inputType:"number",min:1,max:1048576}},{fieldLevel:"variables.KUBERNETES_MEMORY_LIMIT",formItemConfig:{name:"KUBERNETES_MEMORY_LIMIT",label:"\u5185\u5B58\u9650\u5236\uFF08Gi\uFF09",required:!1,message:"",initialValue:128,style:{width:"48%"},validator:"limitNumber"},componentConfig:{type:"input",placeholder:"\u8BF7\u8F93\u5165",inputType:"number",min:1,max:1048576}}]],Ir=[{label:"middle-priority",value:"middle-priority"},{label:"daily-high-priority",value:"daily-high-priority"},{label:"daily-middle-priority",value:"daily-middle-priority"},{label:"daily-low-priority",value:"daily-low-priority"},{label:"ci-high-priority",value:"ci-high-priority"}],ge=r(11238),kr=function(l){return request("/api/test",{method:"get",params:l})},jr=function(l){return(0,ge.ZP)("/api/pipeline/runner/type",{method:"get",params:l})},He=function(l){return(0,ge.ZP)("/api/pipeline/runner/tags",{method:"get",params:l})},Jr=function(l){return(0,ge.ZP)("/api/pipeline/openstack_templates/list",{method:"get",params:l})},hr=r(5150),en=r(48807),Tr=r(53678),mn=[{label:"\u7269\u7406\u673A",value:"metal"},{label:"Openstack \u865A\u62DF\u673A",value:"openstack"}],An=function(l){return request("/api/test",{method:"get",params:l})},_n=function(l){return(0,ge.ZP)("/api/devices/vm_config/list",{method:"get",params:l})},Cn=function(l){return(0,ge.ZP)("/api/devices/zone/list",{method:"get",params:l})},yr=["key","name"];function dr(s,l){var a=s.form,S=s.type,h=(0,n.useState)([]),E=m()(h,2),ee=E[0],Z=E[1],ye=(0,n.useState)([]),me=m()(ye,2),$=me[0],be=me[1],Ze=(0,n.useState)([]),pe=m()(Ze,2),Ee=pe[0],ze=pe[1];(0,n.useImperativeHandle)(l,function(){return{getOptionsData:ke}});var ke=function(){Ie(),rr(0),re()},Ie=function(){var z=p()(o()().mark(function R(){var M,v;return o()().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,He({size:1e3,page_num:1,agent_type:"metal"});case 2:M=f.sent,v=M.data,Z(v.map(function(w){return{label:w,value:w}}));case 5:case"end":return f.stop()}},R)}));return function(){return z.apply(this,arguments)}}(),rr=function(){var z=p()(o()().mark(function R(M){var v,g;return o()().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,Cn({gcu:M});case 2:v=w.sent,g=v.data,be(g.map(function(G){return{label:G,value:G}}));case 5:case"end":return w.stop()}},R)}));return function(M){return z.apply(this,arguments)}}(),re=function(){var z=p()(o()().mark(function R(M){var v,g;return o()().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.prev=0,w.next=3,_n({gcu:M});case 3:v=w.sent,g=v.data,ze(g.map(function(G){return{label:G.name,value:G.flavor_id}})),w.next=10;break;case 8:w.prev=8,w.t0=w.catch(0);case 10:case"end":return w.stop()}},R,null,[[0,8]])}));return function(M){return z.apply(this,arguments)}}(),B=function(R,M,v,g){R.stopPropagation(),M(g),a.validateFields()},T=function(R){R(),setTimeout(function(){a.validateFields()},200)},xe=function(R,M,v){var g=a.getFieldValue(["mixed_list",R,"type"]);if(!g)return(0,e.jsx)(e.Fragment,{});switch(g){case"metal":return N(M,v,R);case"openstack":return Pe(M,v,R)}},Pe=function(R,M,v){return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(V.Z.Item,x()(x()({},R),{},{name:[M,"zone"],label:"\u53EF\u7528\u533A",rules:[{required:!0,message:"\u8BF7\u9009\u62E9"}],children:(0,e.jsx)(ue.Z,{placeholder:"\u8BF7\u9009\u62E9",options:$,allowClear:!0,showSearch:!0,optionFilterProp:"children",filterOption:function(f,w){var G;return((G=w==null?void 0:w.label)!==null&&G!==void 0?G:"").toLocaleLowerCase().includes(f.toLocaleLowerCase())}})})),(0,e.jsx)(V.Z.Item,x()(x()({},R),{},{name:[M,"config_id"],label:"\u89C4\u683C",rules:[{required:!0,message:"\u8BF7\u9009\u62E9"}],children:(0,e.jsx)(ue.Z,{placeholder:"\u8BF7\u9009\u62E9",options:Ee,allowClear:!0,showSearch:!0,optionFilterProp:"children",onChange:function(f){var w=Ee.find(function(G){return G.value===f});w&&a.setFieldValue(["mixed_list",v,"config_name"],w.label)},filterOption:function(f,w){var G;return((G=w==null?void 0:w.label)!==null&&G!==void 0?G:"").toLocaleLowerCase().includes(f.toLocaleLowerCase())}})})),(0,e.jsx)(V.Z.Item,x()(x()({},R),{},{name:[M,"config_name"],label:"",style:{display:"none"},children:(0,e.jsx)(Qe.Z,{})}))]})},N=function(R,M,v){return(0,e.jsx)(V.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(){var f=a.getFieldValue(["mixed_list",v,"has_variable_in_tag"]);return(0,e.jsxs)("div",{className:"flex-space-between",children:[f?(0,e.jsx)(V.Z.Item,x()(x()({},R),{},{name:[M,"name"],label:"\u8282\u70B9 Tag",style:{width:"85%"},rules:[{required:!0,message:"\u8BF7\u8F93\u5165"}],children:(0,e.jsx)(Qe.Z,{placeholder:"\u81EA\u5B9A\u4E49",style:{height:"32px"}})})):(0,e.jsx)(V.Z.Item,x()(x()({},R),{},{name:[M,"name"],label:"\u8282\u70B9 Tag",style:{width:"85%"},rules:[{required:!0,message:"\u8BF7\u9009\u62E9"}],children:(0,e.jsx)(ue.Z,{allowClear:!0,showSearch:!0,placeholder:"\u8BF7\u9009\u62E9",optionFilterProp:"children",filterOption:function(G,ie){var D;return((D=ie==null?void 0:ie.label)!==null&&D!==void 0?D:"").toLocaleLowerCase().includes(G.toLocaleLowerCase())},options:ee,style:{width:"100%"}})})),(0,e.jsx)(V.Z.Item,x()(x()({},R),{},{noStyle:!0,name:[M,"has_variable_in_tag"],label:"",style:{width:"300px"},valuePropName:"checked",initialValue:!1,children:(0,e.jsx)(k.Z,{onChange:function(G){a.setFieldValue(["mixed_list",v,"name"],void 0)},children:"\u81EA\u5B9A\u4E49"})}))]})}})},ne=a.getFieldValue("mixed_list")||[];return(0,e.jsx)("div",{className:"flow-line-jobConfig-mixed-container",children:(0,e.jsx)(V.Z.List,{name:"mixed_list",style:{marbottom:"0"},children:function(R,M){var v=M.add,g=M.remove;return(0,e.jsxs)(e.Fragment,{children:[R.map(function(f,w){var G=f.key,ie=f.name,D=Lr()(f,yr);return(0,e.jsxs)("div",{className:"item-runtime_var",children:[(0,e.jsx)(V.Z.Item,x()(x()({},D),{},{name:[ie,"type"],initialValue:"metal",style:{marginBottom:"5px"},children:(0,e.jsx)(Ye.ZP.Group,{options:mn})})),xe(w,D,ie),S===1&&ne.length>1&&(0,e.jsx)("div",{className:"minus flex-center",onClick:function(Ae){return B(Ae,g,w,ie)},children:(0,e.jsx)(on.Z,{})})]})}),(0,e.jsx)(V.Z.Item,{noStyle:!0,children:S===1&&(0,e.jsx)("div",{className:"plus flex-center",onClick:function(){return T(v)},children:(0,e.jsx)(Dn.Z,{})})})]})}})})}var Q=(0,n.forwardRef)(dr),Je=r(12627),Vr=["key","name"],he=Qe.Z.TextArea;function t(s,l){var a=s.config,S=s.type,h=(0,n.useState)(!0),E=m()(h,2),ee=E[0],Z=E[1],ye=(0,n.useState)(!0),me=m()(ye,2),$=me[0],be=me[1],Ze=(0,n.useState)([]),pe=m()(Ze,2),Ee=pe[0],ze=pe[1],ke=(0,n.useState)([]),Ie=m()(ke,2),rr=Ie[0],re=Ie[1],B=(0,n.useState)([]),T=m()(B,2),xe=T[0],Pe=T[1],N=(0,n.useReducer)(function(tr){return tr+=1},0),ne=m()(N,2),z=ne[1],R=(0,n.useRef)(zr),M=(0,n.useRef)(null),v=(0,n.useRef)(null),g=(0,n.useRef)(null),f=(0,n.useRef)(null),w=(0,n.useRef)(null),G=V.Z.useForm(),ie=m()(G,1),D=ie[0];(0,n.useImperativeHandle)(l,function(){return{validateFields:U}}),(0,n.useEffect)(function(){Ae(),Fr(),y()},[]);var Fr=function(){D.setFieldValue("name",a.name),D.setFieldValue("agent_type",a.agent_type||"kubernetes"),oe(a.agent_type||"kubernetes"),D.setFieldValue("image",a.image||"mobile"),D.setFieldValue("trigger_type",a.trigger_type||"AUTO"),D.setFieldValue("fast_fail",a.fast_fail),D.setFieldValue("sample_count",a.sample_count),D.setFieldValue("threshold",a.threshold),a.image_info===void 0&&(a.image_info="artifact.enflame.cn/enflame_docker_images/ubuntu/qic_ubuntu_1804_gcc7:latest"),D.setFieldValue("image_info",a.image_info),D.setFieldValue("pull_policy",a.pull_policy),D.setFieldValue("priority_class_name",a.priority_class_name),D.setFieldValue("pod_spec_patch",a.pod_spec_patch),D.setFieldValue("node_selector",a.node_selector||[]),D.setFieldValue("mixed_list",a.mixed_list||[]),D.setFieldValue("cloned",a.cloned),D.setFieldValue("auto_calculate_cloned_count",a.auto_calculate_cloned_count),D.setFieldValue("cloned_count",a.cloned_count||1),D.setFieldValue("tag",a.tag),D.setFieldValue("has_variable_in_tag",a.has_variable_in_tag),D.setFieldValue("template_name",a.template_name),D.setFieldValue("tag_or_vm",a.tag_or_vm||"tag");var F=a.timeout;F<=0&&(F=""),D.setFieldValue("timeout",F),D.setFieldValue("active",a.active),D.setFieldValue("allow_failure",a.allow_failure),D.setFieldValue("run_condition",a.run_condition||"pre_task_success"),z(),setTimeout(function(){a.custom_env&&M.current.setValue(a.custom_env),a.mounts&&v.current.setValue(a.mounts),a.run_cond_custom_var&&w.current.setValue(a.run_cond_custom_var)},0),setTimeout(function(){D.validateFields()},100)},Ae=function(){var tr=p()(o()().mark(function F(){var J,we;return o()().wrap(function(sn){for(;;)switch(sn.prev=sn.next){case 0:return sn.next=2,Jr({size:1e3,page_num:1});case 2:J=sn.sent,we=J.data,Pe(we.map(function(ir){return{label:ir,value:ir}}));case 5:case"end":return sn.stop()}},F)}));return function(){return tr.apply(this,arguments)}}(),d=function(){var tr=p()(o()().mark(function F(J){var we,Rr;return o()().wrap(function(ir){for(;;)switch(ir.prev=ir.next){case 0:return ir.next=2,He({size:1e3,page_num:1,agent_type:J});case 2:we=ir.sent,Rr=we.data,re(Rr.map(function(an){return{label:an,value:an}}));case 5:case"end":return ir.stop()}},F)}));return function(J){return tr.apply(this,arguments)}}(),y=function(){var tr=p()(o()().mark(function F(){var J,we,Rr,sn,ir;return o()().wrap(function(Rn){for(;;)switch(Rn.prev=Rn.next){case 0:return Rn.next=2,jr();case 2:J=Rn.sent,we=J.success,Rr=we===void 0?!1:we,sn=J.data,ir=sn===void 0?[]:sn,ze(ir||[]);case 8:case"end":return Rn.stop()}},F)}));return function(){return tr.apply(this,arguments)}}(),U=function(){var tr=p()(o()().mark(function F(){var J,we,Rr;return o()().wrap(function(ir){for(;;)switch(ir.prev=ir.next){case 0:return ir.prev=0,ir.next=3,D.validateFields();case 3:J=ir.sent,J.nfs?O("mounts"):a.mounts=null,a.run_condition=J.run_condition,Object.keys(J).forEach(function(an){nr(an,J[an])}),O("custom_env"),a.vaildFormError=!1,ir.next=17;break;case 11:ir.prev=11,ir.t0=ir.catch(0),a.node_selector=(ir.t0===null||ir.t0===void 0||(we=ir.t0.values)===null||we===void 0?void 0:we.node_selector)||[],a.mixed_list=(ir.t0===null||ir.t0===void 0||(Rr=ir.t0.values)===null||Rr===void 0?void 0:Rr.mixed_list)||[],ir.t0.errorFields.forEach(function(an){var Rn=an.name[0];(Rn==="custom_env"||Rn==="mounts")&&O(Rn)}),a.vaildFormError=!0;case 17:case"end":return ir.stop()}},F,null,[[0,11]])}));return function(){return tr.apply(this,arguments)}}(),O=function(F){var J=F==="custom_env"?M.current:v.current;J&&(a[F]=J.getValue())},Y=function(F){z(),Object.keys(F).forEach(function(J){var we=F[J];switch(J){default:nr(J,we)}})},nr=function(F,J){var we,Rr=void 0;if(R==null||(we=R.current)===null||we===void 0||we.forEach(function(sn){sn.forEach(function(ir){var an=ir.fieldLevel,Rn=ir.formItemConfig.name;Rn===F&&an&&(Rr=!0,an.split(".").reduce(function(ra,sr,j,b){return j===b.length-1&&(ra[sr]=J),ra[sr]},a))})}),!Rr)switch(F){case"timeout":a.timeout=J||0;break;case"run_cond_custom_var":a.run_cond_custom_var=w.current.getValue().map(function(sn){return{key:sn.key,value:sn.value}});break;default:a[F]=J}},Se=function(){for(var F=M.current.getValue(),J=0;J<F.length;J++){var we=F[J];if(!we.key)return Promise.reject(new Error("\u8BF7\u586B\u5199 key"));if(!we.value)return Promise.reject(new Error("\u8BF7\u586B\u5199 value"))}return Promise.resolve()},H=function(){for(var F=v.current.getValue(),J=0;J<F.length;J++){var we=F[J];if(!we.source)return Promise.reject(new Error("\u8BF7\u586B\u5199 key"));if(!we.destination)return Promise.reject(new Error("\u8BF7\u586B\u5199 value"))}return Promise.resolve()},P=function(F,J){var we=/^\d+$/;if(!we.test(J)||!J||J<=0||J>9)return Promise.reject("\u8BF7\u8F93\u51651~9\u4E4B\u95F4\u7684\u6574\u6570");var Rr=String(J);return Rr.length>=2&&Rr[0]==="0"||Rr.includes(".")?Promise.reject("\u8BF7\u8F93\u51651~9\u4E4B\u95F4\u7684\u6574\u6570"):Promise.resolve()},ve=function(F){if(!F)return F;var J=/^\d+$/;return J.test(F)&&Number(F),F},oe=function(F){var J=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,we=Object.assign([],zr);R.current=we,F!=="kubernetes"&&(we=[]),J&&(a.tag=void 0,D.setFieldValue("tag",void 0)),R.current=we,F==="mixed"?setTimeout(function(){f.current.getOptionsData(),(!a.mixed_list||a.mixed_list.length<=0)&&D.setFieldValue("mixed_list",[{}])},100):d(F)},C=function(){return(0,e.jsx)(V.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(){var J=D.getFieldValue("has_variable_in_tag");return(0,e.jsxs)("div",{className:"flex-space-between",children:[J?(0,e.jsx)(V.Z.Item,{name:"tag",label:"\u8282\u70B9 Tag",style:{width:"85%"},children:(0,e.jsx)(Qe.Z,{placeholder:"\u81EA\u5B9A\u4E49",style:{height:"32px"}})}):(0,e.jsx)(V.Z.Item,{name:"tag",label:"\u8282\u70B9 Tag",style:{width:"85%"},children:(0,e.jsx)(ue.Z,{allowClear:!0,showSearch:!0,placeholder:"\u8BF7\u9009\u62E9",optionFilterProp:"children",filterOption:function(Rr,sn){var ir;return((ir=sn==null?void 0:sn.label)!==null&&ir!==void 0?ir:"").toLocaleLowerCase().includes(Rr.toLocaleLowerCase())},options:rr,style:{width:"100%"}})}),(0,e.jsx)(V.Z.Item,{noStyle:!0,name:"has_variable_in_tag",label:"",style:{width:"300px"},valuePropName:"checked",initialValue:!1,children:(0,e.jsx)(k.Z,{onChange:function(Rr){a.tag=void 0,D.setFieldValue("tag",void 0)},children:"\u81EA\u5B9A\u4E49"})})]})}})},Ue=function(F,J){if(J){if(J.length>100)return Promise.reject("\u6700\u591A\u8F93\u5165100\u4E2A\u5B57\u7B26")}else return Promise.reject("\u8BF7\u8F93\u5165Tag");return Promise.resolve()},ar=function(F){F(),setTimeout(function(){D.validateFields()},200)},wr=function(){return(0,e.jsx)(V.Z.Item,{label:"Tag",name:"template_name",rules:[{required:!0,message:""},{validator:Ue}],children:(0,e.jsx)(Qe.Z,{placeholder:"\u53EF\u4EE5\u8F93\u5165\u591A\u4E2A\uFF0C\u4EE5 || \u5206\u9694"})})},bn=function(F,J,we,Rr){F.stopPropagation(),J(Rr),D.validateFields()},fr=function(F,J){var we=/^[1-9]\d*$/;return we.test(J)?Promise.resolve():Promise.reject("\u8BF7\u8F93\u5165\u5927\u4E8E0\u7684\u6574\u6570")},hn=function(F,J){var we=/^([1-9]\d*|\$\{.+\})$/;return we.test(J)?Promise.resolve():Promise.reject("\u8BF7\u8F93\u5165\u5927\u4E8E0\u7684\u6574\u6570\u6216\u73AF\u5883\u53D8\u91CF")},Ln=function(F){a.run_cond_custom_var=F};return(0,e.jsxs)(V.Z,{layout:"vertical",className:"flow-job-config-container",form:D,name:"control-hooks",disabled:S!==1,onValuesChange:Y,children:[(0,e.jsx)(V.Z.Item,{name:"name",label:"Job \u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u540D\u79F0"}],initialValue:null,children:(0,e.jsx)(Qe.Z,{maxLength:50,placeholder:"\u957F\u5EA6\u4E3A50\u4E2A\u5B57\u7B26"})}),(0,e.jsx)(V.Z.Item,{name:"trigger_type",label:"\u89E6\u53D1\u65B9\u5F0F",initialValue:"AUTO",style:{marginBottom:"7px"},children:(0,e.jsxs)(Ye.ZP.Group,{children:[(0,e.jsx)(Ye.ZP,{value:"AUTO",children:"\u81EA\u52A8"}),(0,e.jsx)(Ye.ZP,{value:"MANUAL",children:"\u624B\u52A8"})]})}),(0,e.jsx)(V.Z.Item,{name:"fast_fail",label:"",initialValue:!1,valuePropName:"checked",style:{marginBottom:"10px"},children:(0,e.jsx)(k.Z,{children:"\u542F\u7528 FastFail"})}),(0,e.jsx)(V.Z.Item,{noStyle:!0,shouldUpdate:!0,children:function(){var F=D.getFieldValue("cloned"),J=D.getFieldValue("auto_calculate_cloned_count");return(0,e.jsxs)("div",{style:{border:"1px solid #eee",marginBottom:"10px",padding:"5px 10px"},children:[(0,e.jsx)(V.Z.Item,{name:"cloned",label:"",initialValue:!1,valuePropName:"checked",style:{marginBottom:"0px"},children:(0,e.jsx)(k.Z,{children:"\u52A8\u6001\u521B\u5EFA"})}),F&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"flex-start",style:{alignItems:"flex-start"},children:[(0,e.jsx)(V.Z.Item,{name:"auto_calculate_cloned_count",label:"\u521B\u5EFA\u65B9\u5F0F",initialValue:!0,style:{marginBottom:"3px"},children:(0,e.jsxs)(Ye.ZP.Group,{children:[(0,e.jsxs)(Ye.ZP,{value:!0,children:["\u81EA\u52A8\u8BA1\u7B97\xA0",(0,e.jsx)(tn.Z,{title:"\u81EA\u52A8\u8BA1\u7B97\uFF1A\u751F\u6210\u7684\u5E76\u884C Job \u6570\u91CF\uFF0C\u4ECB\u4E8E1~9\u4E4B\u95F4",children:(0,e.jsx)(Br.Z,{style:{fontSize:"14px",color:"#00000073",cursor:"help"}})})]}),(0,e.jsx)(Ye.ZP,{value:!1,children:"\u81EA\u5B9A\u4E49\u6570\u91CF"})]})}),!J&&(0,e.jsx)(V.Z.Item,{name:"cloned_count",label:" ",style:{flex:1,marginBottom:"5px"},initialValue:1,rules:[{required:!1,validator:P}],getValueFromEvent:function(Rr){return ve(Rr.target.value)},children:(0,e.jsx)(Qe.Z,{min:1,max:9,placeholder:"1~9\u4E4B\u95F4\u7684\u6574\u6570"})})]}),J&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(V.Z.Item,{name:"sample_count",label:"\u6837\u672C\u603B\u6570",rules:[{required:!0,message:""},{validator:hn}],style:{marginBottom:"5px"},children:(0,e.jsx)(Qe.Z,{placeholder:"\u8BF7\u8F93\u5165\u5927\u4E8E0\u7684\u6574\u6570\u6216\u683C\u5F0F\u4E3A${x}\u7684\u73AF\u5883\u53D8\u91CF"})}),(0,e.jsx)(V.Z.Item,{name:"threshold",label:"\u9608\u503C",rules:[{required:!0,message:""},{validator:hn}],children:(0,e.jsx)(Qe.Z,{placeholder:"\u8BF7\u8F93\u5165\u5927\u4E8E0\u7684\u6574\u6570\u6216\u683C\u5F0F\u4E3A${x}\u7684\u73AF\u5883\u53D8\u91CF"})})]})]})]})}}),(0,e.jsxs)("div",{className:"flow-job-config-agent-type",children:[(0,e.jsx)(V.Z.Item,{name:"agent_type",label:"\u6784\u5EFA\u8D44\u6E90\u7C7B\u578B",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u6784\u5EFA\u8D44\u6E90\u7C7B\u578B"}],initialValue:void 0,children:(0,e.jsx)(ue.Z,{options:Ee,onChange:function(F){return oe(F,!0)},fieldNames:{label:"value",value:"id"}})}),(0,e.jsx)(V.Z.Item,{noStyle:!0,shouldUpdate:!0,children:function(){var F=D.getFieldValue("agent_type");return F==="mixed"?(0,e.jsx)(Q,{form:D,config:a,type:S,ref:f}):["metal","kubernetes","docker"].includes(F)?C():(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(V.Z.Item,{noStyle:!0,shouldUpdate:!0,children:function(){var we=D.getFieldValue("tag_or_vm");switch(we){case"tag":return C();case"vm":return wr()}}})})}}),["kubernetes","docker"].includes(D.getFieldValue("agent_type"))&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(V.Z.Item,{name:"image",label:"\u955C\u50CF",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u955C\u50CF"}],initialValue:"mobile",children:(0,e.jsxs)(Ye.ZP.Group,{children:[(0,e.jsx)(Ye.ZP,{value:"list",disabled:!0,children:"\u4ECE\u5217\u8868\u9009\u62E9"}),(0,e.jsx)(Ye.ZP,{value:"mobile",children:"\u624B\u52A8\u8F93\u5165"})]})}),(0,e.jsx)(V.Z.Item,{name:"image_info",label:"\u8DEF\u5F84",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u955C\u50CF\u8DEF\u5F84"}],initialValue:"artifact.enflame.cn/enflame_docker_images/ubuntu/qic_ubuntu_1804_gcc7:latest",children:(0,e.jsx)(Qe.Z,{placeholder:"\u8BF7\u8F93\u5165\u5B8C\u6574\u955C\u50CF\u8DEF\u5F84\uFF0C\u5982 docker.io/bkci/ci"})}),(0,e.jsx)(V.Z.Item,{name:"pull_policy",label:"\u955C\u50CF\u62C9\u53D6\u7B56\u7565",children:(0,e.jsx)(ue.Z,{allowClear:!0,placeholder:"\u8BF7\u9009\u62E9",options:[{label:"never",value:"never"},{label:"if-not-present",value:"if-not-present"},{label:"always",value:"always"}]})})]}),(0,e.jsx)(Tr.Z,x()(x()({ref:g,form:D,config:a},s),{},{from:S,formItemlist:R==null?void 0:R.current})),(0,e.jsx)(V.Z.Item,{noStyle:!0,shouldUpdate:!0,children:function(){var F=D.getFieldValue("agent_type");return F!=="kubernetes"?(0,e.jsx)(e.Fragment,{}):(0,e.jsxs)(e.Fragment,{children:["nodeSelector",(0,e.jsx)(V.Z.List,{name:"node_selector",style:{marbottom:"0"},children:function(we,Rr){var sn=Rr.add,ir=Rr.remove;return(0,e.jsxs)(e.Fragment,{children:[we.map(function(an,Rn){var ra=an.key,sr=an.name,j=Lr()(an,Vr);return(0,e.jsx)("div",{className:"item-runtime_var",children:(0,e.jsxs)("div",{className:"flex-space-between",style:{alignItems:"flex-start",marginBottom:"5px"},children:[(0,e.jsx)(V.Z.Item,x()(x()({},j),{},{name:[sr,"key"],initialValue:"",rules:[{required:!0,message:"\u8BF7\u8F93\u5165"}],style:{marginBottom:"0px",width:"46%"},children:(0,e.jsx)(Qe.Z,{prefix:"key:",maxLength:100})})),(0,e.jsx)(V.Z.Item,x()(x()({},j),{},{name:[sr,"value"],initialValue:"",rules:[{required:!0,message:"\u8BF7\u8F93\u5165"}],style:{marginBottom:"0px",width:"46%"},children:(0,e.jsx)(Qe.Z,{prefix:"value:",maxLength:100})})),S===1&&(0,e.jsx)("div",{className:"minus flex-center",onClick:function(K){return bn(K,ir,Rn,sr)},children:(0,e.jsx)(on.Z,{})})]})})}),(0,e.jsx)(V.Z.Item,{noStyle:!0,children:S===1&&(0,e.jsx)("div",{className:"plus flex-center",onClick:function(){return ar(sn)},children:(0,e.jsx)(Dn.Z,{})})})]})}}),(0,e.jsx)(V.Z.Item,{label:"priorityClass",name:"priority_class_name",initialValue:"middle-priority",children:(0,e.jsx)(ue.Z,{options:Ir})}),(0,e.jsx)(V.Z.Item,{label:"\u81EA\u5B9A\u4E49 K8s \u914D\u7F6E",name:"pod_spec_patch",children:(0,e.jsx)(he,{placeholder:"\u8BF7\u8F93\u5165 yaml \u6587\u672C\u5185\u5BB9",autoSize:{minRows:2,maxRows:14}})})]})}})]}),(0,e.jsx)(en.Z,{ref:M,from:S,form:D,type:S}),(0,e.jsxs)("div",{className:"control-box",children:[(0,e.jsxs)("div",{className:"control flex-space-between",onClick:function(){return Z(!ee)},children:["\u6D41\u7A0B\u63A7\u5236\u9009\u9879",(0,e.jsx)(kn.Z,{className:"control-arrow ".concat(!ee&&"control-arrow-action")})]}),(0,e.jsxs)("div",{className:"form-control",style:{display:ee?"block":"none"},children:[(0,e.jsx)(V.Z.Item,{name:"active",valuePropName:"checked",colon:!1,children:(0,e.jsx)(k.Z,{children:"\u542F\u7528\u672C Job"})}),(0,e.jsx)(V.Z.Item,{name:"timeout",label:"Job \u6267\u884C\u8D85\u65F6\u65F6\u95F4",rules:[{required:!1,message:""},{validator:function(F,J){return hr.s.timeout(F,J,!1)}}],children:(0,e.jsx)(Qe.Z,{min:1,placeholder:"\u9ED8\u8BA4\u8D85\u65F6\u65F6\u95F4\u4E3A2\u5C0F\u65F6",type:"number",suffix:"\u5206\u949F"})}),(0,e.jsx)(V.Z.Item,{name:"run_condition",label:"\u4F55\u65F6\u8FD0\u884C\u672C Job",initialValue:"pre_task_success",children:(0,e.jsx)(ue.Z,{options:[{value:"pre_task_success",label:"\u524D\u7F6E Job \u90FD\u6210\u529F\u624D\u8FD0\u884C"},{value:"pre_task_failed_even_cancel",label:"\u524D\u7F6E Job \u6709\u5931\u8D25\u4E5F\u8FD0\u884C\uFF0C\u5373\u4F7F\u88AB\u53D6\u6D88\u4E5F\u8FD0\u884C"},{value:"pre_task_failed_but_cancel",label:"\u524D\u7F6E Job \u6709\u5931\u8D25\u4E5F\u8FD0\u884C\uFF0C\u9664\u975E\u88AB\u53D6\u6D88\u624D\u4E0D\u8FD0\u884C"},{value:"only_pre_task_failed_but_cancel",label:"\u53EA\u6709\u524D\u7F6E Job \u6709\u5931\u8D25\u65F6\u624D\u8FD0\u884C"},{value:"custom_variable_match",label:"\u81EA\u5B9A\u4E49\u53D8\u91CF\u5168\u90E8\u6EE1\u8DB3\u65F6\u8FD0\u884C"},{value:"custom_variable_match_not_run",label:"\u81EA\u5B9A\u4E49\u53D8\u91CF\u5168\u90E8\u6EE1\u8DB3\u65F6\u4E0D\u8FD0\u884C"}]})}),(0,e.jsx)(V.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(){var F=D.getFieldValue("run_condition");return F==="custom_variable_match"||F==="custom_variable_match_not_run"?(0,e.jsx)(Je.Z,{formCOnfig:{label:"\u53D8\u91CF",name:"run_cond_custom_var"},ref:w,from:S,form:D,type:S,value:"value",keys:"key",keyValueChange:Ln}):(0,e.jsx)(e.Fragment,{})}})]})]})]})}var _=(0,n.forwardRef)(t),A=r(29312),X=r(33160),ce=r(48296),Ar=r(32983);function er(s){var l=s.config,a=s.hide,S=s.modifyField,h=s.setConfig,E=s.list,ee=function(ye){l.atom_id=ye.uuid,l.atom_name=ye.name,l.atom_logo=ye.logo_url,l.atom_version=ye.version,S("name",ye.name),a()};return(0,e.jsx)(e.Fragment,{children:E.length<=0?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("br",{})," ",(0,e.jsx)("br",{})," ",(0,e.jsx)("br",{}),(0,e.jsx)(Ar.Z,{})]}):(0,e.jsx)("ul",{className:"flow-plugins-list-container common-scroll-bar",children:E.map(function(Z,ye){return(0,e.jsxs)("li",{className:"plugin-item flex-start",children:[(0,e.jsx)("div",{className:"item-left",children:(0,e.jsx)("img",{src:Z.logo_url})}),(0,e.jsxs)("div",{className:"item-center",children:[(0,e.jsx)("h2",{children:Z.name}),(0,e.jsx)("span",{dangerouslySetInnerHTML:{__html:Z==null?void 0:Z.description}})]}),(0,e.jsx)(vr.ZP,{disabled:Z.name===l.atom_name,onClick:function(){return ee(Z)},children:Z.name===l.atom_name?"\u5DF2\u9009\u62E9":"\u9009\u62E9"})]})})})})}var Gr=er,$e=function(l){return(0,ge.ZP)("/api/pipeline/atom/list",{method:"get",params:l})};function rn(s,l){var a=s.config,S=s.update,h=s.modifyField,E=s.setConfig,ee=(0,n.useState)({atom_info:[],atom_type:[]}),Z=m()(ee,2),ye=Z[0],me=Z[1],$=(0,n.useState)([]),be=m()($,2),Ze=be[0],pe=be[1],Ee=(0,n.useState)(0),ze=m()(Ee,2),ke=ze[0],Ie=ze[1],rr=(0,n.useState)(""),re=m()(rr,2),B=re[0],T=re[1],xe=(0,n.useRef)(null),Pe=(0,n.useRef)(null);(0,n.useEffect)(function(){xe.current.isLoad&&R(B),xe.current.isLoad=!0},[B]),(0,n.useImperativeHandle)(l,function(){return{show:N,hide:ne}});var N=function(){xe.current.style.right="660px"},ne=function(ie,D){xe.current.style.right="0px",S()};(0,n.useEffect)(function(){xe.current.dataMap={},z()},[]);var z=function(){var G=p()(o()().mark(function ie(){var D,Fr,Ae,d,y,U,O=arguments;return o()().wrap(function(nr){for(;;)switch(nr.prev=nr.next){case 0:if(D=O.length>0&&O[0]!==void 0?O[0]:"",Fr=O.length>1&&O[1]!==void 0?O[1]:"",Ae=O.length>2?O[2]:void 0,nr.prev=3,d={name:Fr,type:D,size:100,page_num:1},y=xe.current.dataMap[D],!(y===void 0||Ae==="update")){nr.next=12;break}return nr.next=9,$e(d);case 9:U=nr.sent,y=U.data,xe.current.dataMap[D]=y;case 12:me(x()({},y)),pe(y.atom_type),nr.next=18;break;case 16:nr.prev=16,nr.t0=nr.catch(3);case 18:return nr.prev=18,nr.finish(18);case 20:case"end":return nr.stop()}},ie,null,[[3,16,18,20]])}));return function(){return G.apply(this,arguments)}}(),R=(0,L.Nr)(function(){var G=p()(o()().mark(function ie(D){return o()().wrap(function(Ae){for(;;)switch(Ae.prev=Ae.next){case 0:try{z("all",D,"update")}catch(d){}case 1:case"end":return Ae.stop()}},ie)}));return function(ie){return G.apply(this,arguments)}}(),100),M=function(ie){var D=ie.keyCode,Fr=ie.target;D===13&&(Ie(0),z("all",Fr.value,"update"))},v=function(ie,D){Ie(ie),z(D)},g=function(){Pe.current.style.transform="rotate(360deg)",Pe.current.style.transition="all 0.6s",z(Ze[ke].type,"","update"),setTimeout(function(){Pe.current.style.transition="none",Pe.current.style.transform="rotate(0deg)"},300)},f=function(){return(0,e.jsxs)("div",{className:"plugins-header flex-space-between",children:[(0,e.jsxs)("div",{className:"flex-start",children:["\u8BF7\u9009\u62E9\u4E00\u4E2A\u63D2\u4EF6\xA0\xA0",(0,e.jsx)("div",{onClick:function(){return g()},className:"plugins-header-refresh",ref:Pe,children:(0,e.jsx)(X.Z,{style:{color:"#3c96ff",cursor:"pointer"}})})]}),(0,e.jsx)(Qe.Z,{style:{width:"220px"},placeholder:"\u8F93\u5165\u540E\u56DE\u8F66\u641C\u7D22",suffix:(0,e.jsx)(ce.Z,{style:{color:"rgba(0,0,0,.45)"}}),onKeyDown:M,value:B,onChange:function(D){return T(D.target.value)}})]})},w=function(){return(0,e.jsxs)("div",{className:"plugins-content",children:[B?(0,e.jsx)(e.Fragment,{}):(0,e.jsx)("nav",{className:"plugins-content-nav flex-start",children:Ze.map(function(ie,D){return(0,e.jsxs)("div",{className:"nav-item flex-center ".concat(D===ke&&"nav-item-action"),onClick:function(){return v(D,ie.type)},children:[ie.name,(0,e.jsx)("div",{className:"nav-item-line",style:{opacity:D===ke?1:0}})]})})}),(0,e.jsx)(Gr,{list:ye.atom_info||[],config:a,hide:ne,modifyField:h,setConfig:E})]})};return(0,e.jsxs)("div",{className:"flow-plugins-container common-reset-style",ref:xe,onClick:function(ie){return ie.stopPropagation()},children:[f(),w(),(0,e.jsx)("div",{className:"flow-plugins-arrow"}),(0,e.jsx)("div",{className:"plugins-close flex-center",onClick:function(){return ne()},children:(0,e.jsx)(Pn.Z,{})})]})}var Hn=(0,n.forwardRef)(rn),Tn=r(57132),Xn=r(47731);function pn(s){var l=s.modal,a=s.config,S=s.data,h=s.getEnvForm,E=s.tableData,ee=E===void 0?{data:[]}:E,Z=s.from,ye=(0,n.useState)({}),me=m()(ye,2),$=me[0],be=me[1],Ze=(0,n.useRef)(null),pe={pipeline:"\u5168\u5C40",job:"Job"};(0,n.useEffect)(function(){Ee()},[l]);var Ee=function(){var re=p()(o()().mark(function B(){var T,xe;return o()().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:if(!l){N.next=10;break}if(T={data:[]},Z!==1){N.next=7;break}return N.next=5,h();case 5:xe=N.sent,xe.length>0&&(T.data=[].concat(Pr()(T.data),Pr()(xe)));case 7:ee.data&&(T.data=[].concat(Pr()(T.data),Pr()(ee.data))),T.length=T.data.length,be(T);case 10:case"end":return N.stop()}},B)}));return function(){return re.apply(this,arguments)}}(),ze=function(){var re=p()(o()().mark(function B(T){return o()().wrap(function(Pe){for(;;)switch(Pe.prev=Pe.next){case 0:case"end":return Pe.stop()}},B)}));return function(T){return re.apply(this,arguments)}}(),ke=function(){var B=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";B=B+"";var T=30;return(0,e.jsx)("div",{children:B.length>T?(0,e.jsx)(tn.Z,{title:(0,e.jsx)("div",{style:{whiteSpace:"pre-wrap"},children:B}),children:(0,e.jsx)("div",{style:{cursor:"pointer"},children:B.slice(0,T)+"..."})}):B})},Ie=function(B){return(0,e.jsxs)("div",{style:{position:"relative",padding:"0 20px"},children:[ke(B),(0,e.jsx)(Tn.Z,{className:"copy",onClick:function(){return(0,L.zp)(B)}})]})},rr=[{title:"\u53D8\u91CF\u6765\u6E90",dataIndex:"name",key:"name",align:"center",render:function(B,T){return ke(B||pe[T.scope]||"")}},{title:"Key",dataIndex:"key",key:"key",align:"center",render:function(B){return Ie(B)}},{title:"\u63CF\u8FF0",dataIndex:"description",key:"description",align:"center",render:function(B){var T=B||"-";return(0,e.jsx)(tn.Z,{title:(0,e.jsx)("div",{style:{whiteSpace:"pre-wrap"},dangerouslySetInnerHTML:{__html:T}}),children:(0,e.jsx)("div",{style:{cursor:"pointer"},dangerouslySetInnerHTML:{__html:T}})})}},{title:"Value",dataIndex:"value",key:"value",align:"center",render:function(B){return Ie(B)}}];return(0,e.jsx)("div",{className:"flex-configModal-lookEnv-container",children:$.data&&$.data.length>0&&(0,e.jsx)(Xn.Z,{getData:ze,data:$.data,total:$.total,ref:Ze,showTableFilter:!1,hasNavigation:!1,showIndex:!1,pageSize:50,columns:rr})})}var sa=pn;function Zn(s,l){var a=s.type,S=(0,n.useState)(!1),h=m()(S,2),E=h[0],ee=h[1],Z=(0,n.useState)({}),ye=m()(Z,2),me=ye[0],$=ye[1],be=(0,n.useState)({}),Ze=m()(be,2),pe=Ze[0],Ee=Ze[1],ze=(0,n.useRef)({}),ke=(0,n.useState)({data:[]}),Ie=m()(ke,2),rr=Ie[0],re=Ie[1],B=(0,n.useRef)(null),T=(0,n.useRef)(null),xe=(0,n.useRef)(null),Pe=(0,n.useRef)(null),N=(0,n.useRef)(null);(0,n.useImperativeHandle)(l,function(){return{open:ne}});var ne=function(y,U){ee(!0),Ee(y),z(y),$(U),setTimeout(function(){ze.current.style.opacity=1;try{}catch(O){}},0)};(0,n.useEffect)(function(){me.template&&z(pe)},[me,pe]);var z=function(){var d=p()(o()().mark(function y(U){var O,Y,nr,Se,H,P,ve,oe,C,Ue,ar,wr,bn,fr,hn,Ln;return o()().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:if(U.type===3){F.next=2;break}return F.abrupt("return");case 2:if(O=U.stageIndex,Y=U.jobIndex,nr=U.stepIndex,Se=s.data.stages[O].jobs[Y],H=Se.tasks.slice(0,nr),P={data:[]},ve=!1,!me.template){F.next=37;break}oe=0;case 9:if(!(oe<me.template.length)){F.next=37;break}C=me.template[oe],Ue=oe,ar=0;case 13:if(!(ar<C.jobs.length)){F.next=32;break}wr=C.jobs[ar],bn=ar,fr=0;case 17:if(!(fr<wr.tasks.length)){F.next=27;break}if(hn=wr.tasks[fr],Ln=fr,O!==Ue){F.next=23;break}return ve=!0,F.abrupt("break",27);case 23:hn.out_variables&&hn.out_variables.forEach(function(J){J.scope==="pipeline"&&P.data.push(J)});case 24:fr++,F.next=17;break;case 27:if(!ve){F.next=29;break}return F.abrupt("break",32);case 29:ar++,F.next=13;break;case 32:if(!ve){F.next=34;break}return F.abrupt("break",37);case 34:oe++,F.next=9;break;case 37:H.forEach(function(J){if(J.out_variables){var we;(we=P.data).push.apply(we,Pr()(J.out_variables))}}),re(P);case 39:case"end":return F.stop()}},y)}));return function(U){return d.apply(this,arguments)}}(),R=function(){ee(!1)},M=function(){},v=function(y){var U;(U=xe.current)===null||U===void 0||U.handleDisplay(y)},g=function(){var y=pe.type;switch(y){case 1:return B.current;case 2:return T.current;case 3:return Pe.current}},f=function(){var d=p()(o()().mark(function y(){return o()().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:return O.next=2,g().validateFields();case 2:s.update(),R();case 4:case"end":return O.stop()}},y)}));return function(){return d.apply(this,arguments)}}(),w=function(y,U){Pe.current.modifyField(y,U)},G=function(y,U){N.current[y](U)};if(!E)return(0,e.jsx)(e.Fragment,{});var ie=function(){var y=pe.type;switch(y){case 1:return"Stage";case 2:return"Job";case 3:return"Task"}},D=function(){var y=pe.type,U=pe.stepIndex;return(0,e.jsxs)("header",{className:"content-header flex-start",children:[(0,e.jsx)("div",{className:"content-header-left flex-center",onClick:f,children:(0,e.jsx)(un.Z,{})}),(0,e.jsxs)("div",{className:"content-header-right",children:[ie()," \u914D\u7F6E"]}),y===3&&(0,e.jsx)("div",{className:"content-header-env flex-center",children:(0,e.jsx)(Hr.Z,{placement:"topRight",content:(0,e.jsx)(sa,x()(x()({modal:E,config:pe},s),{},{from:1,tableData:rr})),title:"",children:(0,e.jsx)("div",{style:{whiteSpace:"nowrap"},children:"\u53EF\u7528\u73AF\u5883\u53D8\u91CF"})})})]})},Fr=function(){switch(pe.type){case 1:return(0,e.jsx)(qe,{config:pe,type:a,ref:B});case 2:return(0,e.jsx)(_,x()({config:pe,type:a,ref:T},s));case 3:return(0,e.jsx)(A.Z,x()(x()({config:pe,type:a,ref:Pe,handlePluginsModal:G},s),{},{close:R,handleLoading:v,data:me}))}},Ae=function(){return(0,e.jsx)("div",{className:"content-box common-scroll-bar",children:(0,e.jsx)("div",{className:"form common-content-container",children:Fr()})})};return(0,yn.createPortal)((0,e.jsxs)("div",{className:"config-detail-container",onClick:f,ref:ze,children:[(0,e.jsxs)("div",{className:"content",onClick:function(y){var U;y.stopPropagation(),(U=N.current)===null||U===void 0||U.hide()},children:[D(),Ae(),(0,e.jsx)(le.gb,{ref:xe})]}),pe.type===3&&(0,e.jsx)(Hn,{ref:N,config:pe,update:s.update,modifyField:w})]}),document.body)}var Qn=(0,n.forwardRef)(Zn),Kn=r(30159),Gn=r(26911);function aa(s){var l=(0,n.useState)(window.innerHeight*s),a=m()(l,2),S=a[0],h=a[1];(0,n.useEffect)(function(){return window.addEventListener("resize",E),function(){window.removeEventListener("resize",E)}},[]);var E=function(){h(window.innerHeight*s)};return S}var br=r(1458),u=r.n(br),te=function(l){for(var a=`\x1B[0KRunning with gitlab-runner development version (HEAD)\x1B[0;m
\x1B[0K  on TRISTAN-NIU-L HXKU6seU, system ID: s_498b7a440a31\x1B[0;m
section_start:1682581592:prepare_executor\r\x1B[0K\x1B[0K\x1B[36;1mPreparing the "docker" executor\x1B[0;m\x1B[0;m
\x1B[0KUsing Docker executor with image ubuntu:latest ...\x1B[0;m
\x1B[0KPulling docker image ubuntu:latest ...\x1B[0;m
\x1B[0KUsing docker image sha256:08d22c0ceb150ddeb2237c5fa3129c0183f3cc6f5eeb2e7aa4016da3ad02140a for ubuntu:latest with digest ubuntu@sha256:67211c14fa74f070d27cc59d69a7fa9aeff8e28ea118ef3babc295a0428a6d21 ...\x1B[0;m
section_end:1682581609:prepare_executor\r\x1B[0Ksection_start:1682581609:prepare_script\r\x1B[0K\x1B[0K\x1B[36;1mPreparing environment\x1B[0;m\x1B[0;m
Running on runner-hxku6seu-project-3-concurrent-0 via LG-A01-SD-112-14...
section_end:1682581610:prepare_script\r\x1B[0Ksection_start:1682581610:get_sources\r\x1B[0K\x1B[0K\x1B[36;1mGetting source from Git repository\x1B[0;m\x1B[0;m
\x1B[32;1mSkipping Git repository setup\x1B[0;m
\x1B[32;1mSkipping Git checkout\x1B[0;m
\x1B[32;1mSkipping Git submodules setup\x1B[0;m
section_end:1682581611:get_sources\r\x1B[0Ksection_start:1682581611:step_script\r\x1B[0K\x1B[0K\x1B[36;1mExecuting "step_script" stage of the job script\x1B[0;m\x1B[0;m
\x1B[0KUsing docker image sha256:08d22c0ceb150ddeb2237c5fa3129c0183f3cc6f5eeb2e7aa4016da3ad02140a for ubuntu:latest with digest ubuntu@sha256:67211c14fa74f070d27cc59d69a7fa9aeff8e28ea118ef3babc295a0428a6d21 ...\x1B[0;m
\x1B[32;1m$ echo "Compiling the code..."\x1B[0;m
Compiling the code...
`,S=anser.ansiToJson(a),h=S.filter(function(ye){var me=ye.content.replace(/\n/g,"").replace(/\r/g,"");if(me)return!0}),E=[],ee=0;ee<l;ee++){var Z=Math.floor(Math.random()*h.length);E.push(_objectSpread(_objectSpread({},h[Z]),{},{name:h[Z].content.replace(/\n/g,"").replace(/\r/g,""),line_num:ee+1,timestamp:"2024-04-22 04:11:40"}))}return E},_e=function(l){var a=u().ansiToJson(l),S=a.filter(function(E){var ee=E.content.replace(/\n/g,"").replace(/\r/g,"");if(ee)return!0}),h="";return S.forEach(function(E,ee){ee>0&&(h+=" ");var Z=E.content.replace(/\n/g,"").replace(/\r/g,"").trim();h+=Z}),h},fe=function(l){var a=l.fg;a==="187, 0, 0"&&(l.fg="255, 86, 86")},Ve=function(l,a){l=l.replace(/\r/g,"");var S=[],h=anser.ansiToJson(l),E=a||0;h.forEach(function(Z){fe(Z);var ye=Z.content.split(`
`);ye.forEach(function(me){var $=me,be=document.querySelector(".log-detail-list-scroll").offsetWidth,Ze=be-130-240;if(me){var pe=$.split("\\n");pe.forEach(function(Ee){Z.index=++E;var ze=Z.index,ke=computeCodeElementWidth(Ee);if(ke>Ze){for(var Ie="",rr=0,re=0;re<Ee.length;re++){rr>=Ze&&(S.push(_objectSpread(_objectSpread({},Z),{},{name:Ie,content:Ie,index:ze})),Ie="",rr=0,ze="");var B=Ee[re];Ie+=B,B&&(rr+=codeElementWidth[B]||2)}S.push(_objectSpread(_objectSpread({},Z),{},{name:Ie,content:Ie,index:ze}))}else S.push(_objectSpread(_objectSpread({},Z),{},{name:Ee,content:Ee}))})}})});var ee=S.filter(function(Z){return Z.name&&Z.name!==`
`});return ee},gr="\u8428\u514B\u90FD\u8BF7\u95EE\u53BB\u554A\u901F\u5EA6\u52A0\u554A\u56DB\u54E6\u90FD\u56DE\u590D\u5982\u679C\u5927\u5BB6\u8BF4\u7684\u4E09\u91D1\u5361\u6587\u7269\u6839\u636E\u54E6\u5206\u72C4\u5361\u65AFasdalksnewqriejgoidvnjsd\u963F\u8428\u5927\u56DB\u591A\u4E45\u54E6\u57C3\u53CA\u7B2C\u4E94\u90E8\u5206\u5916\u8868",Wr=function(){for(var l=[],a=0;a<334;a++){for(var S="",h=Math.floor(Math.random()*1e3),E=0;E<h;E++){var ee=Math.floor(Math.random()*gr.length);S+=gr[ee]}l.push({logIndex:a+1,date:"2024-04-12 10:58:00",logContent:S,color:nn()})}return l};function nn(){for(var s="0123456789ABCDEF",l="#",a=0;a<6;a++)l+=s[Math.floor(Math.random()*16)];return l}var cn=`\x1B[0KRunning with gitlab-runner 15.4.0 (43b2dc3d)\x1B[0;m
  \x1B[0K  on ciservice hSRgxtBR\x1B[0;m
  section_start:1711161189:resolve_secrets
  \x1B[0K\x1B[0K\x1B[36;1mResolving secrets\x1B[0;m\x1B[0;m
  section_end:1711161189:resolve_secrets
  \x1B[0Ksection_start:1711161189:prepare_executor
  \x1B[0K\x1B[0K\x1B[36;1mPreparing the "docker" executor\x1B[0;m\x1B[0;m
  \x1B[0KUsing Docker executor with image artifact.enflame.cn/enflame_docker_images/ci/docker:sshpass ...\x1B[0;m
  \x1B[0KPulling docker image artifact.enflame.cn/enflame_docker_images/ci/docker:sshpass ...\x1B[0;m
  \x1B[0KUsing docker image sha256:7c49cb51239a6c151c2f28bf03bd9d884ba831b840b3ade8184e51b2d4f81ed1 for artifact.enflame.cn/enflame_docker_images/ci/docker:sshpass with digest artifact.enflame.cn/enflame_docker_images/ci/docker@sha256:f0f61805b53059710c1f39314e6164a0e307db6420e0e88e88c1e55e03e2526c ...\x1B[0;m
  section_end:1711161191:prepare_executor
  \x1B[0Ksection_start:1711161191:prepare_script
  \x1B[0K\x1B[0K\x1B[36;1mPreparing environment\x1B[0;m\x1B[0;m
  Running on runner-hsrgxtbr-project-8119-concurrent-0 via b06c01bae4c3...
  section_end:1711161191:prepare_script
  \x1B[0Ksection_start:1711161191:get_sources
  \x1B[0K\x1B[0K\x1B[36;1mGetting source from Git repository\x1B[0;m\x1B[0;m
  \x1B[32;1mFetching changes with git depth set to 20...\x1B[0;m
  Reinitialized existing Git repository in /builds/sseci/dolphin-gateway/.git/
  \x1B[32;1mChecking out 035ff57a as main...\x1B[0;m

  \x1B[32;1mSkipping Git submodules setup\x1B[0;m
  section_end:1711161193:get_sources
  \x1B[0Ksection_start:1711161193:step_script
  \x1B[0K\x1B[0K\x1B[36;1mExecuting "step_script" stage of the job script\x1B[0;m\x1B[0;m
  \x1B[0KUsing docker image sha256:7c49cb51239a6c151c2f28bf03bd9d884ba831b840b3ade8184e51b2d4f81ed1 for artifact.enflame.cn/enflame_docker_images/ci/docker:sshpass with digest artifact.enflame.cn/enflame_docker_images/ci/docker@sha256:f0f61805b53059710c1f39314e6164a0e307db6420e0e88e88c1e55e03e2526c ...\x1B[0;m
  \x1B[32;1m$ echo "{ }"  set_env.sh\x1B[0;m
  \x1B[32;1m$ docker save artifact.enflame.cn/enflame_docker_images/ci/dolphin-gateway:"ta" | sshpass -p "assword}" ssh -C -o StrictHostKeyChecking=no "sername@"$st_ip"docker load"\x1B[0;m
  usage: ssh [-46AaCfGgKkMNnqsTtVvXxYy] [-B bind_interface]
  [-b bind_address] [-c cipher_spec] [-D [bind_address:]port]
  [-E log_file] [-e escape_char] [-F configfile] [-I pkcs11]
  [-i identity_file] [-J [user@]host[:port]] [-L address]
  [-l login_name] [-m mac_spec] [-O ctl_cmd] [-o option] [-p port]
  [-Q query_option] [-R address] [-S ctl_path] [-W host:port]
  [-w local_tun[:remote_tun]] destination [command [argument ...]]
  section_end:1711161200:step_script
  \x1B[0Ksection_start:1711161200:cleanup_file_variables
  \x1B[0K\x1B[0K\x1B[36;1mCleaning up project directory and file based variables\x1B[0;m\x1B[0;m
  section_end:1711161201:cleanup_file_variables
  \x1B[0K\x1B[31;1mERROR: Job failed: exit code 255
  \x1B[0;m`,Er=function(l,a){var S=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{line:1e3};return(0,ge.ZP)("/api/pipeline/job_run_info/".concat(a,"/v1/latest_log"),{method:"get",params:S})},Yr=function(l,a){var S=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{line:1e3};return(0,ge.ZP)("/api/pipeline/task_run_info/".concat(a,"/v1/latest_log"),{method:"get",params:S})},Bn=r(15360);function ta(s){var l=s.url,a=s.from;if(!l)return(0,e.jsx)(e.Fragment,{});var S=function(){return(0,e.jsx)(vr.ZP,{className:"logDetail-link-job-button flex-center",size:"small",onClick:function(){return window.open(l)},children:"\u67E5\u770B\u539F\u59CB\u65E5\u5FD7"})},h=function(){return(0,e.jsx)(vr.ZP,{className:"logDetail-link-task-button ",size:"small",onClick:function(){return window.open(l)},children:"\u67E5\u770B\u539F\u59CB\u65E5\u5FD7"})};return(0,e.jsxs)(e.Fragment,{children:[a==="job"&&S(),a==="task"&&h()]})}var la=(0,n.memo)(ta),ua=r(89435),Aa=r.n(ua),va=!0,ha=null;function wa(s,l){var a=s.task,S=s.from,h=s.globalData,E=(0,n.useState)(null),ee=m()(E,2),Z=ee[0],ye=ee[1],me=(0,n.useState)(null),$=m()(me,2),be=$[0],Ze=$[1],pe=(0,n.useState)(""),Ee=m()(pe,2),ze=Ee[0],ke=Ee[1],Ie=aa(.69),rr=(0,n.useState)(0),re=m()(rr,2),B=re[0],T=re[1],xe=20,Pe=Math.ceil(B/xe)+4,N=5,ne=(0,L.DP)(),z=ne.triggerId,R=(0,n.useRef)(null),M=(0,n.useRef)(null),v=(0,n.useRef)(null),g=(0,n.useRef)(null),f=(0,n.useRef)({}),w=(0,n.useRef)(null),G=(0,n.useRef)({}),ie=(0,n.useRef)(0),D=18.8,Fr=120,Ae=(0,n.useRef)([]);(0,n.useEffect)(function(){Y()},[a]),(0,n.useEffect)(function(){var j=Ie;S==="task"&&(j=document.querySelector(".flow-log-container").offsetHeight-10-20),T(j)},[Ie]),(0,n.useEffect)(function(){f.current.logScrollHeight=B,f.current.initCount=Math.ceil(B/xe)+4},[B]),(0,n.useEffect)(function(){return R.current.addEventListener("scroll",ve),document.body.addEventListener("wheel",d),function(){var j;(j=R.current)===null||j===void 0||j.removeEventListener("scroll",ve),document.body.removeEventListener("wheel",d)}},[]),(0,n.useEffect)(function(){return window.addEventListener("mousemove",fr),window.addEventListener("mouseup",we),window.addEventListener("resize",C),function(){window.removeEventListener("mousemove",fr),window.removeEventListener("mouseup",we),window.removeEventListener("resize",C)}},[]),(0,n.useEffect)(function(){if(Z){var j=R.current.scrollTop;if(va){var b=R.current.scrollHeight;R.current.scrollTop=b,j=b}ve({target:{scrollTop:j-5}})}},[Z]);var d=function(){va=!1,clearTimeout(ha),ha=setTimeout(function(){va=!0},1e4)},y=function(b){if(S==="job"){var K=500;b.length*xe<K&&(K=b.length*xe),b.length||(K=60),f.current.style.height=K+"px"}},U=function(){var j=p()(o()().mark(function b(){var K,Oe,q,Zr,Sr,wn,$n,Fn,Jn,zn,ea,oa;return o()().wrap(function(Wn){for(;;)switch(Wn.prev=Wn.next){case 0:if(Wn.prev=0,K=a.type,Oe=a.logId,q=a.setup_status,Zr=a.logContent,Sr=a.web_path,wn=a.jobRunId,$n=Zr,Fn=Sr,!($n&&q!=="pending")){Wn.next=8;break}return ke(Fn),O($n,Fn),Wn.abrupt("return");case 8:return Jn={line:1e3,job_runinfo_id:wn},zn=K===2?Er:Yr,Wn.next=12,zn(z,Oe,Jn);case 12:ea=Wn.sent,oa=ea.data,y(oa),ke(ea.web_path),O(oa,ea.web_path),Wn.next=22;break;case 19:Wn.prev=19,Wn.t0=Wn.catch(0),console.log(Wn.t0);case 22:case"end":return Wn.stop()}},b,null,[[0,19]])}));return function(){return j.apply(this,arguments)}}(),O=function(b,K){var Oe=a.logId;setTimeout(function(){ye(b),a.logContent=b;var q=b;Ze(q),Ae.current=q,a.web_path=K,wr(),P()},1e3)},Y=function(){var b=a.setup_status;switch(b){case"pending":break;case"running":nr();break;case"failed":case"canceled":case"skipped":case"timeout":case"success":H(),f.current.isLoadData||U(),f.current.isLoadData=!0;break}},nr=function(){var j=p()(o()().mark(function b(){var K,Oe,q,Zr,Sr,wn;return o()().wrap(function(Fn){for(;;)switch(Fn.prev=Fn.next){case 0:if(!f.current){Fn.next=16;break}return clearTimeout(f.current.timer),K=a.type,Oe=a.logId,q=K===2?Er:Yr,Fn.next=6,q(z,Oe);case 6:Zr=Fn.sent,Sr=Zr.data,ke(Zr.web_path),y(Sr),ye(Sr),wn=Sr,Ze(wn),Ae.current=wn,Se(),f.current.timer=setTimeout(p()(o()().mark(function Jn(){return o()().wrap(function(ea){for(;;)switch(ea.prev=ea.next){case 0:Y();case 1:case"end":return ea.stop()}},Jn)})),5e3);case 16:case"end":return Fn.stop()}},b)}));return function(){return j.apply(this,arguments)}}(),Se=function(){wr(),ar(),oe(R.current.scrollTop),Ue()},H=function(){f.current&&clearTimeout(f.current.timer)},P=function(){f.current&&(ar(),wr(),Ue())},ve=function(b){var K=b.target.scrollTop;Ue(),oe(b.target.scrollTop)},oe=function(b){var K=R.current.offsetHeight,Oe=v.current.offsetHeight,q=w.current.offsetHeight,Zr=g.current.offsetHeight,Sr=M.current.offsetHeight,wn=Oe*b/Sr;Oe>=K&&(wn=(q-Zr)*b/(Sr-q));var $n=wn*(N*ie.current+N-q)/(q-Zr);g.current.style.top=wn+"px",v.current.style.transform="translateY(".concat(-$n,"px)")},C=function(){P()},Ue=function(){},ar=function(){setTimeout(function(){var b=R.current.offsetHeight,K=M.current.offsetHeight,Oe=w.current.offsetHeight,q=b*Oe/K,Zr=g.current.offsetTop;Oe>=b&&(q=b*(N*ie.current)/K),g.current.style.top=(Zr||0)+"px",g.current.style.height=q+"px"},0)},wr=function(){var b=f.current.offsetHeight,K=v.current;K.width=Fr;var Oe=0;(0,L.p$)(Ae.current).forEach(function(Zr){Zr.content=Zr.timestamp+"  "+Zr.content;var Sr=J(Zr.content);Sr.forEach(function(wn){Oe++})});var q=N*Oe;K.style.height=q+"px",K.height=q,w.current.style.height=q+"px",q>=b&&(w.current.style.height=b+"px"),F()},bn=function(b){var K=b.clientY,Oe=g.current.offsetTop,q=f.current.offsetTop,Zr=w.current.offsetHeight;d(),f.current.isMove=!0,f.current.clickClientY=K-(q+19-Zr)-Oe},fr=function(b){var K;if((K=f.current)!==null&&K!==void 0&&K.isMove){d();var Oe=b.clientY,q=g.current.offsetHeight,Zr=f.current,Sr=Zr.offsetTop,wn=Zr.clickClientY,$n=w.current,Fn=$n.offsetHeight,Jn=$n.offsetHeight,zn=Oe-(Sr+19-Fn)-wn;zn<0?zn=0:zn+q>Jn&&(zn=Jn-q),g.current.style.top=zn+"px",hn(zn),tr(zn)}},hn=function(b){var K=R.current,Oe=Ln(b);K.scrollTop=Oe},Ln=function(b){var K=w.current.offsetHeight,Oe=R.current.offsetHeight,q=g.current.offsetHeight,Zr=M.current.offsetHeight,Sr=Zr*b/K;return K>=Oe&&(Sr=(Zr-Oe)*b/(K-q)),Sr},tr=function(b){var K=M.current.offsetHeight,Oe=w.current.offsetHeight,q=R.current.offsetHeight,Zr=g.current.offsetHeight,Sr=b*K/Oe;Oe>=q&&(Sr=b*(N*ie.current+N-Oe)/(Oe-Zr),v.current.style.transform="translateY(".concat(-Sr,"px)"))},F=function(){var b=v.current,K=b.getContext("2d");K.fillStyle="#1e1e1e",K.fillRect(0,0,b.width,b.height),K.save(),K.font="normal bold 2px SimSun, Songti SC";var Oe=0;(0,L.p$)(Ae.current).forEach(function(q){K.fillStyle=q.color?q.color:"#fff",q.content=q.timestamp+"  "+q.content;var Zr=J(q.content);Zr.forEach(function(Sr){K.fillText(Sr,0,(Oe+1)*N),Oe++})}),ie.current=Oe,K.restore()};function J(j){var b=_e(j),K=[],Oe=0,q="",Zr=G.current.getBoundingClientRect().width,Sr=Zr,wn=document.createElement("canvas"),$n=wn.getContext("2d");$n.font="normal 14px SimSun, Songti SC";for(var Fn=0;Fn<b.length;Fn++){var Jn=b[Fn],zn=$n.measureText(Jn);Oe+=zn.width,q+=Jn,Oe>Sr&&(K.push(q),Oe=0,q="")}return q&&K.push(q),K}var we=function(){f.current.isMove=!1},Rr=function(){return Z?(0,e.jsx)(e.Fragment,{}):(0,e.jsx)("div",{className:"flex-center flow-log-detail-loading",children:a.setup_status==="pending"?a.type===2?"\u51C6\u5907\u73AF\u5883\u4E2D...":a.active?"\u7B49\u5F85\u8FD0\u884C\u4E2D...":"\u6682\u672A\u672A\u542F\u7528":(0,e.jsx)(Xr.Z,{style:{fontSize:"20px"}})})},sn=function(){return(0,e.jsx)("div",{className:"flex-center log-empty",children:(0,e.jsxs)("div",{className:"empty",children:[(0,e.jsx)(Gn.Z,{}),(0,e.jsx)("p",{children:"The log is empty"})]})})},ir=(0,n.useMemo)(function(){if(be)return(0,e.jsx)(e.Fragment,{children:be==null?void 0:be.map(function(j,b){return(0,e.jsx)(n.Fragment,{children:(0,e.jsxs)("li",{className:"flex-start log-detail-list-item",children:[(0,e.jsx)("div",{className:"item-num",children:j.line_num<0?"":j.line_num}),(0,e.jsx)("div",{className:"item-name",style:{color:j.color},ref:G,children:(0,e.jsxs)("pre",{style:{wordWrap:"break-word",whiteSpace:"pre-wrap",display:"inline"},children:[(0,e.jsx)("span",{className:"item-date",children:j.timestamp}),(0,e.jsx)(Aa(),{useClasses:!0,children:j.content})]})})]},j.line_num)},j.line_num)})})},[be]),an=function(){return(0,e.jsx)("div",{className:"log-detail-list-scroll",ref:R,children:(0,e.jsx)("ul",{className:"log-detail-list",ref:M,children:ir})})},Rn=function(){return(0,e.jsx)(la,{url:ze,from:S})},ra=function(){return(0,e.jsxs)("div",{className:"log-detail-mini-nav",ref:w,children:[(0,e.jsx)("canvas",{ref:v,style:{width:Fr+"px"}}),(0,e.jsx)("div",{className:"mini-nav-layer",ref:g,onMouseDown:bn})]})},sr=function(){var b=a.type,K=a.setup_status;if(b===2){if(K!=="running"||!Z)return(0,e.jsx)(e.Fragment,{})}else if(a.status!=="running"&&a.status!=="manual_confirm"||!Z)return(0,e.jsx)(e.Fragment,{});return(0,e.jsxs)("div",{className:"log-loading-container",children:[(0,e.jsx)("div",{className:"dot"}),(0,e.jsx)("div",{className:"dot"}),(0,e.jsx)("div",{className:"dot"})]})};return(0,e.jsxs)("div",{className:"flow-log-detail-container",ref:f,children:[Rn(),Rr(),Z&&Z.length<=0&&sn(),an(),ra(),sr()]})}var ga=(0,n.forwardRef)(wa);function Ia(s){var l=s.config,a=s.renderState,S=(0,n.useState)((0,L.p$)(l)),h=m()(S,2),E=h[0],ee=h[1];(0,n.useEffect)(function(){var $=x()({},(0,L.p$)(l));$.type===2&&($.name="\u73AF\u5883\u51C6\u5907",$.tasks.unshift($)),ee($)},[]);var Z=function(be){E.tasks[be].open=!E.tasks[be].open,ee(x()({},E))},ye=function(){var be=l.tasks;return(0,e.jsx)("ul",{className:"flow-log-job common-scroll-bar",children:[l].concat(Pr()(be)).map(function(Ze,pe){var Ee,ze,ke;return(0,e.jsxs)("li",{className:"flew-log-job-item",children:[(0,e.jsxs)("div",{className:"item-nav flex-start ".concat(((Ee=E.tasks[pe])===null||Ee===void 0?void 0:Ee.open)&&"action-log"),onClick:function(){return Z(pe)},children:[(0,e.jsx)(un.Z,{className:"item-arrow"}),(0,e.jsx)("div",{className:"item-status",children:a(Ze.setup_status)}),(0,e.jsx)("span",{className:"item-name",children:(ze=E.tasks[pe])===null||ze===void 0?void 0:ze.name})]}),((ke=E.tasks[pe])===null||ke===void 0?void 0:ke.open)&&(0,e.jsx)(ga,{config:l,task:Ze,from:"job"})]},pe)})})},me=function(){return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("br",{}),(0,e.jsx)(ga,{config:l,task:l,from:"task"})]})};return(0,e.jsxs)("div",{className:"flow-log-container ",children:[l.type===2&&ye(),l.type===3&&me()]})}var ka=Ia,Ba=function(l,a){return(0,ge.ZP)("/api/pipeline/task_run_info/".concat(l,"/env_variables"),{method:"get",params:a})},Ra=function(l,a){return(0,ge.ZP)("/api/pipeline/task_run_info/".concat(l,"/variables"),{method:"get",params:a})};function Ta(s){var l=s.tabIndex,a=s.config,S=(0,n.useState)({}),h=m()(S,2),E=h[0],ee=h[1],Z=(0,n.useState)({}),ye=m()(Z,2),me=ye[0],$=ye[1],be=(0,L.DP)(),Ze=(0,n.useRef)(null),pe=(0,n.useRef)(null),Ee=function(){var B=p()(o()().mark(function T(xe){var Pe,N;return o()().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return xe.size=1e3,z.next=3,Ba(a.logId,xe);case 3:Pe=z.sent,N=Pe.data,ee({data:N,total:N.length});case 6:case"end":return z.stop()}},T)}));return function(xe){return B.apply(this,arguments)}}(),ze=function(){var B=p()(o()().mark(function T(xe){var Pe,N;return o()().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return xe.size=1e3,z.next=3,Ra(a.logId,xe);case 3:Pe=z.sent,N=Pe.data,$({data:N,total:N.length});case 6:case"end":return z.stop()}},T)}));return function(xe){return B.apply(this,arguments)}}(),ke=function(T){return(0,e.jsxs)("div",{style:{position:"relative",padding:"0 20px"},children:[Ie(T),(0,e.jsx)(Tn.Z,{className:"copy",onClick:function(){return(0,L.zp)(T)}})]})},Ie=function(){var T=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";T=T+"";var xe=30;return(0,e.jsx)("div",{children:T.length>xe?(0,e.jsx)(tn.Z,{title:(0,e.jsx)("div",{style:{whiteSpace:"pre-wrap"},children:T}),children:(0,e.jsx)("div",{style:{cursor:"pointer"},children:T.slice(0,xe)+"..."})}):T})},rr=[{title:"\u53D8\u91CF\u6765\u6E90",dataIndex:"name",key:"name",align:"center",render:function(T,xe){return(0,e.jsx)("div",{children:xe.scope==="pipeline"?"\u5168\u5C40":xe.scope})}},{title:"Key",dataIndex:"key",key:"key",align:"center",render:function(T){return ke(T)}},{title:"Value",dataIndex:"value",key:"value",align:"center",render:function(T){return ke(T)}}],re=[{title:"Key",dataIndex:"key",key:"key",align:"center",render:function(T){return ke(T)}},{title:"Value",dataIndex:"value",key:"value",align:"center",render:function(T){return ke(T)}}];return(0,e.jsxs)("div",{className:"execModal-env-run-container",children:[(0,e.jsx)("br",{}),(0,e.jsx)("div",{className:"title",children:"\u73AF\u5883\u53D8\u91CF\uFF1A"}),(0,e.jsx)(Xn.Z,{getData:Ee,data:E.data,total:E.total,ref:pe,showTableFilter:!1,hasNavigation:!1,columns:rr}),(0,e.jsx)("br",{}),(0,e.jsx)("div",{className:"title",children:"\u8F93\u51FA\u53D8\u91CF\uFF1A"}),(0,e.jsx)(Xn.Z,{getData:ze,data:me.data,total:me.total,ref:Ze,showTableFilter:!1,hasNavigation:!1,columns:re})]})}var Za=Ta,Na=r(40056),Ma=function(l,a){return(0,ge.ZP)("/api/pipeline/internal_atom/".concat(a,"/get_approve_info_by_userid"),{method:"get",params:l})},Oa=function(l,a){return(0,ge.ZP)("/api/pipeline/internal_atom/".concat(a,"/comments"),{method:"get",params:l})},La=function(l,a){return(0,ge.ZP)("/api/pipeline/internal_atom/".concat(a,"/comments"),{method:"post",data:l})},Va=function(l,a){return(0,ge.ZP)("/api/pipeline/task_run_info/".concat(a,"/variables_list"),{method:"post",data:l})},Ua=function(l,a){return(0,ge.ZP)("/api/pipeline/task_run_info/".concat(a,"/variables_list"),{method:"get",params:l})},Ka=function(l,a){return(0,ge.ZP)("/api/pipeline/internal_atom/".concat(a,"/manual_confirm"),{method:"post",data:l})},$a=function(l,a){return(0,ge.ZP)("/api/pipeline/internal_atom/".concat(a,"/delay"),{method:"post",data:l})},Wa=function(l,a){return(0,ge.ZP)("/api/pipeline/task_run_info/".concat(a,"/query_var_via_key"),{method:"get",params:l})},_a=r(36683),xa=r(18429),ja=r(87547),ya=r(88026),Ha=r(74330),Pt=r(81492),At=function(l){return request("/api/test",{method:"get",params:l})};function Ja(){return(0,e.jsx)("div",{className:"common-component-loading-container position-center",children:(0,e.jsx)(Ha.Z,{tip:"Loading..."})})}var Ca=Ja,ba=r(9646),ia=r(2331),za=["key","name"],Ga=(0,_a.Z)({scriptUrl:"//at.alicdn.com/t/c/font_4376956_po55h0nn5k.js"}),Ea=Qe.Z.TextArea;function Ya(s,l){var a,S,h=s.config,E=(0,n.useState)(""),ee=m()(E,2),Z=ee[0],ye=ee[1],me=(0,n.useState)(""),$=m()(me,2),be=$[0],Ze=$[1],pe=(0,n.useState)(!0),Ee=m()(pe,2),ze=Ee[0],ke=Ee[1],Ie=(0,n.useState)(!1),rr=m()(Ie,2),re=rr[0],B=rr[1],T=(0,n.useState)([]),xe=m()(T,2),Pe=xe[0],N=xe[1],ne=(0,n.useState)(!1),z=m()(ne,2),R=z[0],M=z[1],v=(0,n.useState)({}),g=m()(v,2),f=g[0],w=g[1],G=(0,n.useState)([]),ie=m()(G,2),D=ie[0],Fr=ie[1],Ae=(0,n.useState)(!1),d=m()(Ae,2),y=d[0],U=d[1],O=(0,n.useRef)([]),Y=(0,n.useRef)({}),nr=V.Z.useForm(),Se=m()(nr,1),H=Se[0],P=V.Z.useForm(),ve=m()(P,1),oe=ve[0],C=(0,ya.useModel)("@@initialState"),Ue=C.initialState,ar=Ue.currentUser,wr=ar===void 0?{}:ar,bn=(h==null||(a=h.variables)===null||a===void 0?void 0:a.event)==="task"?"\u53D6\u6D88":"\u62D2\u7EDD",fr=(h==null||(S=h.variables)===null||S===void 0?void 0:S.event)==="task"?"\u5B8C\u6210":"\u901A\u8FC7";(0,n.useImperativeHandle)(l,function(){return{open}}),(0,n.useEffect)(function(){var _r;F(),setTimeout(function(){Y.current.reviewInfoApiRun=!1},0),H.setFieldValue("runtime_var",(h==null||(_r=h.variables)===null||_r===void 0?void 0:_r.runtime_var)||[])},[]),(0,n.useEffect)(function(){h.status==="manual_confirm"?Y.current&&(Y.current.reviewInfoApiRun===!1&&Ln(),Y.current.reviewInfoApiRun=!0):Y.current&&(Y.current.reviewInfoApiRun=!1)},[h]);var hn=function(){var _r=p()(o()().mark(function se(){var Ne,Ge;return o()().wrap(function(Dr){for(;;)switch(Dr.prev=Dr.next){case 0:return Dr.prev=0,Dr.next=3,Oa({},h.logId);case 3:Ne=Dr.sent,Ge=Ne.data,Fr(Ge),Dr.next=10;break;case 8:Dr.prev=8,Dr.t0=Dr.catch(0);case 10:case"end":return Dr.stop()}},se,null,[[0,8]])}));return function(){return _r.apply(this,arguments)}}(),Ln=function _r(){F(),setTimeout(function(){var se;(se=Y.current)!==null&&se!==void 0&&se.reviewInfoApiRun&&_r()},3e3)},tr=function(se){var Ne=/\$\{([^}]*)\}/,Ge=se.match(Ne)||[],Nr=Ge[1]||"";return Nr.trim()},F=function(){var _r=p()(o()().mark(function se(){var Ne,Ge,Nr,Dr,Vn,qn,Sn,gn;return o()().wrap(function(Nn){for(;;)switch(Nn.prev=Nn.next){case 0:if(Nn.prev=0,hn(),J(),Ge=h==null||(Ne=h.variables)===null||Ne===void 0?void 0:Ne.users,!(O.current.length<=0&&typeof Ge=="string")){Nn.next=12;break}return Nn.next=7,Wa({key:tr(Ge)},h.logId);case 7:Nr=Nn.sent,Dr=Nr.data,Vn=Dr===void 0?[]:Dr,Vn=Vn||[],Ge=O.current=Vn;case 12:return O.current.length>0&&(Ge=O.current),Array.isArray(Ge)&&(Ge=Ge.map(function(pa){return pa.user_id}).join(",")),qn={user_ids:Ge},Nn.next=17,Ma(qn,h.logId);case 17:Sn=Nn.sent,gn=Sn.data,w(x()({},gn)),ke(!1),Nn.next=25;break;case 23:Nn.prev=23,Nn.t0=Nn.catch(0);case 25:case"end":return Nn.stop()}},se,null,[[0,23]])}));return function(){return _r.apply(this,arguments)}}(),J=function(){var _r=p()(o()().mark(function se(){var Ne,Ge;return o()().wrap(function(Dr){for(;;)switch(Dr.prev=Dr.next){case 0:return Dr.prev=0,Dr.next=3,Ua({},h.logId);case 3:Ne=Dr.sent,Ge=Ne.data,N(Ge),Dr.next=10;break;case 8:Dr.prev=8,Dr.t0=Dr.catch(0);case 10:case"end":return Dr.stop()}},se,null,[[0,8]])}));return function(){return _r.apply(this,arguments)}}(),we=function(){var se=f.approve_info||[],Ne=f.expired_at*1e3,Ge=Date.now();if(f.result!=="PENDING"||h.status!=="manual_confirm"||Ge>=Ne-500)return!1;var Nr=se.find(function(Dr){return Dr.user_id===wr.username});if(Nr&&Nr.state==="PENDING")return!0},Rr=function(){var _r=p()(o()().mark(function se(){return o()().wrap(function(Ge){for(;;)switch(Ge.prev=Ge.next){case 0:return Ge.next=2,H.validateFields();case 2:if(Z){Ge.next=5;break}return De.ZP.error("\u8BF7\u586B\u5199\u539F\u56E0"),Ge.abrupt("return");case 5:ir(!1);case 6:case"end":return Ge.stop()}},se)}));return function(){return _r.apply(this,arguments)}}(),sn=function(){var _r=p()(o()().mark(function se(){return o()().wrap(function(Ge){for(;;)switch(Ge.prev=Ge.next){case 0:ir(!0);case 1:case"end":return Ge.stop()}},se)}));return function(){return _r.apply(this,arguments)}}(),ir=function(){var _r=p()(o()().mark(function se(Ne){var Ge,Nr,Dr,Vn;return o()().wrap(function(Sn){for(;;)switch(Sn.prev=Sn.next){case 0:return Sn.prev=0,B(!0),Nr={task_run_info_id:h.logId,user_id:wr.username,reason:Z,state:Ne?"PASS":"REJECT"},Sn.next=5,H.validateFields();case 5:return Dr=Sn.sent,Sn.next=8,Ka(Nr,h.logId);case 8:return Vn=[],(Ge=Dr.runtime_var)===null||Ge===void 0||Ge.forEach(function(gn){gn.scope="pipeline";var ma=Pe.find(function(Nn){return gn.key===Nn.key&&gn.description===Nn.description});gn.value=gn.value||"",!ma&&gn.value.trim()&&Vn.push(gn)}),Sn.next=12,Va(Vn,h.logId);case 12:F(),De.ZP.success("\u64CD\u4F5C\u6210\u529F"),Sn.next=19;break;case 16:Sn.prev=16,Sn.t0=Sn.catch(0),console.log(Sn.t0);case 19:return Sn.prev=19,B(!1),Sn.finish(19);case 22:case"end":return Sn.stop()}},se,null,[[0,16,19,22]])}));return function(Ne){return _r.apply(this,arguments)}}(),an=function(){return f.result==="PENDING"&&(h.status==="pending"||h.status==="running"||h.status==="manual_confirm")},Rn=function(){return(0,e.jsxs)("div",{className:"review-tips flex-start",children:[(0,e.jsx)(Ga,{type:"icon-ai43",style:{color:"#ee9900",fontSize:"18px",marginTop:"-1px"}}),"\xA0\u6D41\u6C34\u7EBF\u3010",h.name,"\u3011\uFF0C\u5F53\u524D\u4EFB\u52A1\u8FDB\u5165\u4EBA\u5DE5\u9636\u6BB5"]})},ra=function(se){var Ne=(0,e.jsx)("div",{className:"status-pending"});switch(se){case"PASS":Ne=(0,e.jsx)(In.Z,{style:{color:"#4dcb4f"}});break;case"REJECT":case"TIMEOUT":Ne=(0,e.jsx)(xa.Z,{style:{color:"#e23f3c"}});break}return(0,e.jsx)("div",{className:"item-box",style:{width:"15px"},children:Ne})},sr=function(){var se=f.approve_info||[];return se.length<=0?(0,e.jsx)(e.Fragment,{}):(0,e.jsxs)("div",{className:"review-approved",children:[(0,e.jsxs)("p",{className:"review-approved-title",children:[an()?"\u6B63\u5728\u7B49\u5F85\u4EE5\u4E0B\u6210\u5458\u64CD\u4F5C":"\u6210\u5458\u64CD\u4F5C\u8BB0\u5F55","\uFF1A"]}),(0,e.jsx)("ul",{className:"review-approved-list",children:se.map(function(Ne){return(0,e.jsxs)("li",{className:"flex-start",children:[ra(Ne.state),(0,e.jsx)("div",{className:"item-box",children:Ne.display_name}),(0,e.jsx)("div",{className:"item-box",style:{flex:1,color:"#333",wordBreak:"break-all"},dangerouslySetInnerHTML:{__html:q(Ne.reason||"")}})]})})})]})},j=function(se){var Ne=new Date().getTime(),Ge=Math.floor((se-Ne)/1e3),Nr=Math.floor(Ge/(24*60*60)),Dr=Math.floor(Ge%(24*60*60)/(60*60)),Vn=Math.floor(Ge%(60*60)/60),qn=Math.floor(Ge%60);return Nr=String(Nr).padStart(2,"0"),Dr=String(Dr).padStart(2,"0"),Vn=String(Vn).padStart(2,"0"),qn=String(qn).padStart(2,"0"),"".concat(Nr," \u5929 ").concat(Dr," \u5C0F\u65F6 ").concat(Vn," \u5206\u949F ").concat(qn," \u79D2")},b=function(){return(0,e.jsx)(e.Fragment,{children:j(f.expired_at*1e3||0)})},K=function(){var _r=p()(o()().mark(function se(){var Ne,Ge,Nr,Dr,Vn,qn;return o()().wrap(function(gn){for(;;)switch(gn.prev=gn.next){case 0:return gn.prev=0,gn.next=3,oe.validateFields();case 3:if(Ne=gn.sent,Ge=Ne.review_day,Nr=Ne.review_hour,Dr=Ne.review_minute,Vn=Nr+Ge*24,!(Vn<=0)){gn.next=11;break}return De.ZP.error("\u8BF7\u9009\u62E9"),gn.abrupt("return");case 11:return qn={delay_interval:Vn},gn.next=14,$a(qn,h.logId);case 14:De.ZP.success("\u5EF6\u671F\u6210\u529F"),M(!1),oe.resetFields(),F(),gn.next=22;break;case 20:gn.prev=20,gn.t0=gn.catch(0);case 22:case"end":return gn.stop()}},se,null,[[0,20]])}));return function(){return _r.apply(this,arguments)}}(),Oe=function(){var se=oe.getFieldValue("review_day"),Ne=oe.getFieldValue("review_hour");return se+Ne<=0?Promise.reject("\u8BF7\u9009\u62E9"):Promise.resolve()},q=function(se){var Ne=/(https?:\/\/[^\s]+)/g;return se.replace(Ne,function(Ge){return'<a href="'.concat(Ge,'" target="_blank">').concat(Ge,"</a>")})},Zr=function(){return(0,e.jsxs)(V.Z,{layout:"vertical",form:oe,children:[(0,e.jsx)(V.Z.Item,{name:"review_day",rules:[{validator:Oe}],children:(0,e.jsxs)("div",{className:"flex-start",children:[(0,e.jsxs)("div",{className:"flex-start",children:[(0,e.jsx)(V.Z.Item,{name:"review_day",initialValue:0,style:{width:"50px",margin:0},children:(0,e.jsx)(ue.Z,{options:ba.v0,size:"small",onChange:function(){return oe.validateFields()}})}),"\xA0\u5929\xA0"]}),(0,e.jsxs)("div",{className:"flex-start",children:[(0,e.jsx)(V.Z.Item,{name:"review_hour",initialValue:0,style:{width:"50px",margin:0},children:(0,e.jsx)(ue.Z,{options:ba.xO,size:"small",onChange:function(){return oe.validateFields()}})}),"\xA0\u5C0F\u65F6"]})]})}),(0,e.jsxs)("div",{className:"flex-end",style:{margin:"10px 0"},children:[(0,e.jsx)(vr.ZP,{type:"primary",size:"small",onClick:function(){return K()},children:"\u63D0\u4EA4"}),"\xA0\xA0",(0,e.jsx)(vr.ZP,{size:"small",onClick:function(){M(!1)},children:"\u53D6\u6D88"})]})]})},Sr=function(){var se;return(0,e.jsxs)("div",{className:"review-instructions",children:[(0,e.jsx)("b",{className:"review-instructions-title",children:"\u64CD\u4F5C\u8BF4\u660E\uFF1A"}),(0,e.jsx)("div",{style:{whiteSpace:"pre-wrap"},dangerouslySetInnerHTML:{__html:q((h==null||(se=h.variables)===null||se===void 0?void 0:se.confirm_description)||"-")}}),an()&&f.expired_at>0&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{style:{marginTop:"8px"},children:[(0,e.jsx)("div",{style:{color:"#7F7F7F"},children:"\u5269\u4F59\u64CD\u4F5C\u65F6\u95F4\uFF1A"}),(0,e.jsx)("span",{style:{color:"#FF2262"},children:b()}),"\xA0\xA0\xA0",(0,e.jsx)(Hr.Z,{open:R,content:Zr(),title:"\u8BBE\u7F6E\u5EF6\u671F\u65F6\u95F4",trigger:"click",children:(0,e.jsx)(vr.ZP,{size:"small",disabled:!(0,ia.rO)("Delay",h.uuid),type:"primary",ghost:!0,onClick:function(){return M(!0)},children:"\u5EF6\u671F"})}),"\xA0\xA0\xA0"]}),!(0,ia.rO)("Delay",h.uuid)&&(0,e.jsx)(Na.Z,{style:{marginTop:"8px"},message:"\u60A8\u6CA1\u6709\u6743\u9650\u8FDB\u884C\u5EF6\u671F\u64CD\u4F5C\uFF0C\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458\u5904\u7406\u3002Caps \u53D1\u5E03\u6D41\u7A0B\u8054\u7CFB\u8881\u71D5\u8273\uFF0C\u5176\u4ED6\u6D41\u7A0B\u8054\u7CFB\u76DB\u6D77\u82F1",type:"warning",showIcon:!0})]})]})},wn=function(){return(0,ia.rO)("Delay",h.uuid)?(0,e.jsxs)("div",{className:"review-description",children:[(0,e.jsx)("p",{children:"\u8BF7\u53C2\u7167\u4EE5\u4E0A\u8BF4\u660E\u64CD\u4F5C\u76F8\u5173\u7ED3\u679C\uFF0C\u9009\u62E9\u70B9\u51FB\u4EE5\u4E0B\u6309\u94AE\u5B8C\u6210\u64CD\u4F5C:"}),(0,e.jsxs)("p",{children:[(0,e.jsxs)("b",{children:[fr,":"]})," \u8BE5\u4EBA\u5DE5\u64CD\u4F5C\u4EFB\u52A1\u6210\u529F\uFF0C\u6D41\u7A0B\u7EE7\u7EED"]}),(0,e.jsxs)("p",{children:[(0,e.jsxs)("b",{children:[bn,":"]})," \u8BE5\u4EBA\u5DE5\u64CD\u4F5C\u4EFB\u52A1\u5931\u8D25\uFF0C\u6D41\u7A0B\u7EC8\u6B62"]}),(0,e.jsxs)("p",{children:[(0,e.jsx)("b",{children:"\u4EC5\u8BC4\u8BBA\uFF1A"})," \u4EC5\u6DFB\u52A0\u8BC4\u8BBA\uFF0C\u6682\u65F6\u4E0D\u5BA1\u6279\u6216\u8005\u4E0D\u505A\u4EFB\u4F55\u64CD\u4F5C"]})]}):(0,e.jsx)(e.Fragment,{})},$n=function(){return(0,e.jsx)("div",{className:"review-input",children:(0,e.jsx)("div",{children:(0,e.jsx)(Ea,{value:Z,onChange:function(Ne){return ye(Ne.target.value)},placeholder:"\u53EF\u8F93\u5165\u8BC4\u8BBA\uFF0C\u4E5F\u53EF\u4EE5\u8F93\u5165".concat(fr,"/").concat(bn,"\u7684\u539F\u56E0"),autoSize:{minRows:3,maxRows:5}})})})},Fn=function(){var se=(0,e.jsx)("div",{style:{color:"#4dcb4f"},children:"\u6210\u529F"});switch(f.result){case"REJECT":se=(0,e.jsx)("div",{style:{color:"#e23f3c"},children:"\u5931\u8D25"});break;case"TIMEOUT":se=(0,e.jsx)("div",{style:{color:"#e23f3c"},children:"\u8D85\u65F6"});break}return h.status!=="pending"&&h.status!=="running"&&h.status!=="manual_confirm"&&h.status!=="success"&&(se=(0,e.jsx)("div",{style:{color:"#e23f3c"},children:"\u5931\u8D25"})),h.status==="skipped"&&(se=(0,e.jsx)("div",{style:{color:"#9BABB8"},children:"\u8DF3\u8FC7"})),(0,e.jsxs)("div",{className:"review-result",children:[(0,e.jsx)("p",{className:"review-result-title",children:"\u6267\u884C\u7ED3\u679C"}),se]})},Jn=function(){return(0,e.jsx)("div",{className:"review-button flex-center",children:we()?(0,e.jsxs)("div",{children:[(0,e.jsx)(vr.ZP,{type:"primary",ghost:!0,className:"review-comment-submit",disabled:y,onClick:function(){return zn()},children:"\u4EC5\u8BC4\u8BBA"}),(0,e.jsx)(vr.ZP,{type:"primary",onClick:function(){return sn()},loading:re,children:fr}),"\xA0\xA0\xA0\xA0\xA0",(0,e.jsx)(vr.ZP,{type:"primary",danger:!0,onClick:function(){return Rr()},loading:re,children:bn})]}):(0,e.jsx)(e.Fragment,{})})},zn=function(){var _r=p()(o()().mark(function se(){var Ne;return o()().wrap(function(Nr){for(;;)switch(Nr.prev=Nr.next){case 0:if(Nr.prev=0,U(!0),Z.trim()){Nr.next=5;break}return De.ZP.error("\u8BF7\u586B\u5199\u8BC4\u8BBA"),Nr.abrupt("return");case 5:return Ne={content:Z},Nr.next=8,La(Ne,h.logId);case 8:De.ZP.success("\u8BC4\u8BBA\u6210\u529F"),hn(),Nr.next=14;break;case 12:Nr.prev=12,Nr.t0=Nr.catch(0);case 14:return Nr.prev=14,ye(""),U(!1),Nr.finish(14);case 18:case"end":return Nr.stop()}},se,null,[[0,12,14,18]])}));return function(){return _r.apply(this,arguments)}}(),ea=function(){return(0,e.jsx)(e.Fragment,{children:oa()})},oa=function(){return(0,e.jsxs)("div",{className:"review-comment-list",children:[D.length>0&&(0,e.jsx)("div",{style:{color:"#7F7F7F",marginBottom:"2px"},children:"\u8BC4\u8BBA\u5217\u8868"}),D.length<=0?(0,e.jsx)("span",{style:{color:"#7f7f7f"}}):(0,e.jsx)("ul",{children:D.map(function(se){var Ne;return(0,e.jsxs)("li",{className:"flex-start comment-list-item",children:[(0,e.jsx)("div",{className:"item-avatar flex-center",children:(0,e.jsx)(ja.Z,{})}),(0,e.jsxs)("div",{className:"item-right",children:[(0,e.jsxs)("div",{className:"flex-space-between item-right-info",children:[(0,e.jsx)("div",{children:se==null||(Ne=se.user)===null||Ne===void 0?void 0:Ne.display_name}),(0,e.jsx)("div",{children:se.created_at})]}),(0,e.jsx)("div",{className:"item-right-comment",dangerouslySetInnerHTML:{__html:q(se.content)}})]})]})})})]})},Pa=function(se){return Pe.find(function(Ne){return se.key===Ne.key&&se.description===Ne.description})},Wn=function(){var se,Ne=(h==null||(se=h.variables)===null||se===void 0?void 0:se.runtime_var)||[];return Ne.length<=0?(0,e.jsx)(e.Fragment,{}):(0,e.jsxs)(V.Z,{form:H,name:"control-hooks",layout:"vertical",style:{marginTop:"10px"},children:[(0,e.jsx)("div",{style:{color:"#7F7F7F"},children:"\u8FD0\u884C\u65F6\u73AF\u5883\u53D8\u91CF"}),(0,e.jsx)(V.Z.List,{name:"runtime_var",children:function(Nr,Dr){var Vn=Dr.add,qn=Dr.remove;return(0,e.jsx)(e.Fragment,{children:Nr.map(function(Sn,gn){var ma=Sn.key,Nn=Sn.name,pa=Lr()(Sn,za),na=Ne[gn],da=Pa(na)||{},fa=da==null?void 0:da.value,Dt=da.key;return(0,e.jsx)("div",{className:"item-runtime_var",style:{marginBottom:"0px"},children:(0,e.jsx)(e.Fragment,{children:we()&&!Dt?(0,e.jsx)("div",{className:"flex-start",style:{alignItems:"flex-start"},children:(0,e.jsx)("div",{className:"flex-space-between",style:{flex:1,alignItems:"flex-end"},children:(0,e.jsx)(V.Z.Item,x()(x()({extra:na.description},pa),{},{name:[Nn,"value"],rules:[{required:na.required,message:"\u8BF7\u8F93\u5165"}],initialValue:void 0,label:na.display_name||na.key,style:{marginBottom:"0px",width:"100%"},children:(0,e.jsx)(Ea,{autoSize:{minRows:1,maxRows:4},placeholder:"\u8BF7\u8F93\u5165"})}))})}):(0,e.jsx)(e.Fragment,{children:(0,e.jsx)("div",{style:{wordBreak:"break-all"},children:na.display_name?(0,e.jsxs)("span",{children:[na.display_name,"(",na.key,")\uFF1A",(0,e.jsx)("span",{style:{color:"#7f7f7f"},dangerouslySetInnerHTML:{__html:q(fa||"-")}})]}):(0,e.jsxs)("span",{children:[na.key,"\uFF1A",(0,e.jsx)("span",{style:{color:"#7f7f7f"},dangerouslySetInnerHTML:{__html:q(fa||"-")}})]})})})})})})})}})]})},St=function(){return(0,e.jsxs)(e.Fragment,{children:[an()&&Rn(),(0,e.jsxs)("div",{className:"review-scroll common-scroll-bar ".concat(an()&&"review-scroll-running"),children:[!an()&&Fn(),Sr(),sr(),an()&&(0,e.jsxs)(e.Fragment,{children:[Wn(),wn(),ea()]}),!an()&&(0,e.jsxs)(e.Fragment,{children:[Wn(),oa()]})]}),an()&&(0,e.jsx)(e.Fragment,{children:we()&&$n()}),Jn()]})};return(0,e.jsx)("div",{ref:Y,className:"flow-created-new-review-container",children:ze?(0,e.jsx)(Ca,{}):St()})}var Xa=(0,n.forwardRef)(Ya);function Qa(s,l){var a,S=s.type,h=(0,n.useState)(!1),E=m()(h,2),ee=E[0],Z=E[1],ye=(0,n.useState)({}),me=m()(ye,2),$=me[0],be=me[1],Ze=(0,n.useState)(0),pe=m()(Ze,2),Ee=pe[0],ze=pe[1],ke=(0,n.useState)({}),Ie=m()(ke,2),rr=Ie[0],re=Ie[1],B=(0,n.useRef)({}),T=(0,n.useRef)({}),xe=(0,n.useRef)(null),Pe=[{id:0,name:"\u65E5\u5FD7"},{id:1,name:"\u914D\u7F6E"}];$.type===3&&Pe.push({id:2,name:"\u73AF\u5883\u53D8\u91CF"}),$!=null&&(a=$.atom_name)!==null&&a!==void 0&&a.startsWith("\u4EBA\u5DE5\u4EFB\u52A1")&&Pe.unshift({id:3,name:"\u64CD\u4F5C\u8BB0\u5F55"}),(0,n.useImperativeHandle)(l,function(){return{open:z,updateData:ne}}),(0,n.useEffect)(function(){return window.addEventListener("keydown",N),function(){window.removeEventListener("keydown",N)}},[]);var N=function(Y){(Y.keyCode===27||Y.key==="Escape")&&g()},ne=function(Y){try{var nr=T.current,Se=nr.stageIndex,H=nr.jobIndex,P=nr.stepIndex,ve=nr.type,oe={};if(Se!==void 0)switch(ve){case 1:case 3:oe=Y.template[Se].jobs[H].tasks[P];break;case 2:oe=Y.template[Se].jobs[H];break}be(x()(x()({},$),oe))}catch(C){console.log(C)}},z=function(Y,nr){var Se;Z(!0);var H=0;Y!=null&&(Se=Y.atom_name)!==null&&Se!==void 0&&Se.startsWith("\u4EBA\u5DE5\u4EFB\u52A1")&&(H=3),re(nr),ze(H),be(Y),setTimeout(function(){B.current.style.opacity=1,T.current.stageIndex=Y.stageIndex,T.current.jobIndex=Y.jobIndex,T.current.stepIndex=Y.stepIndex,T.current.type=Y.type},0)},R=function(){Z(!1)},M=function(){},v=function(Y){xe.current.handleDisplay(Y)},g=function(){s.update(),R(),f()},f=function(){$.logContent="",$!=null&&$.tasks&&($==null||$.tasks.forEach(function(Y){Y.logContent=""}))},w=function(Y){ze(Y)};if(!ee)return(0,e.jsx)(e.Fragment,{});var G=function(Y){return(0,e.jsxs)(e.Fragment,{children:[Y==="success"&&(0,e.jsx)("i",{className:"iconfont icon-success-filling flow-color-success flex-center"}),(Y==="failed"||Y==="timeout")&&(0,e.jsx)("i",{className:"iconfont icon-Shapex flow-color-failed  flex-center"}),(Y==="pending"||Y==="skipped")&&(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(Kn.Z,{className:"flow-color-pending iconfont"})}),Y==="canceled"&&(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(En.Z,{className:"flow-color-canceled iconfont"})}),(Y==="running"||Y==="manual_confirm")&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Xr.Z,{className:"flow-color-running",style:{fontSize:"18px",marginRight:"1px"}}),"\xA0\xA0"]}),Y!=="running"&&Y!=="manual_confirm"&&(0,e.jsx)(e.Fragment,{children:"\xA0\xA0\xA0\xA0\xA0\xA0\xA0"})]})},ie=function(){var Y=$.status;return(0,e.jsxs)("header",{className:"content-header flex-space-between",children:[(0,e.jsxs)("div",{className:"header-left flex-start",children:[G(Y),$.name]}),$.type!==1&&(0,e.jsx)(e.Fragment,{children:(0,e.jsx)("ul",{className:"header-center flex-start",children:Pe.map(function(nr,Se){return(0,e.jsx)("li",{className:"".concat(Ee===nr.id&&"action"),onClick:function(){return w(nr.id)},children:nr.name},nr.id)})})}),(0,e.jsx)("div",{className:"header-right flex-center",onClick:function(){return R()},children:(0,e.jsx)(Pn.Z,{})})]})},D=function(){switch($.type){case 1:return(0,e.jsx)(qe,{config:$,type:S,setConfig:be});case 2:return(0,e.jsx)(_,{config:$,type:S,setConfig:be});case 3:return(0,e.jsx)(A.Z,{config:$,type:S,close:g,setConfig:be,handleLoading:v,data:rr})}},Fr=function(){return $.id?(0,e.jsx)(ka,{config:$,renderState:G}):(0,e.jsx)(e.Fragment,{})},Ae=function(){return(0,e.jsx)("div",{className:"content-box-config",children:D()})},d=function(){return(0,e.jsx)(Za,{tabIndex:Ee,config:$})},y=function(){return(0,e.jsx)(Xa,{config:$})},U=function(){return $.type===1?(0,e.jsx)("div",{className:"content-box",children:(0,e.jsx)("div",{className:"content-box-config",children:D()})}):(0,e.jsx)("div",{className:"content-box",children:(0,e.jsxs)("div",{className:"content-box-log-container ".concat("content-box-log-show"),children:[Ee===0&&Fr(),Ee===1&&Ae(),Ee===2&&d(),Ee===3&&y()]})})};return(0,yn.createPortal)((0,e.jsx)("div",{className:"exec-detail-container replace-font-size-12",onClick:g,ref:B,children:(0,e.jsxs)("div",{className:"content",onClick:function(Y){return Y.stopPropagation()},children:[ie(),U(),(0,e.jsx)(le.gb,{ref:xe})]})}),document.body)}var qa=(0,n.forwardRef)(Qa),Fa=r(78957),ca=r(59259),et=function(l){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(0,ge.ZP)("/api/pipeline/stage_run_info/".concat(l,"/retry"),{method:"post",data:a})},rt=function(l){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(0,ge.ZP)("/api/pipeline/stage_run_info/".concat(l,"/retry_failed_jobs"),{method:"post",data:a})},nt=function(l,a){return(0,ge.ZP)("/api/pipeline/job_run_info/".concat(l,"/retry"),{method:"post",data:a})},at=k.Z.Group;function tt(s,l){var a=s.repeatPipelineStatus,S=(0,n.useState)(1),h=m()(S,2),E=h[0],ee=h[1],Z=(0,n.useState)(!1),ye=m()(Z,2),me=ye[0],$=ye[1],be=(0,n.useState)(!1),Ze=m()(be,2),pe=Ze[0],Ee=Ze[1],ze=(0,n.useState)("stage"),ke=m()(ze,2),Ie=ke[0],rr=ke[1],re=(0,n.useState)(!0),B=m()(re,2),T=B[0],xe=B[1],Pe=(0,n.useState)(!1),N=m()(Pe,2),ne=N[0],z=N[1],R=(0,n.useState)(!0),M=m()(R,2),v=M[0],g=M[1],f=(0,n.useState)([]),w=m()(f,2),G=w[0],ie=w[1],D=(0,n.useState)([]),Fr=m()(D,2),Ae=Fr[0],d=Fr[1],y=(0,n.useRef)(null);(0,n.useImperativeHandle)(l,function(){return{open:U}});var U=function(C){var Ue=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"stage";y.current.recordData=C,Ue==="job"&&(ie(C.tasks),d(C.tasks.map(function(ar){return ar.logId}))),Ee(!0),ee(1),rr(Ue)},O=function(){Ee(!1),z(!1),g(!0)},Y=function(){var oe=p()(o()().mark(function C(){var Ue,ar,wr;return o()().wrap(function(fr){for(;;)switch(fr.prev=fr.next){case 0:return $(!0),fr.prev=1,Ue=y.current.recordData.pipelineId,ar=E===2?rt:et,wr={trigger_follow_up:T},Ie==="job"&&(ar=nt,wr.selected_tasks=Ae),fr.next=8,ar(Ue,wr);case 8:O(),De.ZP.success("\u6B63\u5728\u91CD\u8DD1\u4E2D\uFF0C\u8BF7\u7A0D\u540E..."),a("retry"),fr.next=16;break;case 13:fr.prev=13,fr.t0=fr.catch(1),O();case 16:return fr.prev=16,$(!1),fr.finish(16);case 19:case"end":return fr.stop()}},C,null,[[1,13,16,19]])}));return function(){return oe.apply(this,arguments)}}(),nr=function(C){ee(C.target.value)},Se=function(C){xe(C.target.checked)},H=function(C){if(C.length<1){De.ZP.error("\u8BF7\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A");return}z(!!C.length&&C.length<G.length),d(C)},P=function(C){var Ue=C.target.checked;if(!Ue&&!ne){De.ZP.error("\u65E0\u6CD5\u5168\u90E8\u53D6\u6D88\uFF0C\u81F3\u5C11\u9009\u62E9\u4E00\u4E2A");return}d(G.map(function(ar){return ar.logId})),z(!1),g(!0)},ve=function(){return Ie==="job"?(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{style:{marginTop:"5px"},children:[(0,e.jsx)(k.Z,{indeterminate:ne,onChange:P,checked:v,children:"\u5168\u9009"}),(0,e.jsx)("div",{style:{textIndent:"10px"},children:(0,e.jsx)(at,{value:Ae,onChange:H,children:G.map(function(C){return(0,e.jsx)("div",{children:(0,e.jsx)(k.Z,{value:C.logId,children:C.name})})})})})]})}):(0,e.jsx)(Ye.ZP.Group,{onChange:nr,value:E,children:(0,e.jsxs)(Fa.Z,{direction:"vertical",children:[(0,e.jsx)(Ye.ZP,{value:1,children:"\u91CD\u65B0\u8FD0\u884C Stage \u4E0B\u6240\u6709 Job"}),(0,e.jsx)(Ye.ZP,{value:2,children:"\u91CD\u65B0\u8FD0\u884C Stage \u4E0B\u6240\u6709\u5931\u8D25 Job"})]})})};return(0,e.jsx)("div",{ref:y,children:(0,e.jsx)(ca.Z,{title:"",width:400,className:"device-manage-Load-modal",centered:!0,destroyOnClose:!0,footer:[(0,e.jsxs)("div",{className:"flex-space-between",children:[(0,e.jsx)("div",{style:{marginLeft:"8px"},children:(0,e.jsx)(k.Z,{onChange:Se,defaultChecked:!0,value:T,children:"\u91CD\u8BD5\u540E\uFF0C\u62C9\u8D77\u540E\u7EED Stage"})}),(0,e.jsxs)("div",{children:[(0,e.jsx)(vr.ZP,{onClick:O,children:"\u53D6\u6D88"},"back"),(0,e.jsx)(vr.ZP,{type:"primary",disabled:!(0,ia.rO)("Trigger"),loading:me,onClick:Y,children:"\u786E\u5B9A"},"submit")]})]})],open:pe,onCancel:O,children:(0,e.jsx)("div",{className:"flow-retry-container",children:ve()})})})}var it=(0,n.forwardRef)(tt),st=function(l){return(0,ge.ZP)("/api/pipeline/job_run_info/".concat(l,"/cancel"),{method:"post"})},lt=function(l){return(0,ge.ZP)("/api/pipeline/pipeline_run_info/".concat(l,"/cancel"),{method:"post"})};function ut(s,l){var a=(0,n.useState)(1),S=m()(a,2),h=S[0],E=S[1],ee=(0,n.useState)(!1),Z=m()(ee,2),ye=Z[0],me=Z[1],$=(0,n.useState)(!1),be=m()($,2),Ze=be[0],pe=be[1],Ee=(0,n.useRef)(null),ze=(0,n.useRef)({}),ke=(0,L.DP)(),Ie=ke.triggerId;(0,n.useImperativeHandle)(l,function(){return{open:rr}});var rr=function(Pe,N){Ee.current.recordData=Pe,ze.current=N,pe(!0),E(1)},re=function(){pe(!1)},B=function(){var xe=p()(o()().mark(function Pe(){var N,ne,z;return o()().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return me(!0),N=Ee.current.recordData.pipelineId,ne=ze.current.configTriggerId,M.prev=3,z=h===2?lt:st,M.next=7,z(h===2?ne:N);case 7:re(),De.ZP.success("\u7EC8\u6B62\u6784\u5EFA\u8BF7\u6C42\u53D1\u9001\u6210\u529F\uFF0C\u8BF7\u7A0D\u540E.."),M.next=14;break;case 11:M.prev=11,M.t0=M.catch(3),re();case 14:return M.prev=14,me(!1),M.finish(14);case 17:case"end":return M.stop()}},Pe,null,[[3,11,14,17]])}));return function(){return xe.apply(this,arguments)}}(),T=function(Pe){E(Pe.target.value)};return(0,e.jsx)("div",{ref:Ee,children:(0,e.jsx)(ca.Z,{title:"",width:400,className:"device-manage-Load-modal",centered:!0,destroyOnClose:!0,footer:[(0,e.jsx)(vr.ZP,{onClick:re,children:"\u53D6\u6D88"},"back"),(0,e.jsx)(vr.ZP,{type:"primary",loading:ye,disabled:!(0,ia.rO)("Cancel"),onClick:B,children:"\u786E\u5B9A"},"submit")],open:Ze,onCancel:re,children:(0,e.jsx)("div",{className:"flow-retry-container",children:(0,e.jsx)(Ye.ZP.Group,{onChange:T,value:h,children:(0,e.jsxs)(Fa.Z,{direction:"vertical",children:[(0,e.jsx)(Ye.ZP,{value:1,children:"\u53D6\u6D88\u5F53\u524D\u8FD0\u884C Job"}),(0,e.jsx)(Ye.ZP,{value:2,children:"\u53D6\u6D88\u6240\u6709\u8FD0\u884C Job"})]})})})})})}var ot=(0,n.forwardRef)(ut),ct=r(9783),Sa=r.n(ct),dt=function(l,a){return(0,ge.ZP)("/api/pipeline/internal_atom/".concat(a,"/get_approve_info_by_userid"),{method:"get",params:l})},ft=function(l,a){return(0,ge.ZP)("/api/pipeline/internal_atom/".concat(a,"/manual_confirm"),{method:"post",data:l})},vt=(0,_a.Z)({scriptUrl:"//at.alicdn.com/t/c/font_4376956_po55h0nn5k.js"}),Da=Qe.Z.TextArea;function mt(s,l){var a=s.type,S=s.config,h=s.onValuesChange,E=(0,n.useState)(!1),ee=m()(E,2),Z=ee[0],ye=ee[1],me=(0,n.useState)(""),$=m()(me,2),be=$[0],Ze=$[1],pe=(0,n.useState)(""),Ee=m()(pe,2),ze=Ee[0],ke=Ee[1],Ie=(0,n.useState)({}),rr=m()(Ie,2),re=rr[0],B=rr[1],T=(0,n.useState)(!0),xe=m()(T,2),Pe=xe[0],N=xe[1],ne=(0,n.useState)(!1),z=m()(ne,2),R=z[0],M=z[1],v=(0,n.useState)({}),g=m()(v,2),f=g[0],w=g[1],G=(0,n.useRef)(null),ie=V.Z.useForm(),D=m()(ie,1),Fr=D[0],Ae=(0,ya.useModel)("@@initialState"),d=Ae.initialState,y=d.currentUser,U=y===void 0?{}:y;(0,n.useImperativeHandle)(l,function(){return{open:Y}}),(0,n.useEffect)(function(){if(G.current)try{var sr=G.current,j=sr.stageIndex,b=sr.jobIndex,K=sr.stepIndex;if(j===void 0||b===void 0||K===void 0)return;var Oe=S.template[j].jobs[b].tasks[K];B(x()({},Oe))}catch(q){console.log(q)}},[S]),(0,n.useEffect)(function(){re.status==="manual_confirm"?G.current&&(G.current.reviewInfoApiRun===!1&&O(),G.current.reviewInfoApiRun=!0):G.current&&(G.current.reviewInfoApiRun=!1)},[re]);var O=function sr(){H(),setTimeout(function(){G.current.reviewInfoApiRun&&sr()},1e3)},Y=function(j){ye(!0),H(j),B(j),setTimeout(function(){G.current.reviewInfoApiRun=!1,G.current.stageIndex=j.stageIndex,G.current.jobIndex=j.jobIndex,G.current.stepIndex=j.stepIndex},0)},nr=function(j){},Se=function(j,b){var K=Fr.getFieldValue("opinions");return K===2&&!b?Promise.reject("\u8BF7\u8F93\u5165\u7406\u7531"):Promise.resolve()},H=function(){var sr=p()(o()().mark(function j(b){var K,Oe,q;return o()().wrap(function(Sr){for(;;)switch(Sr.prev=Sr.next){case 0:return Sr.prev=0,Sr.next=3,dt({user_ids:(K=b||re)===null||K===void 0||(K=K.variables)===null||K===void 0?void 0:K.users.map(function(wn){return wn.user_id}).join(",")},(b||re).logId);case 3:Oe=Sr.sent,q=Oe.data,w(x()({},q)),N(!1),Sr.next=11;break;case 9:Sr.prev=9,Sr.t0=Sr.catch(0);case 11:case"end":return Sr.stop()}},j,null,[[0,9]])}));return function(b){return sr.apply(this,arguments)}}(),P=function(){G.current&&(G.current.reviewInfoApiRun=null),ye(!1),Ze("")},ve=function(){},oe=function(){var j=f.approve_info||[],b=f.expired_at*1e3,K=Date.now();if(f.result!=="PENDING"||re.status!=="manual_confirm"||K>=b-500)return!1;var Oe=j.find(function(q){return q.user_id===U.username});if(Oe&&Oe.state==="PENDING")return!0},C=function(){var j=f.result,b="";return(S==null?void 0:S.status)==="pending"&&(b="\u5F85\u64CD\u4F5C"),j==="PENDING"?b="\u64CD\u4F5C\u4E2D":b="\u4EBA\u5DE5\u64CD\u4F5C\u7ED3\u679C",(0,e.jsx)("div",{style:{fontSize:"12px",fontWeight:"bold"},children:b})},Ue=function(){var sr=p()(o()().mark(function j(){return o()().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:if(be){K.next=3;break}return De.ZP.error("\u8BF7\u586B\u5199\u539F\u56E0"),K.abrupt("return");case 3:wr(!1);case 4:case"end":return K.stop()}},j)}));return function(){return sr.apply(this,arguments)}}(),ar=function(){var sr=p()(o()().mark(function j(){return o()().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:wr(!0);case 1:case"end":return K.stop()}},j)}));return function(){return sr.apply(this,arguments)}}(),wr=function(){var sr=p()(o()().mark(function j(b){var K;return o()().wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return q.prev=0,M(!0),K={task_run_info_id:re.logId,user_id:U.username,reason:be,state:b?"PASS":"REJECT"},q.next=5,ft(K,re.logId);case 5:H(),De.ZP.success("\u64CD\u4F5C\u6210\u529F"),P(),q.next=13;break;case 10:q.prev=10,q.t0=q.catch(0),console.log(q.t0);case 13:return q.prev=13,M(!1),q.finish(13);case 16:case"end":return q.stop()}},j,null,[[0,10,13,16]])}));return function(b){return sr.apply(this,arguments)}}(),bn=function(){return f.result==="PENDING"&&(re.status==="pending"||re.status==="running"||re.status==="manual_confirm")},fr=function(){return(0,e.jsxs)("div",{className:"review-tips flex-start",children:[(0,e.jsx)(vt,{type:"icon-ai43",style:{color:"#ee9900",fontSize:"18px",marginTop:"-1px"}}),"\xA0\u6D41\u6C34\u7EBF\u3010",S.name,"\u3011\uFF0C\u5F53\u524D\u4EFB\u52A1\u8FDB\u5165\u4EBA\u5DE5\u9636\u6BB5"]})},hn=function(j){var b=(0,e.jsx)("div",{className:"status-pending"});switch(j){case"PASS":b=(0,e.jsx)(In.Z,{style:{color:"#4dcb4f"}});break;case"REJECT":case"TIMEOUT":b=(0,e.jsx)(xa.Z,{style:{color:"#e23f3c"}});break}return(0,e.jsx)("div",{className:"item-box",style:{width:"15px"},children:b})},Ln=function(){var j=f.approve_info||[];return j.length<=0?(0,e.jsx)(e.Fragment,{}):(0,e.jsxs)("div",{className:"review-approved",children:[(0,e.jsxs)("p",{className:"review-approved-title",children:[bn()?"\u6B63\u5728\u7B49\u5F85\u4EE5\u4E0B\u6210\u5458\u64CD\u4F5C":"\u6210\u5458\u64CD\u4F5C\u8BB0\u5F55","\uFF1A"]}),(0,e.jsx)("ul",{className:"review-approved-list",children:j.map(function(b){return(0,e.jsxs)("li",{className:"flex-start",children:[hn(b.state),(0,e.jsx)("div",{className:"item-box",children:b.display_name}),(0,e.jsx)("div",{className:"item-box",style:{flex:1,color:"#333",wordBreak:"break-all"},children:b.reason&&(0,e.jsx)(e.Fragment,{children:b.reason})})]})})})]})},tr=function(j){var b=Be()(j||0),K=Be()(),Oe=b.diff(K),q=Be().duration(Oe),Zr=q.days().toString().padStart(2,"0"),Sr=q.hours().toString().padStart(2,"0"),wn=q.minutes().toString().padStart(2,"0"),$n=q.seconds().toString().padStart(2,"0");function Fn(Jn){return Jn<=0?"00":Jn}return"".concat(Fn(Zr)," \u5929 ").concat(Fn(Sr)," \u5C0F\u65F6 ").concat(Fn(wn)," \u5206\u949F ").concat(Fn($n)," \u79D2")},F=function(){return(0,e.jsx)(e.Fragment,{children:tr(f.expired_at*1e3||0)})},J=function(){var j;return(0,e.jsxs)("div",{className:"review-instructions",children:[(0,e.jsx)("p",{className:"review-instructions-title",children:"\u64CD\u4F5C\u8BF4\u660E\uFF1A"}),(0,e.jsx)("div",{children:(re==null||(j=re.variables)===null||j===void 0?void 0:j.confirm_description)||"-"}),f.expired_at>0&&(0,e.jsxs)("div",{style:{marginTop:"8px"},children:[(0,e.jsx)("div",{style:{color:"#7F7F7F"},children:"\u5269\u4F59\u64CD\u4F5C\u65F6\u95F4\uFF1A"}),(0,e.jsx)("span",{style:{color:"#FF2262"},children:F()})]})]})},we=function(){return(0,e.jsxs)("div",{className:"review-description",children:[(0,e.jsx)("p",{children:"\u8BF7\u53C2\u7167\u4EE5\u4E0A\u8BF4\u660E\u64CD\u4F5C\u76F8\u5173\u7ED3\u679C\uFF0C\u9009\u62E9\u70B9\u51FB\u4EE5\u4E0B\u6309\u94AE\u5B8C\u6210\u64CD\u4F5C:"}),(0,e.jsx)("p",{children:"\u7EE7\u7EED: \u8BE5\u4EBA\u5DE5\u64CD\u4F5C\u4EFB\u52A1\u6210\u529F\uFF0C\u6D41\u6C34\u7EBF\u7EE7\u7EED\u6267\u884C"}),(0,e.jsx)("p",{children:"\u7EC8\u6B62: \u8BE5\u4EBA\u5DE5\u64CD\u4F5C\u4EFB\u52A1\u5931\u8D25\uFF0C\u6D41\u6C34\u7EBF\u7EC8\u6B62\u6267\u884C"})]})},Rr=function(){return(0,e.jsx)("div",{className:"review-input",children:(0,e.jsx)("div",{children:(0,e.jsx)(Da,{value:be,onChange:function(b){return Ze(b.target.value)},placeholder:"\u7EC8\u6B62/\u7EE7\u7EED\u539F\u56E0",autoSize:{minRows:3,maxRows:5}})})})},sn=function(){var j=(0,e.jsx)("div",{style:{color:"#4dcb4f"},children:"\u6210\u529F"});switch(f.result){case"REJECT":j=(0,e.jsx)("div",{style:{color:"#e23f3c"},children:"\u5931\u8D25"});break;case"TIMEOUT":j=(0,e.jsx)("div",{style:{color:"#e23f3c"},children:"\u8D85\u65F6"});break}return re.status!=="pending"&&re.status!=="running"&&re.status!=="manual_confirm"&&re.status!=="success"&&(j=(0,e.jsx)("div",{style:{color:"#e23f3c"},children:"\u5931\u8D25"})),(0,e.jsxs)("div",{className:"review-result",children:[(0,e.jsx)("p",{className:"review-result-title",children:"\u6267\u884C\u7ED3\u679C"}),j]})},ir=function(){var j,b,K=(re==null||(j=re.variables)===null||j===void 0?void 0:j.event)==="task"?"\u53D6\u6D88":"\u62D2\u7EDD",Oe=(re==null||(b=re.variables)===null||b===void 0?void 0:b.event)==="task"?"\u5B8C\u6210":"\u901A\u8FC7";return(0,e.jsx)("div",{className:"review-button flex-center",children:oe()?(0,e.jsxs)("div",{children:[(0,e.jsx)(vr.ZP,{type:"primary",onClick:function(){return ar()},loading:R,children:Oe}),"\xA0\xA0\xA0\xA0\xA0",(0,e.jsx)(vr.ZP,{type:"primary",danger:!0,onClick:function(){return Ue()},loading:R,children:K})]}):(0,e.jsx)(vr.ZP,{type:"primary",onClick:function(){return P()},children:"\u5173\u95ED"})})},an=function(){return(0,e.jsxs)(e.Fragment,{children:[oe()&&(0,e.jsxs)("div",{className:"review-comment",children:[(0,e.jsx)("div",{className:"review-comment-title",children:"\u8BC4\u8BBA"}),(0,e.jsx)(Da,{value:ze,onChange:function(b){return ke(b.target.value)},placeholder:"\u53D1\u5E03\u8BC4\u8BBA\uFF0C\u8BC4\u8BBA\u4FE1\u606F\u53EF\u5355\u72EC\u63D0\u4EA4",autoSize:{minRows:3,maxRows:5}}),(0,e.jsx)(vr.ZP,{type:"link",className:"review-comment-submit",children:"\u63D0\u4EA4"})]}),Rn()]})},Rn=function(){return(0,e.jsxs)("div",{className:"review-comment-list",children:[(0,e.jsx)("span",{style:{color:"#7f7f7f"},children:"\u6682\u65E0\u8BC4\u8BBA"}),(0,e.jsx)("ul",{children:(0,e.jsxs)("li",{className:"flex-start comment-list-item",children:[(0,e.jsx)("div",{className:"item-avatar flex-center",children:(0,e.jsx)(ja.Z,{})}),(0,e.jsxs)("div",{className:"item-right",children:[(0,e.jsxs)("div",{className:"flex-space-between item-right-info",children:[(0,e.jsx)("div",{children:"\u59DC\u5B50\u7259"}),(0,e.jsx)("div",{children:"2024-04-07 13:50"})]}),(0,e.jsx)("div",{className:"item-right-comment",children:"\u554A\u5B9E\u6253\u5B9E\u5927\u5927\u963F\u4E09\u5927\u82CF\u6253\u662F"})]})]})})]})},ra=function(){return(0,e.jsxs)(e.Fragment,{children:[bn()&&fr(),(0,e.jsxs)("div",{className:"review-scroll common-scroll-bar",children:[!bn()&&(0,e.jsxs)(e.Fragment,{children:[sn(),Rn()]}),Ln(),bn()&&(0,e.jsxs)(e.Fragment,{children:[J(),an(),we()]})]}),bn()&&(0,e.jsx)(e.Fragment,{children:oe()&&Rr()}),ir()]})};return(0,e.jsx)("div",{ref:G,children:(0,e.jsx)(ca.Z,Sa()(Sa()({className:"flow-created-review-modal-container",title:"",centered:!0,destroyOnClose:!0,footer:null,open:Z,onCancel:P},"title",C()),"children",Pe?(0,e.jsx)(Ca,{}):ra()))})}var pt=(0,n.forwardRef)(mt),ht=r(86548),gt=r(48689),_t=r(16664),xt=function(l){return(0,ge.ZP)("/api/test",{method:"get",params:l})},wt=Qe.Z.TextArea;function jt(s,l){var a=(0,n.useState)(!1),S=m()(a,2),h=S[0],E=S[1],ee=(0,n.useState)({}),Z=m()(ee,2),ye=Z[0],me=Z[1],$=(0,n.useRef)(null),be=V.Z.useForm(),Ze=m()(be,1),pe=Ze[0];(0,n.useImperativeHandle)(l,function(){return{open:Ee}});var Ee=function(f){me(f),E(!0)},ze=function(){E(!1)},ke=function(){var g=p()(o()().mark(function f(){var w;return o()().wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return ie.next=2,pe.validateFields();case 2:w=ie.sent;case 3:case"end":return ie.stop()}},f)}));return function(){return g.apply(this,arguments)}}(),Ie=(0,n.useState)({}),rr=m()(Ie,2),re=rr[0],B=rr[1],T=(0,n.useRef)(null),xe=function(){var g=p()(o()().mark(function f(w){var G,ie;return o()().wrap(function(Fr){for(;;)switch(Fr.prev=Fr.next){case 0:return Fr.next=2,xt(w);case 2:G=Fr.sent,ie=G.data,w.name&&(ie=ie.filter(function(Ae){return Ae.name.toLowerCase().includes(w.name)})),B({data:ie,total:ie.length});case 6:case"end":return Fr.stop()}},f)}));return function(w){return g.apply(this,arguments)}}(),Pe=[],N=[{title:"\u540D\u5B57",dataIndex:"name",key:"name",align:"center"},{title:"\u64CD\u4F5C",dataIndex:"operate",key:"operate",align:"center",width:260,render:function(f){return(0,e.jsxs)("span",{children:[(0,e.jsxs)(Hr.Z,{content:"\u7F16\u8F91",trigger:"hover",children:[(0,e.jsx)(vr.ZP,{onClick:function(){return z(f)},icon:(0,e.jsx)(ht.Z,{}),type:"primary",ghost:!0}),"\xA0\xA0\xA0"]}),(0,e.jsxs)(Hr.Z,{content:"\u5220\u9664",trigger:"hover",children:[(0,e.jsx)(vr.ZP,{onClick:function(){return R(f)},icon:(0,e.jsx)(gt.Z,{}),danger:!0}),"\xA0\xA0\xA0"]}),(0,e.jsxs)(Hr.Z,{content:"\u590D\u5236",trigger:"hover",children:[(0,e.jsx)(vr.ZP,{onClick:function(){return ne(f)},icon:(0,e.jsx)(Tn.Z,{})}),"\xA0\xA0\xA0"]}),(0,e.jsx)(Hr.Z,{content:"\u9884\u89C8",trigger:"hover",children:(0,e.jsx)(vr.ZP,{onClick:function(){return M(f)},icon:(0,e.jsx)(_t.Z,{})})})]})}}],ne=function(f){console.log("---copy",f)},z=function(f){console.log("---edit",f)},R=function(f){console.log("---del",f)},M=function(f){console.log("---preview",f)},v=function(){};return(0,e.jsx)("div",{ref:$,children:(0,e.jsxs)(ca.Z,{className:"flow-create-stage-consumptionModal-container",title:"\u6D88\u8D39\u4FE1\u606F",centered:!0,destroyOnClose:!0,footer:null,open:h,onCancel:ze,children:[(0,e.jsx)("br",{}),(0,e.jsx)(Xn.Z,{searchOptions:Pe,getData:xe,data:re.data,total:re.total,ref:T,hasNavigation:!1,showTableFilter:!1,columns:N})]})})}var yt=(0,n.forwardRef)(jt),Ct=function(l){return(0,ge.ZP)("/api/pipeline/job_run_info/".concat(l,"/skip"),{method:"post"})},bt=function(l){return(0,ge.ZP)("/api/pipeline/job_run_info/".concat(l,"/trigger"),{method:"post"})};function Et(s,l){var a=s.data,S=s.setData,h=s.type,E=s.repeatPipelineStatus,ee=s.newRunDetail,Z=(0,n.useState)(!1),ye=m()(Z,2),me=ye[0],$=ye[1],be=(0,n.useRef)(null),Ze=(0,n.useRef)(null),pe=(0,n.useRef)(null),Ee=(0,n.useRef)(null),ze=(0,n.useRef)(null),ke=(0,n.useRef)(null),Ie=(0,L.DP)();(0,n.useImperativeHandle)(l,function(){return{openJobLog:g}}),(0,n.useEffect)(function(){a&&pe.current.updateData(a)},[a]),(0,n.useEffect)(function(){rr()},[]);var rr=function(){for(var H=!1,P=0;P<a.stages.length;P++)for(var ve=P,oe=a.stages[P],C=0;C<oe.jobs.length;C++)for(var Ue=C,ar=oe.jobs[C],wr=0;wr<ar.tasks.length;wr++){var bn=wr,fr=ar.tasks[wr];if(fr.logId+""===Ie.open_modal_task_id){ee(),pe.current.open(x()(x()({},fr),{},{stageIndex:ve,jobIndex:Ue,stepIndex:bn}),a);return}if(fr.logId+""===Ie.open_modal_followed_task_id&&ar.tasks[wr+1]&&(ee(),pe.current.open(x()(x()({},ar.tasks[wr+1]),{},{stageIndex:ve,jobIndex:Ue,stepIndex:bn+1}),ar.tasks[wr+1])),a.status!=="running"&&a.status!=="pending"&&!Ie.open_modal_task_id){var hn;if((hn=fr.atom_name)!==null&&hn!==void 0&&hn.startsWith("\u4EBA\u5DE5\u4EFB\u52A1")&&(fr.status==="failed"||fr.status==="timeout")){ee(),pe.current.open(x()(x()({},fr),{},{stageIndex:ve,jobIndex:Ue,stepIndex:bn}),a);return}}}},re=function(H,P,ve,oe){H.stopPropagation();var C=a.template;if(P===1){var Ue=or();Ue.id=C.length+1,Ue.name="stage"+(C.length+1);var ar=Ke();ar.tasks.push(mr()),Ue.jobs.push(ar),ne(1,Ue,Ue.id),ve>=0?C.splice(ve,0,Ue):C.push(Ue)}else{var wr=(0,L.p$)(oe);wr.id=C.length+1,ne(1,wr,wr.id),C.splice(ve+1,0,wr)}S(x()({},a)),v()},B=function(H,P){H.stopPropagation();var ve=a.template;if(ve.length<=1){De.ZP.error("\u5DF2\u7ECF\u662F\u6700\u540E\u4E00\u4E2A Stage");return}ve.splice(P,1),S(x()({},a))},T=function(H,P,ve,oe,C){H.stopPropagation();var Ue=a.template,ar=Ue[ve],wr=ar.jobs,bn="".concat(ar.id,"-").concat(wr.length+1);if(P===1){var fr=(0,L.p$)(Ke()),hn=Math.random();fr.id=hn,fr.name="job",fr.tasks.push(mr()),ne(2,fr,hn),ar.jobs.push(fr)}else{var Ln=(0,L.p$)(C);Ln.id=bn,ne(2,Ln,Ln.id),ar.jobs.splice(oe+1,0,Ln)}S(x()({},a)),v()},xe=function(H,P,ve){H.stopPropagation();var oe=a.template,C=oe[P];if(C.jobs.length<=1){if(oe.length<=1){De.ZP.error("\u5DF2\u7ECF\u662F\u6700\u540E\u4E00\u4E2A Stage");return}oe.splice(P,1)}else C.jobs.splice(ve,1);S(x()({},a))},Pe=function(H,P,ve,oe,C,Ue,ar){H.stopPropagation();var wr=a.template,bn=wr[ve],fr=bn.jobs[oe],hn=fr.tasks,Ln="".concat(fr.id,"-").concat(hn.length);if(P===1){var tr=(0,L.p$)(mr()),F=Math.random();tr.id=F,tr.name="task",ne(3,tr,F),hn.push(tr)}else if(P===3){var J=(0,L.p$)(mr()),we=Math.random();J.id=we,J.name="task",ne(3,J,we),C===0&&!ar?hn.unshift(J):hn.splice(C+1,0,J)}else{var Rr=(0,L.p$)(Ue);Rr.id=Ln,ne(3,Rr,Ln),hn.splice(C+1,0,Rr)}S(x()({},a))},N=function(H,P,ve,oe){H.stopPropagation();var C=a.template,Ue=C[P].jobs[ve].tasks,ar=C[P],wr=C[P].jobs[ve];if(C.length<=1&&ar.jobs.length<=1&&Ue.length<=1){De.ZP.error("\u5DF2\u7ECF\u662F\u6700\u540E\u4E00\u4E2A Stage");return}else C.length>1&&ar.jobs.length<=1&&Ue.length<=1?C.splice(P,1):wr.tasks.length<=1?C[P].jobs.splice(ve,1):Ue.splice(oe,1);S(x()({},a))},ne=function(H,P,ve){switch(H){case 1:P.id=ve,P.jobs.forEach(function(oe,C){oe.id="".concat(P.id,"-").concat(C+1),oe.tasks.forEach(function(Ue,ar){Ue.id="".concat(P.id,"-").concat(C+1,"-").concat(ar+1)})});break;case 2:P.id=ve,P.tasks.forEach(function(oe,C){oe.id="".concat(P.id,"-").concat(C+1)});break;case 3:P.id="".concat(ve);break}},z=function(H,P){H.stopPropagation();var ve=a.template,oe=ve[P];oe.showAddButton=!oe.showAddButton,S(x()({},a))},R=function(H){H.stopPropagation(),$(!me)},M=function(){v()},v=function(){$(!1);var H=a.template;H.map(function(P){return P.showAddButton=!1,P}),S(x()({},a))},g=function(H,P){switch(H&&H.stopPropagation(),h){case 1:case 2:be.current.open(P,a);break;case 3:ee(),pe.current.open(P,a);break}},f=function(){S(x()({},a))},w=function(H,P){H.stopPropagation(),Ze.current.open(P)},G=function(){var Se=p()(o()().mark(function H(P,ve){return o()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:P.stopPropagation(),Ee.current.open(ve,a);case 2:case"end":return C.stop()}},H)}));return function(P,ve){return Se.apply(this,arguments)}}(),ie=function(){var Se=p()(o()().mark(function H(P,ve){return o()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(P.stopPropagation(),(0,ia.rO)("Skip")){C.next=4;break}return De.ZP.error("\u6682\u65E0\u6743\u9650"),C.abrupt("return");case 4:return C.prev=4,C.next=7,Ct(ve.pipelineId);case 7:E("retry"),De.ZP.success("\u6B63\u5728\u8DF3\u8FC7\u4E2D\uFF0C\u8BF7\u7A0D\u540E..."),C.next=13;break;case 11:C.prev=11,C.t0=C.catch(4);case 13:case"end":return C.stop()}},H,null,[[4,11]])}));return function(P,ve){return Se.apply(this,arguments)}}(),D=function(){var Se=p()(o()().mark(function H(P,ve){return o()().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(P.stopPropagation(),h===3){C.next=3;break}return C.abrupt("return");case 3:return C.prev=3,C.next=6,bt(ve.pipelineId);case 6:E("retry"),De.ZP.success("\u6B63\u5728\u624B\u52A8\u89E6\u53D1\u4E2D\uFF0C\u8BF7\u7A0D\u540E..."),C.next=12;break;case 10:C.prev=10,C.t0=C.catch(3);case 12:case"end":return C.stop()}},H,null,[[3,10]])}));return function(P,ve){return Se.apply(this,arguments)}}(),Fr=function(H){ke.current.open(H)},Ae=function(){var Se=p()(o()().mark(function H(P,ve,oe){return o()().wrap(function(Ue){for(;;)switch(Ue.prev=Ue.next){case 0:if(P.stopPropagation(),(0,ia.rO)("Trigger")){Ue.next=4;break}return De.ZP.error("\u6682\u65E0\u6743\u9650"),Ue.abrupt("return");case 4:if(oe!=="skipped"){Ue.next=8;break}if(a.status!=="running"){Ue.next=8;break}return De.ZP.error("\u91CD\u8DD1\u8DF3\u8FC7\u72B6\u6001\u9700\u8981\u6D41\u6C34\u7EBF\u4E0D\u80FD\u662F\u8FD0\u884C\u4E2D\u72B6\u6001\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5..."),Ue.abrupt("return");case 8:try{Ze.current.open(ve,"job")}catch(ar){}case 9:case"end":return Ue.stop()}},H)}));return function(P,ve,oe){return Se.apply(this,arguments)}}(),d=function(H){return h===3?H:""},y=function(H,P){switch(H&&H.stopPropagation(),h){case 3:ee(),pe.current.open(P,a);break}},U=function(H){H.taskShow=!H.taskShow,S(x()({},a))},O=function(H,P,ve,oe,C){return(0,e.jsx)("div",{style:{display:oe.taskShow?"none":"block"},children:(0,e.jsx)(On,{type:h,tasks:H,stageList:C,job:oe,jobIndex:P,stageIndex:ve,deleteStep:N,addStep:Pe,showConfigDetail:g,renderExecStatusClassName:d,update:f,openReviewModal:y})})},Y=function(H,P,ve){return(0,e.jsx)(ae,{type:h,jobs:H,stageList:ve,stageIndex:P,showConfigDetail:g,renderStep:O,deleteJob:xe,addJob:T,renderExecStatusClassName:d,handleJobCanceled:G,retryServer:Ae,update:f,handleJobSkipped:ie,handleJobManual:D,handleShowJob:U})},nr=function(H,P,ve){return(0,e.jsx)(c,{type:h,stage:H,index:P,stageList:ve,showConfigDetail:g,addStage:re,deleteStage:B,handleShowAdd:z,handleStageAdd:R,stageAddStatus:me,renderJobs:Y,addJob:T,renderExecStatusClassName:d,retry:w,update:f,openConsumptionModal:Fr},H.id)};return a?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:"pipeline-line-container flex-start flow-status-".concat(h),onClick:function(){return M()},children:(0,e.jsxs)("div",{className:"flex-start stage-container",children:[h===1&&(0,e.jsx)("div",{className:"add-stage-dotted"}),a.template.map(function(Se,H){return nr(Se,H,a.template)})]})}),(0,e.jsx)(Qn,x()({ref:be,update:f,type:h},s)),(0,e.jsx)(pt,{ref:ze,update:f,type:h,config:a}),(0,e.jsx)(qa,{ref:pe,update:f,type:h}),(0,e.jsx)(it,{ref:Ze,repeatPipelineStatus:E}),(0,e.jsx)(ot,{ref:Ee}),(0,e.jsx)(yt,{ref:ke})]}):(0,e.jsx)(e.Fragment,{})}var Ft=(0,n.forwardRef)(Et)},866:function(lr,I,r){r.d(I,{Z:function(){return x}});var Me=r(5574),o=r.n(Me),Ce=r(62435),p=r(86074);function Cr(ur){var m=ur.data,n=ur.type,De=(0,Ce.useState)(!0),Mr=o()(De,2),Be=Mr[0],L=Mr[1],Xe=(0,Ce.useState)({w:0,h:0}),or=o()(Xe,2),Ke=or[0],mr=or[1],Ur=(0,Ce.useRef)(null),ln=(0,Ce.useRef)(null),Pr=(0,Ce.useRef)(null);(0,Ce.useEffect)(function(){Kr()},[]),(0,Ce.useEffect)(function(){Xr()},[]),(0,Ce.useEffect)(function(){window.addEventListener("resize",Xr),window.addEventListener("mousemove",xn),window.addEventListener("mouseup",i);var Le=document.querySelector(".common-content-container");return Le.addEventListener("scroll",En),function(){window.removeEventListener("resize",Xr),window.removeEventListener("mousemove",xn),window.removeEventListener("mouseup",i),Le.removeEventListener("scroll",En)}},[]),(0,Ce.useEffect)(function(){dn()},[m]);var Kr=function(){},Xr=function(){mr({w:window.innerWidth,h:window.innerHeight})},In=function(le){var W=0,Re=0;return le.forEach(function(pr,Te){Re+=1,pr.jobs.forEach(function(Fe,ae){Re+=1,Fe.tasks.forEach(function(de,We){Fe.taskShow||(Re+=1)})}),Re>W&&(W=Re),Re=0}),W},En=function(le){var W=le.target,Re=W.scrollTop,pr=W.scrollLeft,Te=document.querySelector(".stage-container"),Fe=Ur.current,ae=Fe.offsetHeight,de=Fe.offsetWidth,We=Te.offsetWidth,Or=Te.offsetHeight,Qr=de*pr/We,qr=ae*Re/Or;Pr.current.style.left=Qr+"px",Pr.current.style.top=qr+"px"},dn=function(){var le=Ur.current,W=le.getContext("2d");W.clearRect(0,0,le.width,le.height),W.fillStyle="#e6e6e6",W.fillRect(0,0,le.width,le.height);var Re=document.querySelector(".stage-container"),pr=Re.offsetWidth,Te=Re.offsetHeight,Fe=document.querySelector(".common-content-container"),ae=Fe.offsetWidth,de=Fe.offsetHeight,We=Ur.current,Or=We.offsetWidth,Qr=We.offsetHeight,qr=m.template,jn=Or/qr.length,$r=jn/5,Mn=jn-$r;if(ae>pr){var On=window.innerWidth-60;Mn=280*Or/On,$r=80*Or/On}var yn=Qr/In(qr),un=yn/5,V=yn-un;if(de>Te){var Qe=de;V=45*Qr/Qe,un=15*Qr/Qe}qr.forEach(function(k,xr){var qe=xr*(Mn+$r),cr=Mn-$r;Pn(W,qe,0,cr,V,k);var Lr=0;k.jobs.forEach(function(ue,Ye){var Br=V+un,on=Br+Ye*(V+un)+Lr*(V+un);fn(W,qe,on,cr,V,ue),Lr+=ue.tasks.length,ue.taskShow&&(Lr-=ue.tasks.length),ue.taskShow||ue.tasks.forEach(function(Dn,zr){vn(W,qe,on+(zr+1)*(V+un),cr,V,Dn)})})})},Pn=function(le,W,Re,pr,Te,Fe){le.save(),n===1?le.fillStyle="#d4e8ff":n===3&&(le.fillStyle=tn(Fe)),le.fillRect(W,Re,pr,Te),le.restore()},fn=function(le,W,Re,pr,Te,Fe){le.save(),n===1?le.fillStyle="#3c96ff":n===3&&(le.fillStyle=tn(Fe)),le.fillRect(W,Re,pr,Te),le.restore()},vn=function(le,W,Re,pr,Te,Fe){le.save(),n===1?le.fillStyle="#99999f":n===3&&(le.fillStyle=tn(Fe)),le.fillRect(W,Re,pr,Te),le.restore()},tn=function(le){var W="#99999f";switch(le.status){case"pending":W="#99999f";break;case"canceled":case"skipped":W="#63656e";break;case"failed":case"timeout":W="#ff5656";break;case"success":W="#34d97b";break;case"running":W="#459fff";break}return W},je=function(){L(!1)},vr=function(){L(!0)},e=function(le){var W=le.clientX,Re=le.clientY,pr=le.target,Te=Pr.current,Fe=Te.offsetLeft,ae=Te.offsetTop,de=ln.current,We=de.offsetLeft,Or=de.offsetTop,Qr=Ur.current,qr=Qr.offsetWidth,jn=Qr.offsetHeight;ln.current.isMove=!0,ln.current.clickClientX=W-(We+12-qr)-Fe,ln.current.clickClientY=Re-(Or+19-jn)-ae},xn=function(le){var W;if((W=ln.current)!==null&&W!==void 0&&W.isMove){var Re=le.clientX,pr=le.clientY,Te=le.target,Fe=Pr.current,ae=Fe.offsetWidth,de=Fe.offsetHeight,We=ln.current,Or=We.offsetLeft,Qr=We.offsetTop,qr=We.clickClientX,jn=We.clickClientY,$r=Ur.current,Mn=$r.offsetWidth,On=$r.offsetHeight,yn=$r.offsetWidth,un=$r.offsetHeight,V=Re-(Or+12-Mn)-qr,Qe=pr-(Qr+19-On)-jn;V<0?V=0:V+ae>yn&&(V=yn-ae),Qe<0?Qe=0:Qe+de>un&&(Qe=un-de),Pr.current.style.left=V+"px",Pr.current.style.top=Qe+"px",Un(V,Qe)}},i=function(){ln.current.isMove=!1},Un=function(le,W){var Re=document.querySelector(".common-content-container"),pr=document.querySelector(".stage-container"),Te=Ur.current,Fe=Te.offsetHeight,ae=Te.offsetWidth,de=pr.offsetWidth,We=pr.offsetHeight;Re.scrollTop=We*W/Fe,Re.scrollLeft=de*le/ae},c=function(){var le=Ur.current||{},W=le.width,Re=window.innerWidth-60-300,pr=document.querySelector(".stage-box")||{},Te=pr.offsetWidth,Fe=m.template,ae=(Te+80)*Fe.length-60,de=Re*W/ae;return de>W&&(de=W),de},Yn=function(){var le=Ur.current||{},W=le.height,Re=document.querySelector(".common-content-container")||{},pr=Re.offsetHeight,Te=document.querySelector(".job-item-detail")||{},Fe=Te.offsetHeight,ae=(Fe+15)*In(m.template),de=pr*W/ae;return de>W&&(de=W),de},kn=function(){return(0,p.jsxs)("div",{className:"min-map-render ".concat(Be&&"show-min-map"),children:[(0,p.jsx)("canvas",{width:"200",height:"134",className:"min-map-canvas",ref:Ur}),(0,p.jsx)("div",{className:"min-map-layer",style:{width:"".concat(c(),"px"),height:"".concat(Yn(),"px")},onMouseDown:e,ref:Pr})]})},Hr=function(){return Be?(0,p.jsx)("i",{className:"iconfont icon-eye3 min-map-open min-map-icon",onClick:function(){return je()},title:"\u9690\u85CF"}):(0,p.jsx)("i",{className:"iconfont icon-eye-off min-map-close min-map-icon",onClick:function(){return vr()},title:"\u663E\u793A"})};return(0,p.jsxs)("div",{className:"min-map-container",ref:ln,children:[Hr(),kn()]})}var x=Cr},19110:function(lr,I,r){r.d(I,{TI:function(){return Be},gb:function(){return Mr},Bc:function(){return n}});var Me=r(5574),o=r.n(Me),Ce=r(62435),p=r(61781),Cr=r(74330),x=r(57132),ur=r(74877),m=r(86074),n=function(Xe){var or=Xe.text,Ke=or===void 0?"":or,mr=(0,Ce.useRef)(null),Ur=(0,Ce.useState)(!1),ln=o()(Ur,2),Pr=ln[0],Kr=ln[1];(0,Ce.useEffect)(function(){Xr()},[Ke]);var Xr=function(){var En=mr.current,dn=En.getBoundingClientRect().width,Pn=En.innerText;dn<100&&(dn=100);var fn=0,vn="",tn=document.createElement("canvas"),je=tn.getContext("2d"),vr="";je.font="12px \u5B8B\u4F53";for(var e=0;e<Pn.length;e++){var xn=Pn[e];if(fn+40>dn){vr=vn+"...";break}else{var i=je.measureText(xn).width;fn+=i,vn+=xn,vr=vn}}En.innerText=vr,dn<=100&&(fn-=10),fn+40>dn?Kr(!0):Kr(!1)};return(0,m.jsx)(m.Fragment,{children:(0,m.jsx)(p.Z,{title:Pr?Ke:"",children:Ce.cloneElement(Xe.children,{ref:mr})})})},De=function(Xe,or){var Ke=(0,Ce.useState)(!1),mr=o()(Ke,2),Ur=mr[0],ln=mr[1];(0,Ce.useImperativeHandle)(or,function(){return{handleDisplay:Pr}});var Pr=function(Xr){ln(Xr)};return Ur?(0,m.jsx)("div",{className:"utils-common-loading-container flex-center",children:(0,m.jsx)(Cr.Z,{tip:"Loading..."})}):(0,m.jsx)(m.Fragment,{})},Mr=(0,Ce.forwardRef)(De),Be=function(Xe){var or=Xe.text;return(0,m.jsx)(x.Z,{onClick:function(){return(0,ur.zp)(or)}})}},57342:function(){}}]);
